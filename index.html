<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="keywords" content="Apple, Combine, ReactiveX, SwiftUI">
<meta name="author" content="Joseph Heck">
<meta name="copyright" content="Joseph Heck 2019-2020">
<title>Using Combine</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Using Combine</h1>
<div class="details">
<span id="author" class="author">Joseph Heck</span><br>
<span id="revnumber">version 1.2,</span>
<span id="revdate">2020-11-07</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#aboutthisbook">About This Book</a>
<ul class="sectlevel2">
<li><a href="#supporting-this-effort">Supporting this effort</a></li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
<li><a href="#author-bio">Author Bio</a></li>
<li><a href="#where-to-get-this-book">Where to get this book</a>
<ul class="sectlevel3">
<li><a href="#download-the-project">Download the project</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#introduction">Introduction to Combine</a>
<ul class="sectlevel2">
<li><a href="#functional-reactive-programming">Functional reactive programming</a></li>
<li><a href="#combine-specifics">Combine specifics</a></li>
<li><a href="#when-to-use-combine">When to use Combine</a></li>
<li><a href="#introduction-appledocs">Apple&#8217;s Combine Documentation</a>
<ul class="sectlevel3">
<li><a href="#wwdc-2019-content">WWDC 2019 content</a></li>
</ul>
</li>
<li><a href="#additional-online-combine-resources">Additional Online Combine Resources</a></li>
</ul>
</li>
<li><a href="#coreconcepts">Core Concepts</a>
<ul class="sectlevel2">
<li><a href="#coreconcepts-publisher-subscriber">Publisher and Subscriber</a></li>
<li><a href="#coreconcepts-marblediagram">Describing pipelines with marble diagrams</a>
<ul class="sectlevel3">
<li><a href="#how-to-read-a-marble-diagram">How to read a marble diagram:</a></li>
<li><a href="#marble-diagrams-for-combine">Marble diagrams for Combine</a></li>
</ul>
</li>
<li><a href="#coreconcepts-backpressure">Back pressure</a></li>
<li><a href="#coreconcepts-lifecycle">Lifecycle of Publishers and Subscribers</a></li>
<li><a href="#coreconcepts-publishers">Publishers</a></li>
<li><a href="#coreconcepts-operators">Operators</a></li>
<li><a href="#coreconcepts-subjects">Subjects</a></li>
<li><a href="#coreconcepts-subscribers">Subscribers</a></li>
</ul>
</li>
<li><a href="#developingwith">Developing with Combine</a>
<ul class="sectlevel2">
<li><a href="#reasoning-about-pipelines">Reasoning about pipelines</a></li>
<li><a href="#developingwith-types">Swift types with Combine publishers and subscribers</a></li>
<li><a href="#developingwith-threads">Pipelines and threads</a></li>
<li><a href="#leveraging-combine-with-your-development">Leveraging Combine with your development</a></li>
</ul>
</li>
<li><a href="#patterns">Patterns and Recipes</a>
<ul class="sectlevel2">
<li><a href="#patterns-sink-subscriber">Creating a subscriber with sink</a></li>
<li><a href="#patterns-assign-subscriber">Creating a subscriber with assign</a></li>
<li><a href="#patterns-datataskpublisher-decode">Making a network request with dataTaskPublisher</a></li>
<li><a href="#patterns-datataskpublisher-trymap">Stricter request processing with dataTaskPublisher</a>
<ul class="sectlevel3">
<li><a href="#normalizing-errors-from-a-datataskpublisher">Normalizing errors from a dataTaskPublisher</a></li>
</ul>
</li>
<li><a href="#patterns-future">Wrapping an asynchronous call with a Future to create a one-shot publisher</a></li>
<li><a href="#patterns-sequencing-operations">Sequencing asynchronous operations</a></li>
<li><a href="#patterns-general-error-handling">Error Handling</a>
<ul class="sectlevel3">
<li><a href="#patterns-assertnofailure">Verifying a failure hasn&#8217;t happened using assertNoFailure</a></li>
<li><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></li>
<li><a href="#patterns-retry">Retrying in the event of a temporary failure</a></li>
<li><a href="#patterns-continual-error-handling">Using flatMap and catch to handle errors without cancelling the pipeline</a></li>
<li><a href="#patterns-constrained-network">Requesting data from an alternate URL when the network is constrained</a></li>
</ul>
</li>
<li><a href="#patterns-uikit-integration">UIKit or AppKit Integration</a>
<ul class="sectlevel3">
<li><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></li>
<li><a href="#patterns-cascading-update-interface">Cascading multiple UI updates, including a network request</a></li>
<li><a href="#patterns-merging-streams-interface">Merging multiple pipelines to update UI elements</a></li>
<li><a href="#patterns-delegate-publisher-subject">Creating a repeating publisher by wrapping a delegate based API</a></li>
<li><a href="#patterns-notificationcenter">Responding to updates from NotificationCenter</a></li>
</ul>
</li>
<li><a href="#patterns-swiftui-integration">SwiftUI Integration</a>
<ul class="sectlevel3">
<li><a href="#pattern-observableobject">Using ObservableObject with SwiftUI models as a publisher source</a></li>
</ul>
</li>
<li><a href="#patterns-testing-and-debugging">Testing and Debugging</a>
<ul class="sectlevel3">
<li><a href="#patterns-testing-publisher">Testing a publisher with XCTestExpectation</a></li>
<li><a href="#patterns-testing-subscriber">Testing a subscriber with a PassthroughSubject</a></li>
<li><a href="#patterns-testing-subscriber-scheduled">Testing a subscriber with scheduled sends from PassthroughSubject</a></li>
<li><a href="#patterns-testable-publisher-subscriber">Using EntwineTest to create a testable publisher and subscriber</a></li>
<li><a href="#patterns-debugging-print">Debugging pipelines with the print operator</a></li>
<li><a href="#patterns-debugging-handleevents">Debugging pipelines with the handleEvents operator</a></li>
<li><a href="#patterns-debugging-breakpoint">Debugging pipelines with the debugger</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#reference">Reference</a>
<ul class="sectlevel2">
<li><a href="#reference-publishers">Publishers</a>
<ul class="sectlevel3">
<li><a href="#reference-just">Just</a></li>
<li><a href="#reference-future">Future</a></li>
<li><a href="#reference-empty">Empty</a></li>
<li><a href="#reference-fail">Fail</a></li>
<li><a href="#reference-sequence">Publishers.Sequence</a></li>
<li><a href="#reference-record">Record</a></li>
<li><a href="#reference-deferred">Deferred</a></li>
<li><a href="#reference-makeconnectable">MakeConnectable</a></li>
<li><a href="#reference-swiftui">SwiftUI</a>
<ul class="sectlevel4">
<li><a href="#binding">Binding</a></li>
<li><a href="#swiftui-and-combine">SwiftUI and Combine</a></li>
</ul>
</li>
<li><a href="#reference-observableobject">ObservableObject</a></li>
<li><a href="#reference-published">@Published</a></li>
<li><a href="#reference-foundation">Foundation</a></li>
<li><a href="#reference-notificationcenter">NotificationCenter</a></li>
<li><a href="#reference-timer">Timer</a></li>
<li><a href="#reference-kvo-publisher">publisher from a KeyValueObserving instance</a></li>
<li><a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a></li>
<li><a href="#reference-result">Result</a></li>
<li><a href="#reference-realitykit">RealityKit</a></li>
</ul>
</li>
<li><a href="#reference-operators">Operators</a>
<ul class="sectlevel3">
<li><a href="#reference-operators-mapping">Mapping elements</a>
<ul class="sectlevel4">
<li><a href="#reference-scan">scan</a></li>
<li><a href="#reference-tryscan">tryScan</a></li>
<li><a href="#reference-map">map</a></li>
<li><a href="#reference-trymap">tryMap</a></li>
<li><a href="#reference-flatmap">flatMap</a></li>
<li><a href="#reference-setfailuretype">setFailureType</a></li>
</ul>
</li>
<li><a href="#reference-operators-filtering">Filtering elements</a>
<ul class="sectlevel4">
<li><a href="#reference-compactmap">compactMap</a></li>
<li><a href="#reference-trycompactmap">tryCompactMap</a></li>
<li><a href="#reference-filter">filter</a></li>
<li><a href="#reference-tryfilter">tryFilter</a></li>
<li><a href="#reference-removeduplicates">removeDuplicates</a></li>
<li><a href="#reference-tryremoveduplicates">tryRemoveDuplicates</a></li>
<li><a href="#reference-replaceempty">replaceEmpty</a></li>
<li><a href="#reference-replaceerror">replaceError</a></li>
<li><a href="#reference-replacenil">replaceNil</a></li>
</ul>
</li>
<li><a href="#reference-operators-reducing">Reducing elements</a>
<ul class="sectlevel4">
<li><a href="#reference-collect">collect</a></li>
<li><a href="#reference-ignoreoutput">ignoreOutput</a></li>
<li><a href="#reference-reduce">reduce</a></li>
<li><a href="#reference-tryreduce">tryReduce</a></li>
</ul>
</li>
<li><a href="#reference-operators-mathematical">Mathematic operations on elements</a>
<ul class="sectlevel4">
<li><a href="#reference-max">max</a></li>
<li><a href="#reference-trymax">tryMax</a></li>
<li><a href="#reference-min">min</a></li>
<li><a href="#reference-trymin">tryMin</a></li>
<li><a href="#reference-count">count</a></li>
</ul>
</li>
<li><a href="#reference-operators-criteria">Applying matching criteria to elements</a>
<ul class="sectlevel4">
<li><a href="#reference-allsatisfy">allSatisfy</a></li>
<li><a href="#reference-tryallsatisfy">tryAllSatisfy</a></li>
<li><a href="#reference-contains">contains</a></li>
<li><a href="#reference-containswhere">containsWhere</a></li>
<li><a href="#reference-trycontainswhere">tryContainsWhere</a></li>
</ul>
</li>
<li><a href="#reference-operators-sequence">Applying sequence operations to elements</a>
<ul class="sectlevel4">
<li><a href="#reference-first">first</a></li>
<li><a href="#reference-firstwhere">firstWhere</a></li>
<li><a href="#reference-tryfirstwhere">tryFirstWhere</a></li>
<li><a href="#reference-last">last</a></li>
<li><a href="#reference-lastwhere">lastWhere</a></li>
<li><a href="#reference-trylastwhere">tryLastWhere</a></li>
<li><a href="#reference-dropuntiloutput">dropUntilOutput</a></li>
<li><a href="#reference-dropwhile">dropWhile</a></li>
<li><a href="#reference-trydropwhile">tryDropWhile</a></li>
<li><a href="#reference-prepend">prepend</a></li>
<li><a href="#reference-drop">drop</a></li>
<li><a href="#reference-prefixuntiloutput">prefixUntilOutput</a></li>
<li><a href="#reference-prefixwhile">prefixWhile</a></li>
<li><a href="#reference-tryprefixwhile">tryPrefixWhile</a></li>
<li><a href="#reference-output">output</a></li>
</ul>
</li>
<li><a href="#reference-operators-combinepublishers">Mixing elements from multiple publishers</a>
<ul class="sectlevel4">
<li><a href="#reference-combinelatest">combineLatest</a></li>
<li><a href="#reference-merge">merge</a></li>
<li><a href="#reference-Publishers">MergeMany</a></li>
<li><a href="#reference-zip">zip</a></li>
</ul>
</li>
<li><a href="#reference-operators-handlingerrors">Error Handling</a>
<ul class="sectlevel4">
<li><a href="#reference-catch">catch</a></li>
<li><a href="#reference-trycatch">tryCatch</a></li>
<li><a href="#reference-assertnofailure">assertNoFailure</a></li>
<li><a href="#reference-retry">retry</a></li>
<li><a href="#reference-maperror">mapError</a></li>
</ul>
</li>
<li><a href="#reference-operators-adaptingtypes">Adapting publisher types</a>
<ul class="sectlevel4">
<li><a href="#reference-switchtolatest">switchToLatest</a></li>
</ul>
</li>
<li><a href="#reference-operators-timing">Controlling timing</a>
<ul class="sectlevel4">
<li><a href="#reference-debounce">debounce</a></li>
<li><a href="#reference-delay">delay</a></li>
<li><a href="#reference-measureinterval">measureInterval</a></li>
<li><a href="#reference-throttle">throttle</a></li>
<li><a href="#reference-timeout">timeout</a></li>
</ul>
</li>
<li><a href="#reference-operators-coding">Encoding and decoding</a>
<ul class="sectlevel4">
<li><a href="#reference-encode">encode</a></li>
<li><a href="#reference-decode">decode</a></li>
</ul>
</li>
<li><a href="#reference-operators-multiplesubscribers">Working with multiple subscribers</a>
<ul class="sectlevel4">
<li><a href="#reference-share">share</a></li>
<li><a href="#reference-multicast">multicast</a></li>
</ul>
</li>
<li><a href="#reference-operators-debugging">Debugging</a>
<ul class="sectlevel4">
<li><a href="#reference-breakpoint">breakpoint</a></li>
<li><a href="#reference-breakpointonerror">breakpointOnError</a></li>
<li><a href="#reference-handleevents">handleEvents</a></li>
<li><a href="#reference-print">print</a></li>
</ul>
</li>
<li><a href="#scheduler-and-thread-handling-operators">Scheduler and Thread handling operators</a>
<ul class="sectlevel4">
<li><a href="#reference-receive">receive</a></li>
<li><a href="#reference-subscribe">subscribe</a></li>
</ul>
</li>
<li><a href="#type-erasure-operators">Type erasure operators</a>
<ul class="sectlevel4">
<li><a href="#reference-erasetoanypublisher">eraseToAnyPublisher</a></li>
<li><a href="#reference-anysubscriber">AnySubscriber</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#reference-subjects">Subjects</a>
<ul class="sectlevel3">
<li><a href="#reference-currentvaluesubject">currentValueSubject</a></li>
<li><a href="#reference-passthroughsubject">PassthroughSubject</a></li>
</ul>
</li>
<li><a href="#reference-subscribers">Subscribers</a>
<ul class="sectlevel3">
<li><a href="#reference-assign">assign</a></li>
<li><a href="#reference-sink">sink</a></li>
<li><a href="#reference-onreceive">onReceive</a></li>
<li><a href="#reference-anycancellable">AnyCancellable</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="aboutthisbook">About This Book</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Version: 1.2</p>
</div>
<div class="paragraph">
<p>Version Date: 2020-11-07</p>
</div>
<div class="paragraph">
<p>This is an intermediate to advanced book, focusing narrowly on how to use the Combine framework.
The writing and examples expect that you have a solid understanding of Swift including reference and value types, protocols, and familiarity with using common elements from the Foundation framework.</p>
</div>
<div class="paragraph">
<p>If you are starting with Swift, <a href="https://developer.apple.com/swift/resources/">Apple provides a number of resources</a> to learn it.
There are truly amazing tutorials and introductions available as books from a number of authors, including <a href="https://gumroad.com/l/swift-kickstart">A Swift Kickstart</a> by Daniel Steinberg and <a href="https://www.hackingwithswift.com">Hacking with Swift</a> by Paul Hudson.</p>
</div>
<div class="paragraph">
<p>This book provides <a href="#introduction">a very abbreviated introduction</a> to the concept of functional reactive programming, which is what Combine is meant to provide.</p>
</div>
<div class="sect2">
<h3 id="supporting-this-effort">Supporting this effort</h3>
<div class="paragraph">
<p><strong><em>If you find the content useful, please purchase a copy of the DRM-free PDF or ePub version at <a href="http://gumroad.com/l/usingcombine" class="bare">http://gumroad.com/l/usingcombine</a>.</em></strong></p>
</div>
<div class="paragraph">
<p>The book is <a href="https://heckj.github.io/swiftui-notes/">available online</a> at no cost.</p>
</div>
<div class="paragraph">
<p>To report a problem (typo, grammar, or technical fault) please <a href="https://github.com/heckj/swiftui-notes/issues/new/choose">Open an issue</a> in GitHub.
If you are so inclined, feel free to fork the project and send me <a href="https://github.com/heckj/swiftui-notes/compare?expand=1">pull requests</a> with updates or corrections.</p>
</div>
</div>
<div class="sect2">
<h3 id="acknowledgements">Acknowledgements</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Thank you</div>
<div class="paragraph">
<p>Michael Critz designed and provided the cover art.</p>
</div>
<div class="paragraph">
<p>Reviews, corrections, and updates from:</p>
</div>
<div class="paragraph">
<p>Benjamin Barnard,
Mycroft Canner,
Max Desiatov,
Tim Ekl,
Malcolm Hall,
Arthur Hammer,
Nanu Jogi,
Serhii Kyrylenko,
Brett Markowitz,
Matt Massicotte,
Michel Mohrmann,
John Mueller,
Lee O&#8217;Mara,
Kai Özer,
Martin Pfundmair,
Zachary Recolan,
Dave Reed,
Dean Scarff,
Andrius Shiaulis,
Antoine Weber,
Paul Wood III,
Federico Zanetello</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Thank you all for taking the time and effort to submit a pull request to make this work better!</p>
</div>
</div>
<div class="sect2">
<h3 id="author-bio">Author Bio</h3>
<div class="paragraph">
<p>Joe Heck has broad software engineering development and management experience across startups and large companies.
He works across all the layers of solutions, from architecture, development, validation, deployment, and operations.</p>
</div>
<div class="paragraph">
<p>Joe has developed projects ranging from mobile and desktop application development to cloud-based distributed systems.
He has established teams, development processes, CI and CD pipelines, and developed validation and operational automation.
Joe also builds and mentors people to learn, build, validate, deploy and run software services and infrastructure.</p>
</div>
<div class="paragraph">
<p>Joe works extensively with and in open source, contributing and collaborating with a wide variety of open source projects.
He writes online across a variety of topics at <a href="https://rhonabwy.com/" class="bare">https://rhonabwy.com/</a>.</p>
</div>
<table class="tableblock frame-none grid-none" style="width: 50%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><a href="https://github.com/heckj"><span class="icon"><i class="fa fa-github fa-2x"></i></span></a></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><a href="https://www.linkedin.com/in/josephheck/"><span class="icon"><i class="fa fa-linkedin fa-2x"></i></span></a></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><a href="http://twitter.com/heckj"><span class="icon"><i class="fa fa-twitter fa-2x"></i></span></a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="where-to-get-this-book">Where to get this book</h3>
<div class="paragraph">
<p>The online version of this book is available online as <a href="https://heckj.github.io/swiftui-notes/">HTML</a>, provided at no cost.</p>
</div>
<div class="paragraph">
<p>DRM-free PDF or ePub versions are available for purchase at <a href="http://gumroad.com/l/usingcombine" class="bare">http://gumroad.com/l/usingcombine</a>.</p>
</div>
<div class="paragraph">
<p>Updates of the content will be made to the online version as development continues.
Larger updates and announcements will also be provided through <a href="https://gumroad.com/heckj">the author&#8217;s profile at Gumroad</a>.</p>
</div>
<div class="paragraph">
<p>The content for this book, including sample code and tests, are sourced from the GitHub repository: <a href="https://github.com/heckj/swiftui-notes" class="bare">https://github.com/heckj/swiftui-notes</a>.</p>
</div>
<div class="sect3">
<h4 id="download-the-project">Download the project</h4>
<div class="paragraph">
<p>The contents of this book, as well as example code and unit tests referenced from the book, are linked in an Xcode project (<code>SwiftUI-Notes.xcodeproj</code>).
The Xcode project includes fully operational sample code that shows examples of Combine integrating with UIKit and SwiftUI.
The project also includes extensive unit tests exercising the framework to illustrate the behavior of framework components.</p>
</div>
<div class="paragraph">
<p>The project associated with this book requires Xcode 11 and MacOS 10.14 or later.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/welcomeToXcode.png" alt="Welcome to Xcode" width="406" height="388">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>From the Welcome to Xcode window, choose <strong>Clone an existing project</strong></p>
</li>
<li>
<p>Enter <code><a href="https://github.com/heckj/swiftui-notes.git" class="bare">https://github.com/heckj/swiftui-notes.git</a></code> and click <code>Clone</code></p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/cloneRepository.png" alt="clone Repository" width="463" height="263">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Choose the <code>master</code> branch to check out</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">Introduction to Combine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Apple&#8217;s words, Combine is:</p>
</div>
<div class="quoteblock">
<blockquote>
a declarative Swift API for processing values over time.
</blockquote>
</div>
<div class="paragraph">
<p>Combine is Apple&#8217;s take on a functional reactive programming library, akin to <a href="https://github.com/ReactiveX/RxSwift">RxSwift</a>.
RxSwift itself is a port of <a href="http://reactivex.io">ReactiveX</a>.
Combine uses many of the same functional reactive concepts that can be found in other languages and libraries, applying the staticly typed nature of Swift to their solution.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you are already familiar with RxSwift there is <a href="https://github.com/CombineCommunity/rxswift-to-combine-cheatsheet">a good collected cheat-sheet</a> for how to map concepts and APIs from RxSwift to Combine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="functional-reactive-programming">Functional reactive programming</h3>
<div class="paragraph">
<p><a href="https://en.wikipedia.org/wiki/Functional_reactive_programming">Functional reactive programming</a>, also known as data-flow programming, builds on the concepts of <a href="https://en.wikipedia.org/wiki/Functional_programming">functional programming</a>.
Where functional programming applies to lists of elements, functional reactive programming is applied to streams of elements.
The kinds of functions in functional programming, such as <code>map</code>, <code>filter</code>, and <code>reduce</code> have analogues that can be applied to streams.
In addition to functional programming primitives, functional reactive programming includes functions to split and merge streams.
Like functional programming, you may create operations to transform the data flowing through the stream.</p>
</div>
<div class="paragraph">
<p>There are many parts of the systems we program that can be viewed as asynchronous streams of information - events, objects, or pieces of data.
The observer pattern watches a single object, providing notifications of changes and updates.
If you view these notifications over time, they make up a stream of objects.
Functional reactive programming, Combine in this case, allows you to create code that describes what happens when getting data in a stream.</p>
</div>
<div class="paragraph">
<p>You may want to create logic to watch more than one element that is changing.
You may also want to include logic that does additional asynchronous operations, some of which may fail.
You may want to change the content of the streams based on timing, or change the timing of the content.
Handling the flow of these event streams, the timing, errors when they happen, and coordinating how a system responds to all those events is at the heart of functional reactive programming.</p>
</div>
<div class="paragraph">
<p>A solution based on functional reactive programming is particularly effective when programming user interfaces.
Or more generally for creating pipelines that process data from external sources or rely on asynchronous APIs.</p>
</div>
</div>
<div class="sect2">
<h3 id="combine-specifics">Combine specifics</h3>
<div class="paragraph">
<p>Applying these concepts to a strongly typed language like Swift is part of what Apple has created in Combine.
Combine extends functional reactive programming by embedding the concept of back-pressure.
Back-pressure is the idea that the subscriber should control how much information it gets at once and needs to process.
This leads to efficient operation with the added notion that the volume of data processed through a stream is controllable as well as cancellable.</p>
</div>
<div class="paragraph">
<p>Combine elements are set up to be composed, including affordances to integrate existing code to incrementally support adoption.</p>
</div>
<div class="paragraph">
<p>Combine is leveraged by some of Apple&#8217;s other frameworks.
SwiftUI is the obvious example that has the most attention, with both subscriber and publisher elements.
RealityKit also has publishers that you can use to react to events.
And Foundation has a number of Combine specific additions including NotificationCenter, URLSession, and Timer as publishers.</p>
</div>
<div class="paragraph">
<p>Any asynchronous API <em>can</em> be leveraged with Combine.
For example, you could use some of the APIs in the Vision framework, composing data flowing to it, and from it, by leveraging Combine.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>In this work, I&#8217;m going to call a set of composed operations in Combine a <strong>pipeline</strong>.
Pipeline is not a term that Apple is (yet?) using in its documentation.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="when-to-use-combine">When to use Combine</h3>
<div class="paragraph">
<p>Combine fits most naturally when you want to set up something that reacts to a variety of inputs.
User interfaces fit very naturally into this pattern.</p>
</div>
<div class="paragraph">
<p>The classic examples using functional reactive programming in user interfaces frequently show form validation, where user events such as changing text fields, taps, or mouse-clicks on UI elements make up the data being streamed.
Combine takes this further, enabling watching of properties, binding to objects, sending and receiving higher level events from UI controls, and supporting integration with almost all of Apple&#8217;s existing API ecosystem.</p>
</div>
<div class="paragraph">
<p>Some things you can do with Combine include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can set up pipelines to enable a button for submission only when values entered into the fields are valid.</p>
</li>
<li>
<p>A pipeline can also do asynchronous actions (such as checking with a network service) and using the values returned to choose how and what to update within a view.</p>
</li>
<li>
<p>Pipelines can also be used to react to a user typing dynamically into a text field and updating the user interface view based on what they&#8217;re typing.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Combine is not limited to user interfaces.
Any sequence of asynchronous operations can be effective as a pipeline, especially when the results of each step flow to the next step.
An example of such might be a series of network service requests, followed by decoding the results.</p>
</div>
<div class="paragraph">
<p>Combine can also be used to define how to handle errors from asynchronous operations.
Combine supports doing this by setting up pipelines and merging them together.
One of Apple&#8217;s examples with Combine include a pipeline to fall back to getting a lower-resolution image from a network service when the local network is constrained.</p>
</div>
<div class="paragraph">
<p>Many of the pipelines you create with Combine will only be a few operations.
Even with just a few operations, Combine can still make it much easier to view and understand what&#8217;s happening when you compose a pipeline.
Combine pipelines are a declarative way to define what processing should happen to a stream of values over time.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="introduction-appledocs">Apple&#8217;s Combine Documentation</h3>
<div class="paragraph">
<p><span class="icon"><i class="fa fa-apple fa-2x"></i></span></p>
</div>
<div class="paragraph">
<p>The <a href="https://developer.apple.com/documentation/combine">online documentation for Combine</a> can be found at <a href="https://developer.apple.com/documentation/combine" class="bare">https://developer.apple.com/documentation/combine</a>.
Apple&#8217;s developer documentation is hosted at <a href="https://developer.apple.com/documentation/" class="bare">https://developer.apple.com/documentation/</a>.</p>
</div>
<div class="sect3">
<h4 id="wwdc-2019-content">WWDC 2019 content</h4>
<div class="paragraph">
<p>Apple provides video, slides, and some sample code in sessions at its developer conferences.
Details on Combine are primarily from <a href="https://developer.apple.com/videos/play/wwdc2019">WWDC 2019</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Combine has evolved since its initial release at WWDC 2019.
Some of the content in these presentations are now slightly dated or changed from what currently exists.
The majority of this content is still immensely valuable in getting an introduction or feel for what Combine is and can do.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A number of these introduce and go into some depth on Combine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/722/">Introducing Combine</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://devstreaming-cdn.apple.com/videos/wwdc/2019/722l6blhn0efespfgx/722/722_introducing_combine.pdf?dl=1">PDF of presentation notes</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/721/">Combine in Practice</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://devstreaming-cdn.apple.com/videos/wwdc/2019/721ga0kflgr4ypfx/721/721_combine_in_practice.pdf?dl=1">PDF of presentation notes</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>A number of additional WWDC19 sessions mention Combine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/415/">Modern Swift API Design</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/226">Data Flow Through SwiftUI</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/711">Introducing Combine and Advances in Foundation</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/712/">Advances in Networking, Part 1</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/610/">Building Collaborative AR Experiences</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/videos/play/wwdc2019/223/">Expanding the Sensory Experience with Core Haptics</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="additional-online-combine-resources">Additional Online Combine Resources</h3>
<div class="paragraph">
<p>In addition to Apple&#8217;s documentation, there are a number of other online resources where you can find questions, answers, discussion, and descriptions of how Combine operates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="https://forums.swift.org/">Swift Forums</a> (hosted from the <a href="https://swift.org/">swift open source project</a>) has a <a href="https://forums.swift.org/tags/combine">combine tag</a> with a number of interesting threads. While the Combine framework is <strong>not</strong> open source, some of its implementation and specifics are discussed in these forums.</p>
</li>
<li>
<p><a href="https://stackoverflow.com">Stackoverflow</a> also has a sizable (and growing) collection of <a href="https://stackoverflow.com/questions/tagged/combine">Combine related Q&amp;A</a>.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="coreconcepts">Core Concepts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are only a few core concepts that you need to know to use Combine effectively, but they are very important to understand.
Each of these concepts is mirrored in the framework with a generic protocol, formalizing the concepts into expected functions.</p>
</div>
<div class="paragraph">
<p>These core concepts are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#coreconcepts-publisher-subscriber">Publisher and Subscriber</a></p>
</li>
<li>
<p><a href="#coreconcepts-operators">Operators</a></p>
</li>
<li>
<p><a href="#coreconcepts-subjects">Subjects</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="coreconcepts-publisher-subscriber">Publisher and Subscriber</h3>
<div class="paragraph">
<p>Two key concepts, <a href="https://developer.apple.com/documentation/combine/publisher"><strong>publisher</strong></a> and <a href="https://developer.apple.com/documentation/combine/subscriber"><strong>subscriber</strong></a>, are described in Swift as protocols.</p>
</div>
<div class="paragraph">
<p>When you are talking about programming (and especially with Swift and Combine), quite a lot is described by the types.
When you say a function or method returns a value, that value is generally described as being "one of this type".</p>
</div>
<div class="paragraph">
<p>Combine is all about defining the process of what you do with many possible values over time.
Combine also goes farther than defining the result, it also defines how it can fail.
It not only talks about the types that can be returned, but the failures that might happen as well.</p>
</div>
<div class="paragraph">
<p>The first core concept to introduce in this respect is the publisher.
A publisher provides data when available and upon request.
A publisher that has not had any subscription requests will not provide any data.
When you are describing a Combine publisher, you describe it with two associated types: one for Output and one for Failure.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diagrams/basic_types.svg" alt="basic types">
</div>
</div>
<div class="paragraph">
<p>These are often written using the generics syntax which uses the <code>&lt;</code> and <code>&gt;</code> symbol around text describing the types.
This represents that we are talking about a generic instance of this type of value.
For example, if a publisher returned an instance of <code>String</code>, and could return a failure in the form of an instance of <code>URLError</code>, then the publisher might be described with the string <code>&lt;String, URLError&gt;</code>.</p>
</div>
<div class="paragraph">
<p>The corresponding concept that matches with a publisher is a subscriber, and is the second core concept to introduce.</p>
</div>
<div class="paragraph">
<p>A subscriber is responsible for requesting data and accepting the data (and possible failures) provided by a publisher.
A subscriber is described with two associated types, one for Input and one for Failure.
The subscriber initiates the request for data, and controls the amount of data it receives.
It can be thought of as "driving the action" within Combine, as without a subscriber, the other components stay idle.</p>
</div>
<div class="paragraph">
<p>Publishers and subscribers are meant to be connected, and make up the core of Combine.
When you connect a subscriber to a publisher, both types must match: Output to Input, and Failure to Failure.
One way to visualize this is as a series of operations on two types in parallel, where both types need to match in order to plug the components together.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diagrams/input_output.svg" alt="publisher output to subscriber input">
</div>
</div>
<div class="paragraph">
<p>The third core concept is an operator - an object that acts both like a subscriber and a publisher.
Operators are classes that adopt both the <a href="https://developer.apple.com/documentation/combine/subscriber">Subscriber protocol</a> and <a href="https://developer.apple.com/documentation/combine/publisher">Publisher protocol</a>.
They support subscribing to a publisher, and sending results to any subscribers.</p>
</div>
<div class="paragraph">
<p>You can create chains of these together, for processing, reacting, and transforming the data provided by a publisher, and requested by the subscriber.</p>
</div>
<div class="paragraph">
<p>I&#8217;m calling these composed sequences <strong>pipelines</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diagrams/pipeline.svg" alt="pipeline">
</div>
</div>
<div class="paragraph">
<p>Operators can be used to transform either values or types - both the Output and Failure type.
Operators may also split or duplicate streams, or merge streams together.
Operators must always be aligned by the combination of Output/Failure types.
The compiler will enforce the matching types, so getting it wrong will result in a compiler error (and, if you are lucky, a useful <em>fixit</em> snippet suggesting a solution).</p>
</div>
<div class="paragraph">
<p>A simple Combine pipeline written in swift might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="c1">// do something with the incoming value here</span>
        <span class="c1">// and return a string</span>
        <span class="k">return</span> <span class="s">"a string"</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedValue</span> <span class="k">in</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="c1">// sink is the subscriber and terminates the pipeline</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"The end result was </span><span class="se">\(</span><span class="n">receivedValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The pipeline starts with the publisher <code>Just</code>, which responds with the value that its defined with (in this case, the Integer <code>5</code>). The output type is <code>&lt;Integer&gt;</code>, and the failure type is <code>&lt;Never&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The pipeline then has a <code>map</code> operator, which is transforming the value and its type.
In this example it is ignoring the published input and returning a string.
This is also transforming the output type to <code>&lt;String&gt;</code>, and leaving the failure type still set as <code>&lt;Never&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The pipeline then ends with a <code>sink</code> subscriber.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you are thinking about a pipeline you can think of it as a sequence of operations linked by both output and failure types.
This pattern will come in handy when you start constructing your own pipelines.
When creating pipelines, you are often selecting operators to help you transform the data, types, or both to achieve your end goal.
That end goal might be enabling or disabling a user interface element, or it might be retrieving some piece of data to be displayed.
Many Combine operators are specifically created to help with these transformations.</p>
</div>
<div class="paragraph">
<p>There are a number of operators that have a similar operator prefixed with <code>try</code>, which indicates they return an <code>&lt;Error&gt;</code> failure type.
An example of this is <a href="#reference-map">map</a> and <a href="#reference-trymap">tryMap</a>.
The <code>map</code> operator allows for any combination of Output and Failure type and passes them through.
<code>tryMap</code> accepts any Input, Failure types, and allows any Output type, but will always output an <code>&lt;Error&gt;</code> failure type.</p>
</div>
<div class="paragraph">
<p>Operators like <code>map</code> allow you to define the output type being returned by inferring the output type based on what you return in a closure provided to the operator.
In the example above, the <code>map</code> operator is returning a <code>String</code> output type since that it what the closure returns.</p>
</div>
<div class="paragraph">
<p>To illustrate the example of changing types more concretely, we expand upon the logic to use the values being passed. This example still starts with a publisher providing the types <code>&lt;Int, Never&gt;</code> and end with a subscription taking the types <code>&lt;String, Never&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/SwiftUI-NotesTests/CombinePatternTests.swift">SwiftUI-NotesTests/CombinePatternTests.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="k">switch</span> <span class="n">value</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"none"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"one"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"couple"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"few"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"many"</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"some"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedValue</span> <span class="k">in</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="nf">print</span><span class="p">(</span><span class="s">"The end result was </span><span class="se">\(</span><span class="n">receivedValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Just is a publisher that creates an <code>&lt;Int, Never&gt;</code> type combination, provides a single value and then completes.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the closure provided to the <code>.map()</code> function takes in an <code>&lt;Int&gt;</code> and transforms it into a <code>&lt;String&gt;</code>. Since the failure type of <code>&lt;Never&gt;</code> is not changed, it is passed through.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>sink</code>, the subscriber, receives the <code>&lt;String, Never&gt;</code> combination.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When you are creating pipelines in Xcode and don&#8217;t match the types, the error message from Xcode may include a helpful <em>fixit</em>.
In some cases, such as the example above, the compiler is unable to infer the return types of closure provided to <code>map</code> without specifying the return type.
Xcode (11 beta 2 and beta 3) displays this as the error message: <code>Unable to infer complex closure return type; add explicit type to disambiguate</code>.
In the example above, we explicitly specified the type being returned with the line <code>value &#8594; String in</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can view Combine publishers, operators, and subscribers as having two parallel types that both need to be aligned - one for the functional case and one for the error case.
Designing your pipeline is frequently choosing how to convert one or both of those types and the associated data with it.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="coreconcepts-marblediagram">Describing pipelines with marble diagrams</h3>
<div class="paragraph">
<p>A functional reactive pipeline can be tricky to understand.
A publisher is generating and sending data, operators are reacting to that data and potentially changing it, and subscribers requesting and accepting it.
That in itself would be complicated, but some operators in Combine also may change the timing when events happen - introducing delays, collapsing multiple values into one, and so forth.
Because these can be complex to understand, the functional reactive programming community illustrates these changes with a visual description called a <strong>marble diagram</strong>.</p>
</div>
<div class="paragraph">
<p>As you explore the concepts behind Combine, you may find yourself looking at other functional reactive programming systems, such as RxSwift or ReactiveExtensions.
The documentation associated with these systems often use marble diagrams.</p>
</div>
<div class="paragraph">
<p>Marble diagrams focus on describing how a specific pipeline changes the stream of data.
It shows data changing over time, as well as the timing of those changes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diagrams/marble_diagram.svg" alt="marble diagram">
</div>
<div class="title">Figure 1. An example marble diagram</div>
</div>
<div class="sect3">
<h4 id="how-to-read-a-marble-diagram">How to read a marble diagram:</h4>
<div class="ulist">
<ul>
<li>
<p>The diagram centers around whatever element is being described, an operator in this case.
The name of the operator is often on the central block.</p>
</li>
<li>
<p>The lines above and below represent data moving through time.
The left is earlier and the right is later.
The symbols on the line represent discrete bits of data.</p>
</li>
<li>
<p>It is often assumed that data is flowing downward.
With this pattern, the top line is indicating the inputs to the operator and the bottom line represents the outputs.</p>
</li>
<li>
<p>In some diagrams, the symbols on the top line may differ from the symbols on the bottom line.
When they are different, the diagram is typically implying that the type of the output is different from the type of the input.</p>
</li>
<li>
<p>In other places, you may also see a vertical bar or an <code>X</code> on the timeline, or ending the timeline.
That is used to indicate the end of a stream.
A bar at the end of a line implies the stream has terminated normally.
An <code>X</code> indicates that an error or exception was thrown.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These diagrams intentionally ignore the setup (or teardown) of a pipeline, preferring to focus on one element to describe how that element works.</p>
</div>
</div>
<div class="sect3">
<h4 id="marble-diagrams-for-combine">Marble diagrams for Combine</h4>
<div class="paragraph">
<p>This book uses an expansion of the basic marble diagram, modified slightly to highlight some of the specifics of Combine.
The most notable difference are two lines for input and output.
Since Combine explicitly types both the input and the failure, these are represented separately and the types described in the diagram.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diagrams/combine_marble_diagram.svg" alt="combine marble diagram">
</div>
<div class="title">Figure 2. An expanded Combine specific marble diagram</div>
</div>
<div class="paragraph">
<p>If a publisher is being described, the two lines are below the element, following the pattern of "data flows down".
An operator, which acts as both a publisher and subscriber, would have two sets - one above and one below.
A subscriber has the lines above it.</p>
</div>
<div class="paragraph">
<p>To illustrate how these diagrams relate to code, let&#8217;s look at a simple example.
In this case, we will focus on the map operator and how it can be described with this diagram.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="k">switch</span> <span class="n">value</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"none"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"one"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"couple"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"few"</span>
        <span class="k">case</span> <span class="n">_</span> <span class="k">where</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"many"</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"some"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedValue</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"The end result was </span><span class="se">\(</span><span class="n">receivedValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The closure provided to the <code>.map()</code> function takes in an <code>&lt;Int&gt;</code> and transforms it into a <code>&lt;String&gt;</code>.
Since the failure type of &lt;Never&gt; is not changed, it is passed through.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following diagram represents this code snippet.
This diagram goes further than others in this book; it includes the closure from the sample code in the diagram to show how it relates.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diagrams/example_map_operator.svg" alt="map operator">
</div>
<div class="title">Figure 3. The example map operator from the code above:</div>
</div>
<div class="paragraph">
<p>Many combine operators are configured with code provided by you, written in a closure.
Most diagrams will not attempt to include it in the diagram.
It is implied that any code you provide through a closure in Combine will be used within the box rather than explicitly detailed.</p>
</div>
<div class="paragraph">
<p>The input type for this map operator is <code>&lt;Int&gt;</code>, which is described with generic syntax on the top line.
The failure type that is being passed to this operator is <code>&lt;Never&gt;</code>, described in the same syntax just below the Input type.</p>
</div>
<div class="paragraph">
<p>The map operator doesn&#8217;t change or interact with the failure type, only passing it along.
To represent that, the failure types - both input (above) and output (below) - have been lightened.</p>
</div>
<div class="paragraph">
<p>A single input value provided (<code>5</code>) is represented on the top line.
The location on the line isn&#8217;t meaningful in this case, only representing that it is a single value.
If multiple values were on the line, the ones on the left would be presented to the map operator before any on the right.</p>
</div>
<div class="paragraph">
<p>When it arrives, the value <code>5</code> is passed to the closure as the variable <code>value</code>.
The return type of the closure (<code>&lt;String&gt;</code> in this case), defines the output type for the map operator when the code within the closure completes and returns its value.
In this case, the string <code>some</code> is returned for the input value <code>5</code>.
The string <code>some</code> is represented on the output line directly below its input value, implying there was no explicit delay.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Most diagrams in this book won&#8217;t be as complex or detailed as this example.
Most of these diagrams will focus on describing the operator.
This one is more complex to illustrate how the diagrams can be interpreted and how they relate to your code.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="coreconcepts-backpressure">Back pressure</h3>
<div class="paragraph">
<p>Combine is designed such that the subscriber controls the flow of data, and because of that it also controls what and when processing happens in the pipeline.
This is a feature of Combine called <strong>back-pressure</strong>.</p>
</div>
<div class="paragraph">
<p>This means that the subscriber drives the processing within a pipeline by providing information about how much information it wants or can accept.
When a subscriber is connected to a publisher, it requests data based on a specific <a href="https://developer.apple.com/documentation/combine/subscribers/demand">Demand</a>.</p>
</div>
<div class="paragraph">
<p>The demand request is propagated up through the composed pipeline.
Each operator in turn accepts the request for data and in turn requests information from the publishers to which it is connected.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In the first release of the Combine framework - in iOS 13 prior to iOS 13.3 and macOS prior to 10.15.2 - when the subscriber requested data with a Demand, that call itself was asynchronous.
Because this process acted as the driver which triggered attached operators and ultimately the source publisher, it meant that there were scenarios where data might appear to be lost.
Due to this, in iOS 13.3 and later Combine releases, the process of requesting demand has been updated to a synchronous/blocking call.
In practice, this means that you can be a bit more certain of having any pipelines created and fully engaged prior to a publisher receiving the request to send any data.</p>
</div>
<div class="paragraph">
<p>There is an <a href="https://forums.swift.org/t/combine-receive-on-runloop-main-loses-sent-value-how-can-i-make-it-work/28631/39">extended thread on the Swift forums</a> about this topic, if you are interested in reading the history.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the subscriber driving this process, it allows Combine to support cancellation.
Subscribers all conform to the <a href="https://developer.apple.com/documentation/combine/cancellable">Cancellable</a> protocol.
This means they all have a function <code>cancel()</code> that can be invoked to terminate a pipeline and stop all related processing.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When a pipeline has been cancelled, the pipeline is not expected to be restarted.
Rather than restarting a cancelled pipeline, the developer is expected to create a new pipeline.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="coreconcepts-lifecycle">Lifecycle of Publishers and Subscribers</h3>
<div class="paragraph">
<p>The end to end lifecycle is enabled by subscribers and publishers communicating in a well defined sequence:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/diagrams/combine_lifecycle_diagram.svg" alt="combine lifecycle diagram">
</div>
<div class="title">Figure 4. An The lifecycle of a combine pipeline</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When the subscriber is attached to a publisher, it starts with a call to <code>.subscribe(_: Subscriber)</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The publisher in turn acknowledges the subscription calling <code>receive(subscription: Subscription)</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>After the subscription has been acknowledged, the subscriber requests <em>N</em> values with <code>request(_: Demand)</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The publisher may then (as it has values) send <em>N</em> (or fewer) values using <code>receive(_: Input)</code>.
A publisher should never send <strong>more</strong> than the demand requested.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Any time after the subscription has been acknowledged, the subscriber may send a <a href="https://developer.apple.com/documentation/combine/subscribers/completion">cancellation</a> with <code>.cancel()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>A publisher may optionally send <a href="https://developer.apple.com/documentation/combine/subscribers/completion">completion</a>: <code>receive(completion:)</code>.
A completion can be either a normal termination, or may be a <code>.failure</code> completion, optionally propagating an error type.
A pipeline that has been cancelled will not send any completions.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Included in the above diagram is a stacked up set of the example marble diagrams.
This is to highlight where Combine marble diagrams focus in the overall lifecycle of a pipeline.
Generally the diagrams infer that all of the setup has been done and data requested.
The heart of a combine marble diagram is the series of events between when data was requested and any completions or cancellations are triggered.</p>
</div>
</div>
<div class="sect2">
<h3 id="coreconcepts-publishers">Publishers</h3>
<div class="paragraph">
<p>The publisher is the provider of data.
The <a href="https://developer.apple.com/documentation/combine/publisher">publisher protocol</a> has a strict contract returning values when asked from subscribers, and possibly terminating with an explicit completion enumeration.</p>
</div>
<div class="paragraph">
<p><a href="#reference-just">Just</a> and <a href="#reference-future">Future</a> are common sources to start your own publisher from a value or asynchronous function.</p>
</div>
<div class="paragraph">
<p>Many publishers will immediately provide data when requested by a subscriber.
In some cases, a publisher may have a separate mechanism to enable it to return data after subscription.
This is codified by the protocol <a href="https://developer.apple.com/documentation/combine/connectablepublisher">ConnectablePublisher</a>.
A publisher conforming to <code>ConnectablePublisher</code> will have an additional mechanism to start the flow of data after a subscriber has provided a request.
This could be a separate <code>.connect()</code> call on the publisher itself.
The other option is <code>.autoconnect()</code>, which will start the flow of data as soon as a subscriber requests it.</p>
</div>
<div class="paragraph">
<p>Combine provides a number of additional convenience publishers:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-just">Just</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-future">Future</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-deferred">Deferred</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-empty">Empty</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-sequence">Sequence</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-fail">Fail</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-record">Record</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-share">Share</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-multicast">Multicast</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-observableobject">ObservableObject</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-published">@Published</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A number of Apple API outside of Combine provide publishers as well.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-swiftui">SwiftUI</a> uses the <code>@Published</code> and <code>@ObservedObject</code> property wrappers, provided by Combine, to implicitly create a publisher and support its declarative view mechanisms.</p>
</li>
<li>
<p>Foundation</p>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#reference-kvo-publisher">.publisher on KVO instance</a></p>
</li>
<li>
<p><a href="#reference-notificationcenter">NotificationCenter</a></p>
</li>
<li>
<p><a href="#reference-timer">Timer</a></p>
</li>
<li>
<p><a href="#reference-result">Result</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="coreconcepts-operators">Operators</h3>
<div class="paragraph">
<p>Operators are a convenient name for a number of pre-built functions that are included under Publisher in Apple&#8217;s reference documentation.
Operators are meant to be composed into pipelines.
Many will accept one or more closures from the developer to define the business logic while maintaining the adherence to the publisher/subscriber lifecycle.</p>
</div>
<div class="paragraph">
<p>Some operators support bringing together outputs from different pipelines, changing the timing of data, or filtering the data provided.
Operators may also have constraints on the types they will operate on.
Operators can also be used to define error handling and retry logic, buffering and prefetch, and supporting debugging.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Mapping elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-scan">scan</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryscan">tryScan</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-setfailuretype">setFailureType</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-map">map</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-trymap">tryMap</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-flatmap">flatMap</a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Filtering elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-compactmap">compactMap</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-trycompactmap">tryCompactMap</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-replaceempty">replaceEmpty</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-filter">filter</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryfilter">tryFilter</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-replaceerror">replaceError</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-removeduplicates">removeDuplicates</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryremoveduplicates">tryRemoveDuplicates</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Reducing elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-collect">collect</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-reduce">reduce</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryreduce">tryReduce</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-ignoreoutput">ignoreOutput</a></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Mathematic operations on elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-max">max</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-trymax">tryMax</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-count">count</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-min">min</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-min">tryMin</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Applying matching criteria to elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-allsatisfy">allSatisfy</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryallsatisfy">tryAllSatisfy</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-contains">contains</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-containswhere">containsWhere</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-trycontainswhere">tryContainsWhere</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Applying sequence operations to elements</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-firstwhere">firstWhere</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryfirstwhere">tryFirstWhere</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-first">first</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-lastwhere">lastWhere</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-trylastwhere">tryLastWhere</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-last">last</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-dropwhile">dropWhile</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-trydropwhile">tryDropWhile</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-dropuntiloutput">dropUntilOutput</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-prepend">prepend</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-drop">drop</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-prefixuntiloutput">prefixUntilOutput</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-prefixwhile">prefixWhile</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-tryprefixwhile">tryPrefixWhile</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-output">output</a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Combining elements from multiple publishers</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-combinelatest">combineLatest</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-merge">merge</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-zip">zip</a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Handling errors</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-catch">catch</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-trycatch">tryCatch</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-assertnofailure">assertNoFailure</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-retry">retry</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-maperror">mapError</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Adapting publisher types</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-switchtolatest">switchToLatest</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-erasetoanypublisher">eraseToAnyPublisher</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Controlling timing</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-debounce">debounce</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-delay">delay</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-measureinterval">measureInterval</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-throttle">throttle</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-timeout">timeout</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Encoding and decoding</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-encode">encode</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-decode">decode</a></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Working with multiple subscribers</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-multicast">multicast</a></p></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="3"><p class="tableblock">Debugging</p></th>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-breakpoint">breakpoint</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-handleevents">handleEvents</a></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#reference-print">print</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="coreconcepts-subjects">Subjects</h3>
<div class="paragraph">
<p>Subjects are a special case of publisher that also adhere to the <a href="https://developer.apple.com/documentation/combine/subject"><code>Subject</code></a> protocol.
This protocol requires subjects to have a <code>.send(_:)</code> method to allow the developer to send specific values to a subscriber (or pipeline).</p>
</div>
<div class="paragraph">
<p>Subjects can be used to "inject" values into a stream, by calling the subject&#8217;s <code>.send(_:)</code> method.
This is useful for integrating existing imperative code with Combine.</p>
</div>
<div class="paragraph">
<p>A subject can also broadcast values to multiple subscribers.
If multiple subscribers are connected to a subject, it will fan out values to the multiple subscribers when <code>send(_:)</code> is invoked.
A subject is also frequently used to connect or cascade multiple pipelines together, especially to fan out to multiple pipelines.</p>
</div>
<div class="paragraph">
<p>A subject does not blindly pass through the demand from its subscribers.
Instead, it provides an aggregation point for demand.
A subject will not signal for demand to its connected publishers until it has received at least one subscriber itself.
When it receives any demand, it then signals for <code>unlimited</code> demand to connected publishers.
With the subject supporting multiple subscribers, any subscribers that have not requested data with a demand are not provided the data until they do.</p>
</div>
<div class="paragraph">
<p>There are two types of built-in subjects with Combine: <a href="#reference-currentvaluesubject">CurrentValueSubject</a> and <a href="#reference-passthroughsubject">PassthroughSubject</a>.
They act similarly, the difference being CurrentValueSubject remembers and requires an initial state, where PassthroughSubject does not.
Both will provide updated values to any subscribers when <code>.send()</code> is invoked.</p>
</div>
<div class="paragraph">
<p>Both <code>CurrentValueSubject</code> and <code>PassthroughSubject</code> are also useful for creating publishers for objects conforming to <a href="https://developer.apple.com/documentation/combine/observableobject"><code>ObservableObject</code></a>.
This protocol is supported by a number of declarative components within SwiftUI.</p>
</div>
</div>
<div class="sect2">
<h3 id="coreconcepts-subscribers">Subscribers</h3>
<div class="paragraph">
<p>While <a href="https://developer.apple.com/documentation/combine/subscriber"><code>Subscriber</code></a> is the protocol used to receive data throughout a pipeline, <em>the subscriber</em> typically refers to the end of a pipeline.</p>
</div>
<div class="paragraph">
<p>There are two subscribers built-in to Combine: <a href="#reference-assign">Assign</a> and <a href="#reference-sink">Sink</a>.
There is a subscriber built in to SwiftUI: <a href="#reference-onreceive">onReceive</a>.</p>
</div>
<div class="paragraph">
<p>Subscribers can support cancellation, which terminates a subscription and shuts down all the stream processing prior to any Completion sent by the publisher.
Both <code>Assign</code> and <code>Sink</code> conform to the <a href="https://developer.apple.com/documentation/combine/cancellable">Cancellable protocol</a>.</p>
</div>
<div class="paragraph">
<p>When you are storing a reference to your own subscriber in order to clean up later, you generally want a reference to cancel the subscription.
<a href="#reference-anycancellable">AnyCancellable</a> provides a type-erased reference that converts any subscriber to the type AnyCancellable, allowing the use of <code>.cancel()</code> on that reference, but not access to the subscription itself (which could, for instance, request more data).
It is important to store a reference to the subscriber, as when the reference is deallocated it will implicitly cancel its operation.</p>
</div>
<div class="paragraph">
<p><a href="https://developer.apple.com/documentation/combine/subscribers/assign"><code>Assign</code></a> applies values passed down from the publisher to an object defined by a keypath.
The keypath is set when the pipeline is created.
An example of this in Swift might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">signupButton</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://developer.apple.com/documentation/combine/subscribers/sink"><code>Sink</code></a> accepts a closure that receives any resulting values from the publisher.
This allows the developer to terminate a pipeline with their own code.
This subscriber is also extremely helpful when writing unit tests to validate either publishers or pipelines.
An example of this in Swift might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedValue</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"The end result was </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">receivedValue</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Other subscribers are part of other Apple frameworks.
For example, nearly every control in SwiftUI can act as a subscriber.
The <a href="https://developer.apple.com/documentation/swiftui/view/">View protocol</a> in SwiftUI defines an <code>.onReceive(publisher)</code> function to use views as a subscriber.
The <code>onReceive</code> function takes a closure akin to <code>sink</code> that can manipulate <code>@State</code> or <code>@Bindings</code> within SwiftUI.</p>
</div>
<div class="paragraph">
<p>An example of that in SwiftUI might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">struct</span> <span class="kt">MyView</span> <span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>

    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">currentStatusValue</span> <span class="o">=</span> <span class="s">"ok"</span>
    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">Text</span><span class="p">(</span><span class="s">"Current status: </span><span class="se">\(</span><span class="n">currentStatusValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">onReceive</span><span class="p">(</span><span class="kt">MyPublisher</span><span class="o">.</span><span class="n">currentStatusPublisher</span><span class="p">)</span> <span class="p">{</span> <span class="n">newStatus</span> <span class="k">in</span>
                <span class="k">self</span><span class="o">.</span><span class="n">currentStatusValue</span> <span class="o">=</span> <span class="n">newStatus</span>
            <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For any type of UI object (UIKit, AppKit, or SwiftUI), <a href="#reference-assign">Assign</a> can be used with pipelines to update properties.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developingwith">Developing with Combine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A common starting point is composing pipelines, leveraging existing publishers, operators, and subscribers.
A number of examples within this book highlight various patterns, many of which are aimed at providing declarative responses to user inputs within interfaces.</p>
</div>
<div class="paragraph">
<p>You may also want to create APIs that integrate more easily into Combine.
For example, creating a publisher that encapsulates a remote API, returning a single result or a series of results.
Or you might be creating a subscriber to consume and process data over time.</p>
</div>
<div class="sect2">
<h3 id="reasoning-about-pipelines">Reasoning about pipelines</h3>
<div class="paragraph">
<p>When developing with Combine, there are two broader patterns of publishers that frequently recur: expecting a publisher to return a single value and complete and expecting a publisher to return many values over time.</p>
</div>
<div class="paragraph">
<p>The first is what I&#8217;m calling a "one-shot" publisher or pipeline.
These publishers are expected to create a single response (or perhaps no response) and then terminate normally.</p>
</div>
<div class="paragraph">
<p>The second is what I&#8217;m calling a "continuous" publisher.
These publishers and associated pipelines are expected to be always active and providing the means to respond to ongoing events.
In this case, the lifetime of the pipeline is significantly longer, and it is often not desirable to have such pipelines fail or terminate.</p>
</div>
<div class="paragraph">
<p>When you are thinking about your development and how to use Combine, it is often beneficial to think about pipelines as being one of these types, and mixing them together to achieve your goals.
For example, the pattern <a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a> explicitly uses one-shot pipelines to support error handling on a continual pipeline.</p>
</div>
<div class="paragraph">
<p>When you are creating an instance of a publisher or a pipeline, it is worthwhile to be thinking about how you want it to work - to either be a one-shot, or continuous.
This choice will inform how you handle errors or if you want to deal with operators that manipulate the timing of the events (such as <a href="#reference-debounce">debounce</a> or <a href="#reference-throttle">throttle</a>).</p>
</div>
<div class="paragraph">
<p>In addition to how much data the pipeline or publisher will provide, you will often want to think about what type pair the pipeline is expected to provide.
A number of pipelines are more about transforming data through various types, and handling possible error conditions in that processing.
An example of this is returning a pipeline returning a list in the example <a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a> to provide a means to represent an "empty" result, even though the list is never expected to have more than 1 item within it.</p>
</div>
<div class="paragraph">
<p>Ultimately, using Combine types are grounded at both ends; by the originating publisher, and how it is providing data (when it is available), and the subscriber ultimately consuming the data.</p>
</div>
</div>
<div class="sect2">
<h3 id="developingwith-types">Swift types with Combine publishers and subscribers</h3>
<div class="paragraph">
<p>When you compose pipelines within Swift, the chaining of functions results in the type being aggregated as nested generic types.
If you are creating a pipeline, and then wanting to provide that as an API to another part of your code, the type definition for the exposed property or function can be exceptionally (and un-usefully) complex for the developer.</p>
</div>
<div class="paragraph">
<p>To illustrate the exposed type complexity, if you created a publisher from a PassthroughSubject such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">name</span> <span class="k">in</span>
        <span class="k">return</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">promise</span> <span class="k">in</span>
            <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="s">""</span><span class="p">))</span>
            <span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
                <span class="kt">Just</span><span class="p">(</span><span class="s">"No user found"</span><span class="p">)</span>
            <span class="p">}</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
                <span class="k">return</span> <span class="s">"</span><span class="se">\(</span><span class="n">result</span><span class="se">)</span><span class="s"> foo"</span>
        <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting type is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kt">Publishers</span><span class="o">.</span><span class="kt">FlatMap</span><span class="o">&lt;</span><span class="kt">Publishers</span><span class="o">.</span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">Publishers</span><span class="o">.</span><span class="kt">Catch</span><span class="o">&lt;</span><span class="kt">Future</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">Just</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;&gt;</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span><span class="p">,</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When you want to expose the subject, all of that composition detail can be very distracting and make your code harder to use.</p>
</div>
<div class="paragraph">
<p>To clean up that interface, and provide a nice API boundary, there are type-erased classes which can wrap either publishers or subscribers.
These explicitly hide the type complexity that builds up from chained functions in Swift.</p>
</div>
<div class="paragraph">
<p>The two classes used to expose simplified types for subscribers and publishers are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/combine/anysubscriber">AnySubscriber</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/anypublisher">AnyPublisher</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every publisher also inherits a convenience method <code>eraseToAnyPublisher()</code> that returns an instance of AnyPublisher.
<code>eraseToAnyPublisher()</code> is used very much like an operator, often as the last element in a chained pipeline, to simplify the type returned.</p>
</div>
<div class="paragraph">
<p>If you updated the above code to add <code>.eraseToAnyPublisher()</code> at the end of the pipeline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">name</span> <span class="k">in</span>
        <span class="k">return</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">promise</span> <span class="k">in</span>
            <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="s">""</span><span class="p">))</span>
            <span class="p">}</span><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
                <span class="kt">Just</span><span class="p">(</span><span class="s">"No user found"</span><span class="p">)</span>
            <span class="p">}</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
                <span class="k">return</span> <span class="s">"</span><span class="se">\(</span><span class="n">result</span><span class="se">)</span><span class="s"> foo"</span>
        <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting type would simplify to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This same technique can be immensely useful when constructing smaller pipelines within closures.
For example, when you want to return a publisher in the closure for a <a href="#reference-flatmap">flatMap</a> operator, you get simpler reasoning about types by explicitly asserting the closure should expect <code>AnyPublisher</code>.
An example of this can be seen in the pattern <a href="#patterns-sequencing-operations">Sequencing operations with Combine</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="developingwith-threads">Pipelines and threads</h3>
<div class="paragraph">
<p>Combine is not just a single threaded construct.
Operators, as well as publishers, can run on different dispatch queues or runloops.
Composed pipelines can run across a single queue, or transfer across a number of queues or threads.</p>
</div>
<div class="paragraph">
<p>Combine allows for publishers to specify the scheduler used when either receiving from an upstream publisher (in the case of operators), or when sending to a downstream subscriber.
This is critical when working with a subscriber that updates UI elements, as that should always be called on the main thread.</p>
</div>
<div class="paragraph">
<p>For example, you may see this in code as an operator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A number of operators can impact what thread or queue is being used to do the relevant processing.
<a href="#reference-receive">receive</a> and <a href="#reference-subscribe">subscribe</a> are the two most common, explicitly moving execution of operators after and prior to their invocation respectively.</p>
</div>
<div class="paragraph">
<p>A number of additional operators have parameters that include a scheduler.
Examples include <a href="#reference-delay">delay</a>, <a href="#reference-debounce">debounce</a>, and <a href="#reference-throttle">throttle</a>.
These also have an impact on the queue executing the work - both for themselves and then any operators following in a pipeline.
These operators all take a <code>scheduler</code> parameter, which switches to the relevant thread or queue to do the work.
Any operators following them will also be invoked on their scheduler, giving them an impact somewhat like <a href="#reference-receive">receive</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want to be explicit about which thread context an operator or subsequent operation will run within, define it with the <a href="#reference-receive">receive</a> operator.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="leveraging-combine-with-your-development">Leveraging Combine with your development</h3>
<div class="paragraph">
<p>There are two common paths to developing code leveraging Combine.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First is simply leveraging synchronous (blocking) calls within a closure to one of the common operators.
The two most prevalent operators leveraged for this are <a href="#reference-map">map</a> and <a href="#reference-trymap">tryMap</a>, for when your code needs to throw an Error.</p>
</li>
<li>
<p>Second is integrating your own code that is asynchronous, or APIs that provide a completion callback.
If the code you are integrating is asynchronous, then you can&#8217;t (quite) as easily use it within a closure.
You need to wrap the asynchronous code with a structure that the Combine operators can work with and invoke.
In practice, this often implies creating a call that returns a publisher instance, and then using that within the pipeline.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="#reference-future">Future</a> publisher was specifically created to support this kind of integration, and the pattern <a href="#patterns-future">Wrapping an asynchronous call with a Future to create a one-shot publisher</a> shows an example.</p>
</div>
<div class="paragraph">
<p>If you want to use data provided by a publisher as a parameter or input to creating this publisher, there are two common means of enabling this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using the <a href="#reference-flatmap">flatMap</a> operator, using the data passed in to create or return a Publisher instance.
This is a variation of the pattern illustrated in <a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a>.</p>
</li>
<li>
<p>Alternately, <a href="#reference-map">map</a> or <a href="#reference-trymap">tryMap</a> can be used to create an instance of a publisher, followed immediately by chaining <a href="#reference-switchtolatest">switchToLatest</a> to resolve that publisher into a value (or values) to be passed within the pipeline.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The patterns <a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a> and <a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a> illustrate these patterns.</p>
</div>
<div class="paragraph">
<p>You may find it worthwhile to create objects which return a publisher.
Often this enables your code to encapsulate the details of communicating with a remote or network based API.
These can be developed using <a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a> or your own code.
A simple example of this is detailed in the pattern <a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a>.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
</div>
<div class="sect1">
<h2 id="patterns">Patterns and Recipes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Included are a series of patterns and examples of Publishers, Subscribers, and pipelines.
These examples are meant to illustrate how to use the Combine framework to accomplish various tasks.</p>
</div>
<div class="sect2">
<h3 id="patterns-sink-subscriber">Creating a subscriber with sink</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To receive the output, and the errors or completion messages, generated from a publisher or through a pipeline, you can create a subscriber with <a href="#reference-sink">sink</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-sink">sink</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-assign-subscriber">Creating a subscriber with assign</a></p>
</li>
<li>
<p><a href="#patterns-testing-publisher">Testing a publisher with XCTestExpectation</a></p>
</li>
<li>
<p><a href="#patterns-testing-subscriber-scheduled">Testing a subscriber with scheduled sends from PassthroughSubject</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>Sink creates an all-purpose subscriber to capture or react to the data from a Combine pipeline, while also supporting cancellation and the <a href="#coreconcepts-lifecycle">publisher subscriber lifecycle</a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">simple sink</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">cancellablePipeline</span> <span class="o">=</span> <span class="n">publishingSource</span><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="c1">// do what you want with the resulting value passed down</span>
    <span class="c1">// be aware that depending on the publisher, this closure</span>
    <span class="c1">// may be invoked multiple times.</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="n">someValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The simple version of a sink is very compact, with a single trailing closure receiving data when presented through the pipeline.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">sink with completions and data</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">cancellablePipeline</span> <span class="o">=</span> <span class="n">publishingSource</span><span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="k">switch</span> <span class="n">completion</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">finished</span><span class="p">:</span>
        <span class="c1">// no associated data, but you can react to knowing the</span>
        <span class="c1">// request has been completed</span>
        <span class="k">break</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">anError</span><span class="p">):</span>
        <span class="c1">// do what you want with the error details, presenting,</span>
        <span class="c1">// logging, or hiding as appropriate</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"received the error: "</span><span class="p">,</span> <span class="n">anError</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span>
    <span class="c1">// do what you want with the resulting value passed down</span>
    <span class="c1">// be aware that depending on the publisher, this closure</span>
    <span class="c1">// may be invoked multiple times.</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="n">someValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span>

<span class="n">cancellablePipeline</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span> <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Sinks are created by chaining the code from a publisher or pipeline, and provide an end point for the pipeline.
When the sink is created or invoked on a publisher, it implicitly starts <a href="#coreconcepts-lifecycle">the lifecycle</a> with the <code>subscribe</code> method, requesting unlimited data.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sinks are cancellable subscribers. At any time you can take the reference that terminated with sink and invoke <code>.cancel()</code> on it to invalidate and shut down the pipeline.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-assign-subscriber">Creating a subscriber with assign</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To use the results of a pipeline to set a value, often a property on a user interface view or control, but any KVO compliant object can be the provider.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-assign">assign</a></p>
</li>
<li>
<p><a href="#reference-receive">receive</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-sink-subscriber">Creating a subscriber with sink</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>Assign is a subscriber that&#8217;s specifically designed to apply data from a publisher or pipeline into a property, updating that property whenever it receives data.
Like sink, it activates when created and requests an unlimited data.
Assign requires the failure type to be specified as <code>&lt;Never&gt;</code>, so if your pipeline could fail (such as using an operator like tryMap) you will need to <a href="#patterns-general-error-handling">convert or handle the failure cases</a> before using <code>.assign</code>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">simple assign</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">cancellablePipeline</span> <span class="o">=</span> <span class="n">publishingSource</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">yourButton</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>

<span class="n">cancellablePipeline</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>.assign</code> is typically chained onto a publisher when you create it, and the return value is cancellable.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If <code>.assign</code> is being used to update a user interface element, you need to make sure that it is being updated on the main thread. This call makes sure the subscriber is received on the main thread.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Assign references the property being updated using a <a href="https://developer.apple.com/documentation/swift/referencewritablekeypath">key path</a>, and a reference to the object being updated.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>At any time you can cancel to terminate and invalidate pipelines with <code>cancel()</code>. Frequently, you cancel the pipelines when you deactivate the objects (such as a viewController) that are getting updated from the pipeline.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-datataskpublisher-decode">Making a network request with dataTaskPublisher</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>One common use case is requesting JSON data from a URL and decoding it.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#reference-map">map</a></p>
</li>
<li>
<p><a href="#reference-decode">decode</a></p>
</li>
<li>
<p><a href="#reference-sink">sink</a></p>
</li>
<li>
<p><a href="#reference-subscribe">subscribe</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-datataskpublisher-trymap">Stricter request processing with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Retrying in the event of a temporary failure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>This can be readily accomplished with Combine using
<a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a> followed by a series of operators that process the
data.
Minimally, <a href="https://developer.apple.com/documentation/foundation/urlsession/3329708-datataskpublisher">dataTaskPublisher</a> on <a href="https://developer.apple.com/documentation/foundation/urlsession">URLSession</a>
uses <a href="#reference-map">map</a> and <a href="#reference-decode">decode</a> before going to the subscriber.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The simplest case of using this might be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">myURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://postman-echo.com/time/valid?timestamp=2016-10-10"</span><span class="p">)</span>
<span class="c1">// checks the validity of a timestamp - this one returns {"valid":true}</span>
<span class="c1">// matching the data structure returned from https://postman-echo.com/time/valid</span>
<span class="kd">fileprivate</span> <span class="kd">struct</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">Hashable</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="k">let</span> <span class="nv">valid</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">myURL</span><span class="o">!</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="c1">// the dataTaskPublisher output combination is (data: Data, response: URLResponse)</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">data</span> <span class="p">}</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span> <i class="conum" data-value="4"></i><b>(4)</b>

<span class="k">let</span> <span class="nv">cancellableSink</span> <span class="o">=</span> <span class="n">remoteDataPublisher</span>
    <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">completion</span><span class="p">))</span>
            <span class="k">switch</span> <span class="n">completion</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">.</span><span class="nv">finished</span><span class="p">:</span> <i class="conum" data-value="5"></i><b>(5)</b>
                    <span class="k">break</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">anError</span><span class="p">):</span> <i class="conum" data-value="6"></i><b>(6)</b>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"received error: "</span><span class="p">,</span> <span class="n">anError</span><span class="p">)</span>
            <span class="p">}</span>
    <span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span> <i class="conum" data-value="7"></i><b>(7)</b>
        <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="n">someValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">})</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Commonly you will have a struct defined that supports at least <a href="https://developer.apple.com/documentation/swift/decodable">Decodable</a> (if not the full <a href="https://developer.apple.com/documentation/swift/codable">Codable protocol</a>). This struct can be defined to only pull the pieces you are interested in from the JSON provided over the network.
The complete JSON payload does not need to be defined.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>dataTaskPublisher</code> is instantiated from <code>URLSession</code>. You can configure your own options on <code>URLSession</code>, or use a shared session.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The data that is returned is a tuple: <code>(data: Data, response: URLResponse)</code>.
The <a href="#reference-map">map</a> operator is used to get the data and drops the <code>URLResponse</code>, returning just <code>Data</code> down the pipeline.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><a href="#reference-decode">decode</a> is used to load the data and attempt to parse it.
Decode can throw an error itself if the decode fails.
If it succeeds, the object passed down the pipeline will be the struct from the JSON data.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If the decoding completed without errors, the finished completion will be triggered and the value will be passed to the <code>receiveValue</code> closure.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If the a failure happens (either with the original network request or the decoding), the error will be passed into with the <code>failure</code> closure.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Only if the data succeeded with request and decoding will this closure get invoked, and the data format received will be an instance of the struct <code>PostmanEchoTimeStampCheckResponse</code>.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-datataskpublisher-trymap">Stricter request processing with dataTaskPublisher</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>When URLSession makes a connection, it only reports an error if the remote server does not respond.
You may want to consider a number of responses, based on status code, to be errors.
To accomplish this, you can use tryMap to inspect the http response and throw an error in the pipeline.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#reference-trymap">tryMap</a></p>
</li>
<li>
<p><a href="#reference-decode">decode</a></p>
</li>
<li>
<p><a href="#reference-sink">sink</a></p>
</li>
<li>
<p><a href="#reference-subscribe">subscribe</a></p>
</li>
<li>
<p><a href="#reference-maperror">mapError</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-datataskpublisher-decode">Making a network request with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Retrying in the event of a temporary failure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>To have more control over what is considered a failure in the URL response, use a <code>tryMap</code> operator on the tuple response from <code>dataTaskPublisher</code>.
Since <code>dataTaskPublisher</code> returns both the response data and the <code>URLResponse</code> into the pipeline, you can immediately inspect the response and throw an error of your own if desired.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>An example of that might look like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">myURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://postman-echo.com/time/valid?timestamp=2016-10-10"</span><span class="p">)</span>
<span class="c1">// checks the validity of a timestamp - this one returns {"valid":true}</span>
<span class="c1">// matching the data structure returned from https://postman-echo.com/time/valid</span>
<span class="kd">fileprivate</span> <span class="kd">struct</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">Hashable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">valid</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span>
<span class="kd">enum</span> <span class="kt">TestFailureCondition</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">invalidServerResponse</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">myURL</span><span class="o">!</span><span class="p">)</span>
    <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span><span class="p">,</span> <i class="conum" data-value="2"></i><b>(2)</b>
                    <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
                        <span class="k">throw</span> <span class="kt">TestFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span> <i class="conum" data-value="4"></i><b>(4)</b>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">data</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span>

<span class="k">let</span> <span class="nv">cancellableSink</span> <span class="o">=</span> <span class="n">remoteDataPublisher</span>
    <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">completion</span><span class="p">))</span>
            <span class="k">switch</span> <span class="n">completion</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">.</span><span class="nv">finished</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">anError</span><span class="p">):</span>
                    <span class="nf">print</span><span class="p">(</span><span class="s">"received error: "</span><span class="p">,</span> <span class="n">anError</span><span class="p">)</span>
            <span class="p">}</span>
    <span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="n">someValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Where the <a href="#patterns-datataskpublisher-decode">previous pattern</a> used a <a href="#reference-map">map</a> operator, this uses tryMap, which allows us to identify and throw errors in the pipeline based on what was returned.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="#reference-trymap">tryMap</a> still gets the tuple of <code>(data: Data, response: URLResponse)</code>, and is defined here as returning just the type of Data down the pipeline.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Within the closure for <code>tryMap</code>, we can cast the response to <code>HTTPURLResponse</code> and dig deeper into it, including looking at the specific status code.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In this case, we want to consider <strong>anything</strong> other than a 200 response code as a failure. <code>HTTPURLResponse</code>.<code>statusCode</code> is an Int type, so you could also have logic such as <code>httpResponse.statusCode &gt; 300</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the predicates are not met it throws an instance of an error of our choosing; <code>invalidServerResponse</code> in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If no error has occurred, then we simply pass down <code>Data</code> for further processing.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="normalizing-errors-from-a-datataskpublisher">Normalizing errors from a dataTaskPublisher</h4>
<div class="paragraph">
<p>When an error is triggered on the pipeline, a <code>.failure</code> completion is sent with the error encapsulated within it, regardless of where it happened in the pipeline.</p>
</div>
<div class="paragraph">
<p>This pattern can be expanded to return a publisher that accommodates any number of specific error conditions using this general pattern.
In many of the examples, we replace the error conditions with a default value.
If we want to have a function that returns a publisher that <strong>doesn&#8217;t</strong> choose what happens on failure, then the same <a href="#reference-trymap">tryMap</a> operator can be used in conjunction with <a href="#reference-maperror">mapError</a> to translate review the response object as well as convert URLError error types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">enum</span> <span class="kt">APIError</span><span class="p">:</span> <span class="kt">Error</span><span class="p">,</span> <span class="kt">LocalizedError</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="k">case</span> <span class="n">unknown</span><span class="p">,</span> <span class="nf">apiError</span><span class="p">(</span><span class="nv">reason</span><span class="p">:</span> <span class="kt">String</span><span class="p">),</span> <span class="nf">parserError</span><span class="p">(</span><span class="nv">reason</span><span class="p">:</span> <span class="kt">String</span><span class="p">),</span> <span class="nf">networkError</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URLError</span><span class="p">)</span>

    <span class="k">var</span> <span class="nv">errorDescription</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">unknown</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"Unknown error"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">apiError</span><span class="p">(</span><span class="k">let</span> <span class="nv">reason</span><span class="p">),</span> <span class="o">.</span><span class="nf">parserError</span><span class="p">(</span><span class="k">let</span> <span class="nv">reason</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">reason</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">networkError</span><span class="p">(</span><span class="k">let</span> <span class="nv">from</span><span class="p">):</span> <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="k">return</span> <span class="n">from</span><span class="o">.</span><span class="n">localizedDescription</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">fetch</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">,</span> <span class="kt">APIError</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>

    <span class="k">return</span> <span class="kt">URLSession</span><span class="o">.</span><span class="kt">DataTaskPublisher</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="n">request</span><span class="p">,</span> <span class="nv">session</span><span class="p">:</span> <span class="o">.</span><span class="n">shared</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="k">in</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="kt">APIError</span><span class="o">.</span><span class="n">unknown</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">401</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="kt">APIError</span><span class="o">.</span><span class="nf">apiError</span><span class="p">(</span><span class="nv">reason</span><span class="p">:</span> <span class="s">"Unauthorized"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">403</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="kt">APIError</span><span class="o">.</span><span class="nf">apiError</span><span class="p">(</span><span class="nv">reason</span><span class="p">:</span> <span class="s">"Resource forbidden"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">404</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="kt">APIError</span><span class="o">.</span><span class="nf">apiError</span><span class="p">(</span><span class="nv">reason</span><span class="p">:</span> <span class="s">"Resource not found"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">405</span><span class="o">..&lt;</span><span class="mi">500</span> <span class="o">~=</span> <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="kt">APIError</span><span class="o">.</span><span class="nf">apiError</span><span class="p">(</span><span class="nv">reason</span><span class="p">:</span> <span class="s">"client error"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">500</span><span class="o">..&lt;</span><span class="mi">600</span> <span class="o">~=</span> <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="kt">APIError</span><span class="o">.</span><span class="nf">apiError</span><span class="p">(</span><span class="nv">reason</span><span class="p">:</span> <span class="s">"server error"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="n">mapError</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span> <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="c1">// if it's our kind of error already, we can return it directly</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="k">as?</span> <span class="kt">APIError</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">error</span>
            <span class="p">}</span>
            <span class="c1">// if it is a TestExampleError, convert it into our new error type</span>
            <span class="k">if</span> <span class="n">error</span> <span class="k">is</span> <span class="kt">TestExampleError</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kt">APIError</span><span class="o">.</span><span class="nf">parserError</span><span class="p">(</span><span class="nv">reason</span><span class="p">:</span> <span class="s">"Our example error"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="c1">// if it is a URLError, we can convert it into our more general error kind</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">urlerror</span> <span class="o">=</span> <span class="n">error</span> <span class="k">as?</span> <span class="kt">URLError</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kt">APIError</span><span class="o">.</span><span class="nf">networkError</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">urlerror</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="c1">// if all else fails, return the unknown error condition</span>
            <span class="k">return</span> <span class="kt">APIError</span><span class="o">.</span><span class="n">unknown</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span> <i class="conum" data-value="6"></i><b>(6)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>APIError</code> is a Error enumeration that we are using in this example to collect all the variant errors that can occur.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>.networkError</code> is one of the specific cases of <code>APIError</code> that we will translate into when <a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a> returns an error.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We start the generation of this publisher with a standard dataTaskPublisher.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We then route into the <a href="#reference-trymap">tryMap</a> operator to inspect the response, creating specific error conditions based on the server response.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>And finally we use <a href="#reference-maperror">mapError</a> to convert any lingering error types down into a common Failure type of <code>APIError</code>.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="patterns-future">Wrapping an asynchronous call with a Future to create a one-shot publisher</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Using <code>Future</code> to turn an asynchronous call into publisher to use the result in a Combine pipeline.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-future">Future</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-delegate-publisher-subject">Creating a repeating publisher by wrapping a delegate based API</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">Contacts</span>
<span class="k">let</span> <span class="nv">futureAsyncPublisher</span> <span class="o">=</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">promise</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="kt">CNContactStore</span><span class="p">()</span><span class="o">.</span><span class="nf">requestAccess</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">contacts</span><span class="p">)</span> <span class="p">{</span> <span class="n">grantedAccess</span><span class="p">,</span> <span class="n">err</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="c1">// err is an optional</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">err</span> <span class="o">=</span> <span class="n">err</span> <span class="p">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="k">return</span> <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">grantedAccess</span><span class="p">))</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Future</code> itself has you define the return types and takes a closure.
It hands in a <code>Result</code> object matching the type description, which you interact.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can invoke the async API however is relevant, including passing in its required closure.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Within the completion handler, you determine what would cause a failure or a success.
A call to <code>promise(.failure(&lt;FailureType&gt;))</code> returns the failure.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Or a call to <code>promise(.success(&lt;OutputType&gt;))</code> returns a value.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A <a href="#reference-future">Future</a> immediately calls the enclosed asynchronous API call when it is created, <strong>not</strong> when it receives a subscription demand.
This may not be the behavior you want or need.
If you want the call to be bound to subscribers requesting data, you probably want to wrap the Future with <a href="#reference-deferred">Deferred</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to return a resolved promise as a <code>Future</code> publisher, you can do so by immediately returning the result you desire its closure.</p>
</div>
<div class="paragraph">
<p>The following example returns a single value as a success, with a boolean <code>true</code> value.
You could just as easily return <code>false</code>, and the publisher would still act as a successful promise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">resolvedSuccessAsPublisher</span> <span class="o">=</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">promise</span> <span class="k">in</span>
    <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="kc">true</span><span class="p">))</span>
<span class="p">}</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An example of returning a <code>Future</code> publisher that immediately resolves as an error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">enum</span> <span class="kt">ExampleFailure</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">oneCase</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">resolvedFailureAsPublisher</span> <span class="o">=</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">promise</span> <span class="k">in</span>
    <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="kt">ExampleFailure</span><span class="o">.</span><span class="n">oneCase</span><span class="p">))</span>
<span class="p">}</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-sequencing-operations">Sequencing asynchronous operations</h3>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To explicitly order asynchronous operations with a Combine pipeline</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is similar to a concept called "promise chaining".
While you can arrange combine such that it acts similarly, it is likely not a good replacement for using a promise library.
The primary difference is that promise libraries always deal with a single result per promise, and a Combine brings along the complexity of needing to handle the possibility of many values.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-future">Future</a></p>
</li>
<li>
<p><a href="#reference-flatmap">flatMap</a></p>
</li>
<li>
<p><a href="#reference-zip">zip</a></p>
</li>
<li>
<p><a href="#reference-sink">sink</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-delegate-publisher-subject">Creating a repeating publisher by wrapping a delegate based API</a></p>
</li>
<li>
<p>The ViewController with this code is in the github project at <a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/AsyncCoordinatorViewController.swift">UIKit-Combine/AsyncCoordinatorViewController.swift</a>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>Any asynchronous (or synchronous) set of tasks that need to happen in a specific order can also be coordinated using a Combine pipeline.
By using <a href="#reference-future">Future</a> operator, the act of completing an asynchronous call can be captured, and sequencing operators provides the structure of that coordination.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>By wrapping any asynchronous API calls with the <a href="#reference-future">Future</a> publisher and then chaining them together with the <a href="#reference-flatmap">flatMap</a> operator, you invoke the wrapped asynchronous API calls in a specific order.
Multiple parallel asynchronous efforts can be created by creating multiple pipelines, with <a href="#reference-future">Future</a> or another publisher, and waiting for the pipelines to complete in parallel by merging them together with the <a href="#reference-zip">zip</a> operator.</p>
</div>
<div class="paragraph">
<p>If you want force an <a href="#reference-future">Future</a> publisher to not be invoked until another has completed, then creating the future publisher in the <a href="#reference-flatmap">flatMap</a> closure causes it to wait to be created until a value has been passed to the flatMap operator.</p>
</div>
<div class="paragraph">
<p>These techniques can be composed to create any structure of parallel or serial tasks.</p>
</div>
<div class="paragraph">
<p>This technique of coordinating asynchronous calls can be especially effective if later tasks need data from earlier tasks.
In those cases, the data results needed can be passed directly the pipeline.</p>
</div>
<div class="paragraph">
<p>An example of this sequencing follows below.
In this example, buttons (arranged visually to show the ordering of actions) are highlighted when they complete.
The whole sequence is triggered by a separate button action, which also resets the state of all the buttons and cancels any existing running sequence if it&#8217;s not yet finished.
In this example, the asynchronous API call is a call that simply takes a random amount of time to complete to provide an example of how the timing works.</p>
</div>
<div class="paragraph">
<p>The workflow that is created is represented in steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>step 1 runs first.</p>
</li>
<li>
<p>step 2 has three parallel efforts, running after step 1 completes.</p>
</li>
<li>
<p>step 3 waits to start until all three elements of step 2 complete.</p>
</li>
<li>
<p>step 4 runs after step 3 has completed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, there is an activity indicator that is triggered to start animating when the sequence begins, stopping when step 4 has completed.</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/AsyncCoordinatorViewController.swift">UIKit-Combine/AsyncCoordinatorViewController.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">Combine</span>

<span class="kd">class</span> <span class="kt">AsyncCoordinatorViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">startButton</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>

    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">step1_button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">step2_1_button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">step2_2_button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">step2_3_button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">step3_button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">step4_button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">activityIndicator</span><span class="p">:</span> <span class="kt">UIActivityIndicatorView</span><span class="o">!</span>

    <span class="k">var</span> <span class="nv">cancellable</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">coordinatedPipeline</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">?</span>

    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">doit</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">Any</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">runItAll</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">runItAll</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">cancellable</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Cancelling existing run"</span><span class="p">)</span>
            <span class="n">cancellable</span><span class="p">?</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span>
            <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"resetting all the steps"</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">resetAllSteps</span><span class="p">()</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="c1">// driving it by attaching it to .sink</span>
        <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">startAnimating</span><span class="p">()</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="nf">print</span><span class="p">(</span><span class="s">"attaching a new sink to start things going"</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">cancellable</span> <span class="o">=</span> <span class="n">coordinatedPipeline</span><span class="p">?</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="o">.</span><span class="nf">print</span><span class="p">()</span>
            <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion: "</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">completion</span><span class="p">))</span>
                <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>
            <span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received value: "</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="p">})</span>
    <span class="p">}</span>
    <span class="c1">// MARK: - helper pieces that would normally be in other files</span>

    <span class="c1">// this emulates an async API call with a completion callback</span>
    <span class="c1">// it does nothing other than wait and ultimately return with a boolean value</span>
    <span class="kd">func</span> <span class="nf">randomAsyncAPI</span><span class="p">(</span><span class="n">completion</span> <span class="nv">completionBlock</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">((</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">))</span> <span class="p">{</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">global</span><span class="p">(</span><span class="nv">qos</span><span class="p">:</span> <span class="o">.</span><span class="n">background</span><span class="p">)</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
            <span class="nf">sleep</span><span class="p">(</span><span class="o">.</span><span class="nf">random</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">1</span><span class="o">...</span><span class="mi">4</span><span class="p">))</span>
            <span class="nf">completionBlock</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// Creates and returns pipeline that uses a Future to wrap randomAsyncAPI</span>
    <span class="c1">/// and then updates a UIButton to represent the completion of the async</span>
    <span class="c1">/// work before returning a boolean True.</span>
    <span class="c1">/// - Parameter button: button to be updated</span>
    <span class="kd">func</span> <span class="nf">createFuturePublisher</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="k">return</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">promise</span> <span class="k">in</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">randomAsyncAPI</span><span class="p">()</span> <span class="p">{</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="k">in</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">err</span> <span class="o">=</span> <span class="n">err</span> <span class="p">{</span>
                    <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
            <span class="c1">// so that we can update UI elements to show the "completion"</span>
            <span class="c1">// of this step</span>
        <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">inValue</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span> <i class="conum" data-value="6"></i><b>(6)</b>
            <span class="c1">// intentionally side effecting here to show progress of pipeline</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">markStepDone</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="n">button</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">/// highlights a button and changes the background color to green</span>
    <span class="c1">/// - Parameter button: reference to button being updated</span>
    <span class="kd">func</span> <span class="nf">markStepDone</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">button</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">systemGreen</span>
        <span class="n">button</span><span class="o">.</span><span class="n">isHighlighted</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">resetAllSteps</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="n">button</span> <span class="k">in</span> <span class="p">[</span><span class="k">self</span><span class="o">.</span><span class="n">step1_button</span><span class="p">,</span> <span class="k">self</span><span class="o">.</span><span class="n">step2_1_button</span><span class="p">,</span> <span class="k">self</span><span class="o">.</span><span class="n">step2_2_button</span><span class="p">,</span> <span class="k">self</span><span class="o">.</span><span class="n">step2_3_button</span><span class="p">,</span> <span class="k">self</span><span class="o">.</span><span class="n">step3_button</span><span class="p">,</span> <span class="k">self</span><span class="o">.</span><span class="n">step4_button</span><span class="p">]</span> <span class="p">{</span>
            <span class="n">button</span><span class="p">?</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">lightGray</span>
            <span class="n">button</span><span class="p">?</span><span class="o">.</span><span class="n">isHighlighted</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">// MARK: - view setup</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>

        <span class="c1">// Do any additional setup after loading the view.</span>

        <span class="n">coordinatedPipeline</span> <span class="o">=</span> <span class="nf">createFuturePublisher</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">step1_button</span><span class="p">)</span> <i class="conum" data-value="7"></i><b>(7)</b>
            <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">flatMapInValue</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">step2_1</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">createFuturePublisher</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">step2_1_button</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">step2_2</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">createFuturePublisher</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">step2_2_button</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">step2_3</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">createFuturePublisher</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">step2_3_button</span><span class="p">)</span>
            <span class="k">return</span> <span class="kt">Publishers</span><span class="o">.</span><span class="kt">Zip3</span><span class="p">(</span><span class="n">step2_1</span><span class="p">,</span> <span class="n">step2_2</span><span class="p">,</span> <span class="n">step2_3</span><span class="p">)</span>
                <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">_</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
                    <span class="k">return</span> <span class="kc">true</span>
                <span class="p">}</span>
                <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="nf">createFuturePublisher</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">step3_button</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
            <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="nf">createFuturePublisher</span><span class="p">(</span><span class="nv">button</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">step4_button</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>runItAll</code> coordinates the operation of this workflow, starting with checking to see if one is currently running.
If defined, it invokes <code>cancel()</code> on the existing subscriber.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>resetAllSteps</code> iterates through all the existing buttons used represent the progress of this workflow, and resets them to gray and unhighlighted to reflect an initial state.
It also verifies that the activity indicator is not currently animated.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Then we get things started, first with activating the animation on the activity indicator.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creating the subscriber with <a href="#reference-sink">sink</a> and storing the reference initiates the workflow.
The publisher to which it is subscribing is setup outside this function, allowing it to be re-used multiple times.
The <a href="#reference-print">print</a> operator in the pipeline is for debugging, showing console output when the pipeline is triggered.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Each step is represented by the invocation of a <a href="#reference-future">Future</a> publisher, followed immediately by pipeline elements to switch to the main thread and then update a UIButton&#8217;s background to show the step has completed.
This is encapsulated in a <code>createFuturePublisher</code> call, using <a href="#reference-erasetoanypublisher">eraseToAnyPublisher</a> to simplify the type being returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <a href="#reference-map">map</a> operator is used to create this specific side effect of updating the a UIButton to show the step has been completed.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The creation of the overall pipeline and its structure of serial and parallel tasks is created from the combination of calls to <code>createFuturePublisher</code> using the operators <a href="#reference-flatmap">flatMap</a> and  <a href="#reference-zip">zip</a>.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect2">
<h3 id="patterns-general-error-handling">Error Handling</h3>
<div class="paragraph">
<p>Previous examples above expect that the subscriber would handle the error conditions, if they occurred.
However, you are not always able to control what the subscriber requires - as might be the case if you are using SwiftUI.
In these cases, you need to build your pipeline so that the output types match the subscriber types.
This implies that you are handling any errors within the pipeline.</p>
</div>
<div class="paragraph">
<p>For example, if you are working with SwiftUI and the you want to use <a href="#reference-assign">assign</a> to set the <code>isEnabled</code> property on a button, the subscriber will have a few requirements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the subscriber should match the type output of <code>&lt;Bool, Never&gt;</code></p>
</li>
<li>
<p>the subscriber should be called on the main thread</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>With a publisher that can throw an error (such as <a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a>), you need to construct a pipeline to convert the output type, but also handle the error within the pipeline to match a failure type of <code>&lt;Never&gt;</code>.</p>
</div>
<div class="paragraph">
<p>How you handle the errors within a pipeline is dependent on how the pipeline is defined.
If the pipeline is set up to return a single result and terminate, a good example is <a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a>.
If the pipeline is set up to continually update, the error handling needs to be a little more complex.
In this case, look at the example <a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a>.</p>
</div>
<div class="sect3">
<h4 id="patterns-assertnofailure">Verifying a failure hasn&#8217;t happened using assertNoFailure</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Verify no error has occurred within a pipeline</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-assertnofailure">assertNoFailure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-catch">catch</a></p>
</li>
<li>
<p><a href="#reference-flatmap">flatMap</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>Useful in testing invariants in pipelines, the assertNoFailure operator also converts the failure type to <code>&lt;Never&gt;</code>.
The operator will cause the application to terminate (or tests to crash to a debugger) if the assertion is triggered.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This is useful for verifying the invariant of having dealt with an error.
If you are sure you handled the errors and need to map a pipeline which technically can generate a failure type of <code>&lt;Error&gt;</code> to a subscriber that requires a failure type of <code>&lt;Never&gt;</code>.</p>
</div>
<div class="paragraph">
<p>It is far more likely that you want to handle the error with and not have the application terminate.
Look forward to <a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a> and <a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a> for patterns of how to provide logic to handle errors in a pipeline.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>If you need to handle a failure within a pipeline, for example before using the <code>assign</code> operator or another operator that requires the failure type to be <code>&lt;Never&gt;</code>, you can use <code>catch</code> to provide the appropriate logic.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-catch">catch</a></p>
</li>
<li>
<p><a href="#reference-just">Just</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-retry">Retrying in the event of a temporary failure</a></p>
</li>
<li>
<p><a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a></p>
</li>
<li>
<p><a href="#patterns-constrained-network">Requesting data from an alternate URL when the network is constrained</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p><a href="#reference-catch">catch</a> handles errors by replacing the upstream publisher with another publisher that you provide as a return in a closure.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Be aware that this effectively terminates the pipeline.
If you&#8217;re using a one-shot publisher (one that doesn&#8217;t create more than a single event), then this is fine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, <a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a> is a one-shot publisher and you might use catch with it to ensure that you get a response, returning a placeholder in the event of an error.
Extending our previous example to provide a default response:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">struct</span> <span class="kt">IPInfo</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="c1">// matching the data structure returned from ip.jsontest.com</span>
    <span class="k">var</span> <span class="nv">ip</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">myURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"http://ip.jsontest.com"</span><span class="p">)</span>
<span class="c1">// NOTE(heckj): you'll need to enable insecure downloads in your Info.plist for this example</span>
<span class="c1">// since the URL scheme is 'http'</span>

<span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">myURL</span><span class="o">!</span><span class="p">)</span>
    <span class="c1">// the dataTaskPublisher output combination is (data: Data, response: URLResponse)</span>
    <span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="p">(</span><span class="n">inputTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span>
        <span class="k">return</span> <span class="n">inputTuple</span><span class="o">.</span><span class="n">data</span>
    <span class="p">})</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">IPInfo</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="k">return</span> <span class="kt">Publishers</span><span class="o">.</span><span class="kt">Just</span><span class="p">(</span><span class="kt">IPInfo</span><span class="p">(</span><span class="nv">ip</span><span class="p">:</span> <span class="s">"8.8.8.8"</span><span class="p">))</span><i class="conum" data-value="3"></i><b>(3)</b>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Often, a catch operator will be placed after several operators that could fail, in order to provide a fallback or placeholder in the event that any of the possible previous operations failed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When using catch, you get the error type in and can inspect it to choose how you provide a response.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The Just publisher is frequently used to either start another one-shot pipeline or to directly provide a placeholder response in the event of failure.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A possible problem with this technique is that the if the original publisher generates more values to which you wish to react, the original pipeline has been ended.
If you are creating a pipeline that reacts to a <a href="#reference-published">@Published</a> property, then after any failed value that activates the catch operator, the pipeline will cease to react further.
See <a href="#reference-catch">catch</a> for more details of how this works.</p>
</div>
<div class="paragraph">
<p>If you want to continue to respond to errors and handle them, see the pattern <a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a>.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-retry">Retrying in the event of a temporary failure</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <a href="#reference-retry">retry</a> operator can be included in a pipeline to retry a subscription when a <code>.failure</code> completion occurs.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-catch">catch</a></p>
</li>
<li>
<p><a href="#reference-retry">retry</a></p>
</li>
<li>
<p><a href="#reference-delay">delay</a></p>
</li>
<li>
<p><a href="#reference-trymap">tryMap</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>When requesting data from a <code>dataTaskPublisher</code>, the request may fail.
In that case you will receive a <code>.failure</code> completion with an error.
When it fails, the <a href="#reference-retry">retry</a> operator will let you retry that same request for a set number of attempts.
The <code>retry</code> operator passes through the resulting values when the publisher does not send a <code>.failure</code> completion.
<code>retry</code> only reacts within a combine pipeline when a <code>.failure</code> completion is sent.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When <code>retry</code> receives a <code>.failure</code> completion, the way it retries is by recreating the subscription to the operator or publisher to which  it was chained.</p>
</div>
<div class="paragraph">
<p>The <a href="#reference-retry">retry</a> operator is commonly desired when attempting to request network resources with an unstable connection, or other situations where the request might succeed if the request happens again.
If the number of retries specified all fail, then the <code>.failure</code> completion is passed down to the subscriber.</p>
</div>
<div class="paragraph">
<p>In our example below, we are using retry in combination with a <a href="#reference-delay">delay</a> operator.
Our use of the delay operator puts a small random delay before the next request.
This spaces out the retry attempts, so that the retries do not happen in quick succession.</p>
</div>
<div class="paragraph">
<p>This example also includes the use of the <a href="#reference-trymap">tryMap</a> operator to more fully inspect any URLResponse returned from the <code>dataTaskPublisher</code>.
Any response from the server is encapsulated by <code>URLSession</code>, and passed forward as a valid response.
<code>URLSession</code> does not treat a <em>404 Not Found</em> http response as an error response, nor any of the <em>50x</em> error codes.
Using <code>tryMap</code> lets us inspect the response code that was sent, and verify that it was a 200 response code.
In this example, if the response code is anything but a 200 response, it throws an exception - which in turn causes the tryMap operator to pass down a <code>.failure</code> completion rather than data.
This example sets the <code>tryMap</code> <strong>after</strong> the retry operator so that retry will only re-attempt the request when the site didn&#8217;t respond.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="n">urlSession</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="kt">URL</span><span class="o">!</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">delay</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">DispatchQueue</span><span class="o">.</span><span class="kt">SchedulerTimeType</span><span class="o">.</span><span class="kt">Stride</span><span class="p">(</span><span class="nv">integerLiteral</span><span class="p">:</span> <span class="kt">Int</span><span class="o">.</span><span class="nf">random</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="mi">1</span><span class="o">..&lt;</span><span class="mi">5</span><span class="p">)),</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="nf">retry</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span><span class="p">,</span>
            <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="kt">TestFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span>
    <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="#reference-delay">delay</a> operator will hold the results flowing through the pipeline for a short duration, in this case for a random selection of 1 to 5 seconds. By adding delay here in the pipeline, it will always occur, even if the original request is successful.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Retry is specified as trying 3 times.
This will result in a total of four attempts if each fails - the original request and 3 additional attempts.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>tryMap is being used to inspect the data result from dataTaskPublisher and return a <code>.failure</code> completion if the response from the server is valid, but not a 200 HTTP response code.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When using the <a href="#reference-retry">retry</a> operator with <a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a>, verify that the URL you are requesting isn&#8217;t going to have negative side effects if requested repeatedly or with a retry.
Ideally such requests are be expected to be idempotent.
If they are not, the <a href="#reference-retry">retry</a> operator may make multiple requests, with very unexpected side effects.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-continual-error-handling">Using flatMap and catch to handle errors without cancelling the pipeline</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The <code>flatMap</code> operator can be used with <code>catch</code> to continue to handle errors on new published values.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-flatmap">flatMap</a></p>
</li>
<li>
<p><a href="#reference-just">Just</a></p>
</li>
<li>
<p><a href="#reference-catch">catch</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Retrying in the event of a temporary failure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>The <code>flatMap</code> operator is the operator to use in handling errors on a continual flow of events.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You provide a closure to <code>flatMap</code> that can read in the value that was provided, and creates a one-shot publisher that does the possibly failing work.
An example of this is requesting data from a network and then decoding the returned data.
You can include a <a href="#reference-catch">catch</a> operator to capture any errors and provide an appropriate value.</p>
</div>
<div class="paragraph">
<p>This is a perfect mechanism for when you want to maintain updates up an upstream publisher, as it creates one-shot publisher or short pipelines that send a single value and then complete for every incoming value.
The completion from the created one-shot publishers terminates in the flatMap and is not passed to downstream subscribers.</p>
</div>
<div class="paragraph">
<p>An example of this with a <code>dataTaskPublisher</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">testURL</span><span class="o">!</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">url</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span><span class="p">,</span>
                <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="kt">TestFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="o">.</span><span class="k">catch</span> <span class="p">{</span><span class="n">_</span> <span class="k">in</span> <i class="conum" data-value="6"></i><b>(6)</b>
            <span class="k">return</span> <span class="kt">Just</span><span class="p">(</span><span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">(</span><span class="nv">valid</span><span class="p">:</span> <span class="kc">false</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Just</code> starts this publisher as an example by passing in a URL.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>flatMap</code> takes the URL as input and the closure goes on to create a one-shot publisher pipeline.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>dataTaskPublisher</code> uses the input url to make the request.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The result output ( a tuple of <code>(Data, URLResponse)</code> ) flows into <code>tryMap</code> to be parsed for additional errors.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><code>decode</code> attempts to refine the returned data into a locally defined type.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>If any of this has failed, <code>catch</code> will convert the error into a placeholder sample.
In this case an object with a preset <code>valid = false</code> property.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-constrained-network">Requesting data from an alternate URL when the network is constrained</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>From Apple&#8217;s WWDC 2019 presentation <a href="https://developer.apple.com/videos/play/wwdc2019/712/">Advances in Networking, Part 1</a>, a sample pattern was provided using <code>tryCatch</code> and <code>tryMap</code> operators to react to the specific error of the network being constrained.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#reference-trycatch">tryCatch</a></p>
</li>
<li>
<p><a href="#reference-trymap">tryMap</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Retrying in the event of a temporary failure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="c1">// Generalized Publisher for Adaptive URL Loading</span>
<span class="kd">func</span> <span class="nf">adaptiveLoader</span><span class="p">(</span><span class="nv">regularURL</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">lowDataURL</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Data</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">regularURL</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="n">request</span><span class="o">.</span><span class="n">allowsConstrainedNetworkAccess</span> <span class="o">=</span> <span class="kc">false</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="k">return</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="o">.</span><span class="n">tryCatch</span> <span class="p">{</span> <span class="n">error</span> <span class="o">-&gt;</span> <span class="kt">URLSession</span><span class="o">.</span><span class="kt">DataTaskPublisher</span> <span class="k">in</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="k">guard</span> <span class="n">error</span><span class="o">.</span><span class="n">networkUnavailableReason</span> <span class="o">==</span> <span class="o">.</span><span class="n">constrained</span> <span class="k">else</span> <span class="p">{</span>
               <span class="k">throw</span> <span class="n">error</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">lowDataURL</span><span class="p">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPUrlResponse</span><span class="p">,</span> <i class="conum" data-value="6"></i><b>(6)</b>
                   <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">{</span>
                       <span class="k">throw</span> <span class="kt">MyNetworkingError</span><span class="o">.</span><span class="n">invalidServerResponse</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">data</span>
<span class="p">}</span>
<span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span> <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>This example, from Apple&#8217;s WWDC, provides a function that takes two URLs - a primary and a fallback.
It returns a publisher that will request data and fall back requesting a secondary URL when the network is constrained.</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The request starts with an attempt requesting data.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Setting <code>request.allowsConstrainedNetworkAccess</code> will cause the <code>dataTaskPublisher</code> to error if the network is constrained.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Invoke the <code>dataTaskPublisher</code> to make the request.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>tryCatch</code> is used to capture the immediate error condition and check for a specific error (the constrained network).</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If it finds an error, it creates a new one-shot publisher with the fall-back URL.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The resulting publisher can still fail, and <code>tryMap</code> can map this a failure by throwing an error on HTTP response codes that map to error conditions</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><code>eraseToAnyPublisher</code> enables type erasure on the chain of operators so the resulting signature of the adaptiveLoader function is <code>AnyPublisher&lt;Data, Error&gt;</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the sample, if the error returned from the original request wasn&#8217;t an issue of the network being constrained, it passes on the <code>.failure</code> completion down the pipeline.
If the error is that the network is constrained, then the <code>tryCatch</code> operator creates a new request to an alternate URL.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="patterns-uikit-integration">UIKit or AppKit Integration</h3>
<div class="sect3">
<h4 id="patterns-update-interface-userinput">Declarative UI updates from user input</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Querying a web based API and returning the data to be displayed in your UI</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The Xcode project ViewController with this code is in the github project at <a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/GithubViewController.swift"><code>UIKit-Combine/GithubViewController.swift</code></a></p>
</li>
<li>
<p>Publishers:
<a href="#reference-published">@Published</a>,
<a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a></p>
</li>
<li>
<p>Operators:
<a href="#reference-map">map</a>,
<a href="#reference-switchtolatest">switchToLatest</a>,
<a href="#reference-receive">receive</a>,
<a href="#reference-throttle">throttle</a>,
<a href="#reference-removeduplicates">removeDuplicates</a></p>
</li>
<li>
<p>Subscribers:
<a href="#reference-assign">assign</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-datataskpublisher-trymap">Stricter request processing with dataTaskPublisher</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>One of the primary benefits of a framework like Combine is setting up a declarative structure that defines how an interface will update to user input.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A pattern for integrating Combine with UIKit is setting up a variable which will hold a reference to the updated state, and linking the controls using IBAction.</p>
</div>
<div class="paragraph">
<p>The sample is a portion of the code at in a larger view controller implementation.</p>
</div>
<div class="paragraph">
<p>This example overlaps with the next pattern <a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a>, which builds upon the initial publisher.</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/GithubAPI.swift">UIKit-Combine/GithubAPI.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">Combine</span>

<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">github_id_entry</span><span class="p">:</span> <span class="kt">UITextField</span><span class="o">!</span> <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="k">var</span> <span class="nv">usernameSubscriber</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>

    <span class="c1">// username from the github_id_entry field, updated via IBAction</span>
    <span class="c1">// @Published is creating a publisher $username of type &lt;String, Never&gt;</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span> <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="c1">// github user retrieved from the API publisher. As it's updated, it</span>
    <span class="c1">// is "wired" to update UI elements</span>
    <span class="kd">@Published</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">githubUserData</span><span class="p">:</span> <span class="p">[</span><span class="kt">GithubAPIUser</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">// MARK - Actions</span>

    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">githubIdChanged</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UITextField</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span> <span class="p">??</span> <span class="s">""</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Set username to "</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="c1">// Do any additional setup after loading the view.</span>

        <span class="n">usernameSubscriber</span> <span class="o">=</span> <span class="err">$</span><span class="n">username</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="o">.</span><span class="nf">throttle</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">myBackgroundQueue</span><span class="p">,</span> <span class="nv">latest</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="c1">// ^^ scheduler myBackGroundQueue publishes resulting elements</span>
            <span class="c1">// into that queue, resulting on this processing moving off the</span>
            <span class="c1">// main runloop.</span>
            <span class="o">.</span><span class="nf">removeDuplicates</span><span class="p">()</span> <i class="conum" data-value="6"></i><b>(6)</b>
            <span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"username pipeline: "</span><span class="p">)</span> <span class="c1">// debugging output for pipeline</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">username</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">GithubAPIUser</span><span class="p">],</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="k">in</span> <i class="conum" data-value="7"></i><b>(7)</b>
                <span class="k">return</span> <span class="kt">GithubAPI</span><span class="o">.</span><span class="nf">retrieveGithubUser</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="c1">// ^^ type returned by retrieveGithubUser is a Publisher, so we use</span>
            <span class="c1">// switchToLatest to resolve the publisher to its value</span>
            <span class="c1">// to return down the chain, rather than returning a</span>
            <span class="c1">// publisher down the pipeline.</span>
            <span class="o">.</span><span class="nf">switchToLatest</span><span class="p">()</span> <i class="conum" data-value="8"></i><b>(8)</b>
            <span class="c1">// using a sink to get the results from the API search lets us</span>
            <span class="c1">// get not only the user, but also any errors attempting to get it.</span>
            <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">githubUserData</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span> <i class="conum" data-value="9"></i><b>(9)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>UITextField</code> is the interface element which is driving the updates from user interaction.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We defined a <a href="#reference-published">@Published</a> property to both hold the data and reflect updates when they happen.
Because its a <code>@Published</code> property, it provides a publisher that we can use with Combine pipelines to update other variables or elements of the interface.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We set the variable <code>username</code> from within an IBAction, which in turn triggers a data flow if the publisher <code>$username</code> has any subscribers.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We in turn set up a subscriber on the publisher <code>$username</code> that does further actions.
In this case it uses updated values of <code>username</code> to retrieves an instance of a GithubAPIUser from Github&#8217;s REST API.
It will make a new HTTP request to the every time the username value is updated.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <a href="#reference-throttle">throttle</a> is there to keep from triggering a network request on every possible edit of the text field.
The throttle keeps it to a maximum of 1 request every half-second.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><a href="#reference-removeduplicates">removeDuplicates</a> collapses events from the changing username so that API requests are not made on the same value twice in a row.
The <code>removeDuplicates</code> prevents redundant requests from being made, should the user edit and the return the previous value.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>map is used similarly to flatMap in error handling here, returning an instance of a publisher.
The API object returns a publisher, which this map is invoking.
This doesn&#8217;t return the value from the call, but the publisher itself.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><a href="#reference-switchtolatest">switchToLatest</a> operator takes the instance of the publisher and resolves out the data.
<code>switchToLatest</code> resolves a publisher into a value and passes that value down the pipeline, in this case an instance of <code>[GithubAPIUser]</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>And <code>assign</code> at the end up the pipeline is the subscriber, which assigns the value into another variable: <code>githubUserData</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The pattern <a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a> expands upon this code to multiple cascading updates of various UI elements.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-cascading-update-interface">Cascading multiple UI updates, including a network request</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Have multiple UI elements update triggered by an upstream subscriber</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The ViewController with this code is in the github project at <a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/GithubViewController.swift">UIKit-Combine/GithubViewController.swift</a>.
You can see this code in operation by running the UIKit target within the github project.</p>
</li>
<li>
<p>The GithubAPI is in the github project at <a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/GithubAPI.swift">UIKit-Combine/GithubAPI.swift</a></p>
</li>
<li>
<p>Publishers:
<a href="#reference-published">@Published</a>,
<a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a>,
<a href="#reference-just">Just</a>,
<a href="#reference-empty">Empty</a></p>
</li>
<li>
<p>Operators:
<a href="#reference-decode">decode</a>,
<a href="#reference-catch">catch</a>,
<a href="#reference-map">map</a>,
<a href="#reference-trymap">tryMap</a>,
<a href="#reference-switchtolatest">switchToLatest</a>,
<a href="#reference-filter">filter</a>,
<a href="#reference-handleevents">handleEvents</a>,
<a href="#reference-subscribe">subscribe</a>,
<a href="#reference-receive">receive</a>,
<a href="#reference-throttle">throttle</a>,
<a href="#reference-removeduplicates">removeDuplicates</a></p>
</li>
<li>
<p>Subscribers:
<a href="#reference-sink">sink</a>,
<a href="#reference-assign">assign</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-datataskpublisher-trymap">Stricter request processing with dataTaskPublisher</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>The example provided expands on a publisher updating from <a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a>, adding additional Combine pipelines to update multiple UI elements as someone interacts with the provided interface.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The general pattern of this view starts with a textfield that accepts user input, from which the following actions flow:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using an IBAction the <a href="#reference-published">@Published</a> <code>username</code> variable is updated.</p>
</li>
<li>
<p>We have a subscriber (<code>usernameSubscriber</code>) attached <code>$username</code> publisher, which publishes the value on change and attempts to retrieve the GitHub user.
The resulting variable <code>githubUserData</code> (also <a href="#reference-published">@Published</a>) is a list of GitHub user objects.
Even though we only expect a single value here, we use a list because we can conveniently return an empty list on failure scenarios: unable to access the API or the username isn&#8217;t registered at GitHub.</p>
</li>
<li>
<p>We have the <code>passthroughSubject</code> <code>apiNetworkActivitySubscriber</code> to reflect when the GithubAPI object starts or finishes making network requests.</p>
</li>
<li>
<p>We have a another subscriber <code>repositoryCountSubscriber</code> attached to <code>$githubUserData</code> publisher that pulls the repository count off the github user data object and assigns it to a text field to be displayed.</p>
</li>
<li>
<p>We have a final subscriber <code>avatarViewSubscriber</code> attached to <code>$githubUserData</code> that attempts to retrieve the image associated with the user&#8217;s avatar for display.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The empty list is useful to return because when a username is provided that doesn&#8217;t resolve, we want to explicitly remove any avatar image that was previously displayed.
To do this, we need the pipelines to fully resolve to some value, so that further pipelines are triggered and the relevant UI interfaces updated.
If we used an optional <code>String?</code> instead of an array of <code>String[]</code>, the optional does not trigger some of the pipeline when it is nil, and we always want a result value - even an empty value - to come from the pipeline.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The subscribers (created with <a href="#reference-assign">assign</a> and <a href="#reference-sink">sink</a>) are stored as <code>AnyCancellable</code> variables on the view controller instance.
Because they are defined on the class instance, the Swift compiler creates deinitializers which will cancel and clean up the publishers when the class is torn down.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A number of developers comfortable with RxSwift are using a "CancelBag" object to collect cancellable references, and cancel the pipelines on tear down.
An example of this can be seen at <a href="https://github.com/tailec/CombineExamples/blob/master/CombineExamples/Shared/CancellableBag.swift" class="bare">https://github.com/tailec/CombineExamples/blob/master/CombineExamples/Shared/CancellableBag.swift</a>.
This is accommodated within Combine with the <code>store</code> function on <code>AnyCancellable</code> that easily allows you to put a reference to the subscriber into a collection, such as <code>Set&lt;AnyCancellable&gt;</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The pipelines have been explicitly configured to work on a background queue using the <a href="#reference-subscribe">subscribe</a> operator.
Without that additional detail configured, the pipelines would be invoked and run on the main runloop since they were invoked from the UI, which may cause a noticeable slow-down in responsiveness in the user interface.
Likewise when the resulting pipelines assign or update UI elements, the <a href="#reference-receive">receive</a> operator is used to transfer that work back onto the main runloop.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To have the UI continuously updated from changes propagating through <a href="#reference-published">@Published</a> properties, we want to make sure that any configured pipelines have a &lt;Never&gt; failure type.
This is required for the <a href="#reference-assign">assign</a> operator.
It is also a potential source of bugs when using a <a href="#reference-sink">sink</a> operator.
If the pipeline from a <a href="#reference-published">@Published</a> variable terminates to a <a href="#reference-sink">sink</a> that accepts an Error failure type, the sink will send a termination signal if an error occurs.
This will then stop the pipeline from any further processing, even when the variable is updated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/GithubAPI.swift">UIKit-Combine/GithubAPI.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">Combine</span>

<span class="kd">enum</span> <span class="kt">APIFailureCondition</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">invalidServerResponse</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">GithubAPIUser</span><span class="p">:</span> <span class="kt">Decodable</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="c1">// A very *small* subset of the content available about</span>
    <span class="c1">//  a github API user for example:</span>
    <span class="c1">// https://api.github.com/users/heckj</span>
    <span class="k">let</span> <span class="nv">login</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">public_repos</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">avatar_url</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">GithubAPI</span> <span class="p">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="c1">// NOTE(heckj): I've also seen this kind of API access</span>
    <span class="c1">// object set up with with a class and static methods on the class.</span>
    <span class="c1">// I don't know that there's a specific benefit to making this a value</span>
    <span class="c1">// type/struct with a function on it.</span>

    <span class="c1">/// externally accessible publisher that indicates that network activity is happening in the API proxy</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">networkActivityPublisher</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span> <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="c1">/// creates a one-shot publisher that provides a GithubAPI User</span>
    <span class="c1">/// object as the end result. This method was specifically designed to</span>
    <span class="c1">/// return a list of 1 object, as opposed to the object itself to make</span>
    <span class="c1">/// it easier to distinguish a "no user" result (empty list)</span>
    <span class="c1">/// representation that could be dealt with more easily in a Combine</span>
    <span class="c1">/// pipeline than an optional value. The expected return type is a</span>
    <span class="c1">/// Publisher that returns either an empty list, or a list of one</span>
    <span class="c1">/// GithubAPUser, with a failure return type of Never, so it's</span>
    <span class="c1">/// suitable for recurring pipeline updates working with a @Published</span>
    <span class="c1">/// data source.</span>
    <span class="c1">/// - Parameter username: username to be retrieved from the Github API</span>
    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">retrieveGithubUser</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">GithubAPIUser</span><span class="p">],</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span> <i class="conum" data-value="4"></i><b>(4)</b>

        <span class="k">if</span> <span class="n">username</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="p">{</span> <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="k">return</span> <span class="kt">Just</span><span class="p">([])</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="k">let</span> <span class="nv">assembledURL</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="s">"https://api.github.com/users/</span><span class="se">\(</span><span class="n">username</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">publisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">assembledURL</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">handleEvents</span><span class="p">(</span><span class="nv">receiveSubscription</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <i class="conum" data-value="6"></i><b>(6)</b>
                <span class="n">networkActivityPublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
            <span class="p">},</span> <span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
                <span class="n">networkActivityPublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
            <span class="p">},</span> <span class="nv">receiveCancel</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">networkActivityPublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span> <i class="conum" data-value="7"></i><b>(7)</b>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span><span class="p">,</span>
                    <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">throw</span> <span class="kt">APIFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">data</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">GithubAPIUser</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span> <i class="conum" data-value="8"></i><b>(8)</b>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span>
                <span class="p">[</span><span class="nv">$0</span><span class="p">]</span> <i class="conum" data-value="9"></i><b>(9)</b>
            <span class="p">}</span>
            <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span> <i class="conum" data-value="10"></i><b>(10)</b>
                <span class="c1">// When I originally wrote this method, I was returning</span>
                <span class="c1">// a GithubAPIUser? optional.</span>
                <span class="c1">// I ended up converting this to return an empty</span>
                <span class="c1">// list as the "error output replacement" so that I could</span>
                <span class="c1">// represent that the current value requested didn't *have* a</span>
                <span class="c1">// correct github API response.</span>
                <span class="k">return</span> <span class="kt">Just</span><span class="p">([])</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span> <i class="conum" data-value="11"></i><b>(11)</b>
            <span class="k">return</span> <span class="n">publisher</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The decodable struct created here is a subset of what&#8217;s returned from the GitHub API.
Any pieces not defined in the struct are simply ignored when processed by the <a href="#reference-decode">decode</a> operator.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The code to interact with the GitHub API was broken out into its own object, which I would normally have in a separate file.
The functions on the API struct return publishers, and are then mixed and merged with other pipelines in the ViewController.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This struct also exposes a publisher using <a href="#reference-passthroughsubject">passthroughSubject</a> to reflect Boolean values when it is actively making network requests.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>I first created the pipelines to return an optional GithubAPIUser instance, but found that there wasn&#8217;t a convenient way to propagate "nil" or empty objects on failure conditions.
The code was then recreated to return a list, even though only a single instance was ever expected, to conveniently represent an "empty" object.
This was important for the use case of wanting to erase existing values in following pipelines reacting to the GithubAPIUser object "disappearing" - removing the repository count and avatar images in this case.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The logic here is simply to prevent extraneous network requests, returning an empty result if the username being requested has less than 3 characters.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the <a href="#reference-handleevents">handleEvents</a> operator is how we are triggering updates for the network activity publisher.
We define closures that trigger on subscription and finalization (both completion and cancel) that invoke <code>send()</code> on the <a href="#reference-passthroughsubject">passthroughSubject</a>.
This is an example of how we can provide metadata about a pipeline&#8217;s operation as a separate publisher.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td><a href="#reference-trymap">tryMap</a> adds additional checking on the API response from github to convert correct responses from the API that aren&#8217;t valid User instances into a pipeline failure condition.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td><a href="#reference-decode">decode</a> takes the Data from the response and decodes it into a single instance of <code>GithubAPIUser</code></td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td><a href="#reference-map">map</a> is used to take the single instance and convert it into a list of 1 item, changing the type to a list of <code>GithubAPIUser</code>: <code>[GithubAPIUser]</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td><a href="#reference-catch">catch</a> operator captures the error conditions within this pipeline, and returns an empty list on failure while also converting the failure type to <code>Never</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td><a href="#reference-erasetoanypublisher">eraseToAnyPublisher</a> collapses the complex types of the chained operators and exposes the whole pipeline as an instance of <code>AnyPublisher</code>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/GithubViewController.swift">UIKit-Combine/GithubViewController.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">Combine</span>

<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">github_id_entry</span><span class="p">:</span> <span class="kt">UITextField</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">activityIndicator</span><span class="p">:</span> <span class="kt">UIActivityIndicatorView</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">repositoryCountLabel</span><span class="p">:</span> <span class="kt">UILabel</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">githubAvatarImageView</span><span class="p">:</span> <span class="kt">UIImageView</span><span class="o">!</span>

    <span class="k">var</span> <span class="nv">repositoryCountSubscriber</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">avatarViewSubscriber</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">usernameSubscriber</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">headingSubscriber</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">apiNetworkActivitySubscriber</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>

    <span class="c1">// username from the github_id_entry field, updated via IBAction</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>

    <span class="c1">// github user retrieved from the API publisher. As it's updated, it</span>
    <span class="c1">// is "wired" to update UI elements</span>
    <span class="kd">@Published</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">githubUserData</span><span class="p">:</span> <span class="p">[</span><span class="kt">GithubAPIUser</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1">// publisher reference for this is $username, of type &lt;String, Never&gt;</span>
    <span class="k">var</span> <span class="nv">myBackgroundQueue</span><span class="p">:</span> <span class="kt">DispatchQueue</span> <span class="o">=</span> <span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"viewControllerBackgroundQueue"</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">coreLocationProxy</span> <span class="o">=</span> <span class="kt">LocationHeadingProxy</span><span class="p">()</span>

    <span class="c1">// MARK - Actions</span>

    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">githubIdChanged</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UITextField</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span> <span class="p">??</span> <span class="s">""</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Set username to "</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// MARK - lifecycle methods</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="c1">// Do any additional setup after loading the view.</span>

        <span class="k">let</span> <span class="nv">apiActivitySub</span> <span class="o">=</span> <span class="kt">GithubAPI</span><span class="o">.</span><span class="n">networkActivityPublisher</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">doingSomethingNow</span> <span class="k">in</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">doingSomethingNow</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">startAnimating</span><span class="p">()</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>
                <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">apiNetworkActivitySubscriber</span> <span class="o">=</span> <span class="kt">AnyCancellable</span><span class="p">(</span><span class="n">apiActivitySub</span><span class="p">)</span>

        <span class="n">usernameSubscriber</span> <span class="o">=</span> <span class="err">$</span><span class="n">username</span> <i class="conum" data-value="2"></i><b>(2)</b>
            <span class="o">.</span><span class="nf">throttle</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">myBackgroundQueue</span><span class="p">,</span> <span class="nv">latest</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
            <span class="c1">// ^^ scheduler myBackGroundQueue publishes resulting elements</span>
            <span class="c1">// into that queue, resulting on this processing moving off the</span>
            <span class="c1">// main runloop.</span>
            <span class="o">.</span><span class="nf">removeDuplicates</span><span class="p">()</span>
            <span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"username pipeline: "</span><span class="p">)</span> <span class="c1">// debugging output for pipeline</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">username</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">GithubAPIUser</span><span class="p">],</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="k">in</span>
                <span class="k">return</span> <span class="kt">GithubAPI</span><span class="o">.</span><span class="nf">retrieveGithubUser</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="c1">// ^^ type returned in the pipeline is a Publisher, so we use</span>
            <span class="c1">// switchToLatest to flatten the values out of that</span>
            <span class="c1">// pipeline to return down the chain, rather than returning a</span>
            <span class="c1">// publisher down the pipeline.</span>
            <span class="o">.</span><span class="nf">switchToLatest</span><span class="p">()</span>
            <span class="c1">// using a sink to get the results from the API search lets us</span>
            <span class="c1">// get not only the user, but also any errors attempting to get it.</span>
            <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">githubUserData</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>

        <span class="c1">// using .assign() on the other hand (which returns an</span>
        <span class="c1">// AnyCancellable) *DOES* require a Failure type of &lt;Never&gt;</span>
        <span class="n">repositoryCountSubscriber</span> <span class="o">=</span> <span class="err">$</span><span class="n">githubUserData</span> <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"github user data: "</span><span class="p">)</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">userData</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span>
                <span class="k">if</span> <span class="k">let</span> <span class="nv">firstUser</span> <span class="o">=</span> <span class="n">userData</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kt">String</span><span class="p">(</span><span class="n">firstUser</span><span class="o">.</span><span class="n">public_repos</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="s">"unknown"</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">repositoryCountLabel</span><span class="p">)</span>

        <span class="k">let</span> <span class="nv">avatarViewSub</span> <span class="o">=</span> <span class="err">$</span><span class="n">githubUserData</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">userData</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">UIImage</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="k">in</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">firstUser</span> <span class="o">=</span> <span class="n">userData</span><span class="o">.</span><span class="n">first</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="c1">// my placeholder data being returned below is an empty</span>
                    <span class="c1">// UIImage() instance, which simply clears the display.</span>
                    <span class="c1">// Your use case may be better served with an explicit</span>
                    <span class="c1">// placeholder image in the event of this error condition.</span>
                    <span class="k">return</span> <span class="kt">Just</span><span class="p">(</span><span class="kt">UIImage</span><span class="p">())</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">firstUser</span><span class="o">.</span><span class="n">avatar_url</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
                    <span class="c1">// ^^ this hands back (Data, response) objects</span>
                    <span class="o">.</span><span class="nf">handleEvents</span><span class="p">(</span><span class="nv">receiveSubscription</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
                        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
                            <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">startAnimating</span><span class="p">()</span>
                        <span class="p">}</span>
                    <span class="p">},</span> <span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
                        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
                            <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>
                        <span class="p">}</span>
                    <span class="p">},</span> <span class="nv">receiveCancel</span><span class="p">:</span> <span class="p">{</span>
                        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
                            <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>
                        <span class="p">}</span>
                    <span class="p">})</span>
                    <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">myBackgroundQueue</span><span class="p">)</span>
                    <span class="c1">// ^^ do this work on a background Queue so we don't impact</span>
                    <span class="c1">// UI responsiveness</span>
                    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">data</span> <span class="p">}</span>
                    <span class="c1">// ^^ pare down to just the Data object</span>
                    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span><span class="o">!</span><span class="p">}</span>
                    <span class="c1">// ^^ convert Data into a UIImage with its initializer</span>
                    <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
                        <span class="k">return</span> <span class="kt">Just</span><span class="p">(</span><span class="kt">UIImage</span><span class="p">())</span>
                    <span class="p">}</span>
                    <span class="c1">// ^^ deal the failure scenario and return my "replacement"</span>
                    <span class="c1">// image for when an avatar image either isn't available or</span>
                    <span class="c1">// fails somewhere in the pipeline here.</span>
                    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
                    <span class="c1">// ^^ match the return type here to the return type defined</span>
                    <span class="c1">// in the .map() wrapping this because otherwise the return</span>
                    <span class="c1">// type would be terribly complex nested set of generics.</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">switchToLatest</span><span class="p">()</span>
            <span class="c1">// ^^ Take the returned publisher that's been passed down the chain</span>
            <span class="c1">// and "subscribe it out" to the value within in, and then pass</span>
            <span class="c1">// that further down.</span>
            <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
            <span class="c1">// ^^ and then switch to receive and process the data on the main</span>
            <span class="c1">// queue since we're messing with the UI</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">image</span> <span class="o">-&gt;</span> <span class="kt">UIImage</span><span class="p">?</span> <span class="k">in</span>
                <span class="n">image</span>
            <span class="p">}</span>
            <span class="c1">// ^^ this converts from the type UIImage to the type UIImage?</span>
            <span class="c1">// which is key to making it work correctly with the .assign()</span>
            <span class="c1">// operator, which must map the type *exactly*</span>
            <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">githubAvatarImageView</span><span class="p">)</span>

        <span class="c1">// convert the .sink to an `AnyCancellable` object that we have</span>
        <span class="c1">// referenced from the implied initializers</span>
        <span class="n">avatarViewSubscriber</span> <span class="o">=</span> <span class="kt">AnyCancellable</span><span class="p">(</span><span class="n">avatarViewSub</span><span class="p">)</span>

        <span class="c1">// KVO publisher of UIKit interface element</span>
        <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">repositoryCountLabel</span><span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"repositoryCountLabel Updated to </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">someValue</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We add a subscriber to our previous controller from that connects notifications of activity from the GithubAPI object to our activity indicator.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Where the username is updated from the IBAction (from our earlier example <a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a>) we have the subscriber make the network request and put the results in a new variable (also <a href="#reference-published">@Published</a>) on our ViewController.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The first subscriber is on the publisher <code>$githubUserData</code>.
This pipeline extracts the count of repositories and updates the UI label instance.
There is a bit of logic in the middle of the pipeline to return the string "unknown" when the list is empty.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The second subscriber is connected to the publisher <code>$githubUserData</code>.
This triggers a network request to request the image data for the github avatar.
This is a more complex pipeline, extracting the data from <code>githubUser</code>, assembling a URL, and then requesting it.
We also use <a href="#reference-handleevents">handleEvents</a> operator to trigger updates to the activityIndicator in our view.
We use <a href="#reference-receive">receive</a> to make the requests on a background queue and later to push the results back onto the main thread in order to update UI elements.
The <a href="#reference-catch">catch</a> and failure handling returns an empty <code>UIImage</code> instance in the event of failure.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>A final subscriber is attached to the UILabel itself.
Any Key-Value Observable object from Foundation can produce a publisher.
In this example, we attach a publisher that triggers a print statement that the UI element was updated.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While we could simply attach pipelines to UI elements as we&#8217;re updating them, it more closely couples interactions to the actual UI elements themselves.
While easy and direct, it is often a good idea to make explicit state and updates to separate out actions and data for debugging and understandability.
In the example above, we use two <a href="#reference-published">@Published</a> properties to hold the state associated with the current view.
One of which is updated by an <code>IBAction</code>, and the second updated declaratively using a Combine publisher pipeline.
All other UI elements are updated publishers hanging from those properties getting updated.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-merging-streams-interface">Merging multiple pipelines to update UI elements</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Watch and react to multiple UI elements publishing values, and updating the interface based on the combination of values updated.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The ViewController with this code is in the github project at <a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/FormViewController.swift">UIKit-Combine/FormViewController.swift</a></p>
</li>
<li>
<p>Publishers:
<a href="#reference-published">@Published</a>,</p>
</li>
<li>
<p>Operators:
<a href="#reference-combinelatest">combineLatest</a>,
<a href="#reference-map">map</a>,
<a href="#reference-receive">receive</a></p>
</li>
<li>
<p>Subscribers:
<a href="#reference-assign">assign</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>This example intentionally mimics a lot of web form style validation scenarios, but within UIKit and using Combine.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A view controller is set up with multiple elements to declaratively update.
The view controller hosts 3 primary text input fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>value1</code></p>
</li>
<li>
<p><code>value2</code></p>
</li>
<li>
<p><code>value2_repeat</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It also hosts a button to submit the combined values, and two labels to provide feedback.</p>
</div>
<div class="paragraph">
<p>The rules of these update that are implemented:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The entry in <code>value1</code> has to be at least 5 characters.</p>
</li>
<li>
<p>The entry in <code>value2</code> has to be at least 5 characters.</p>
</li>
<li>
<p>The entry in <code>value2_repeat</code> has to be the same as <code>value2</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If any of these rules aren&#8217;t met, then we want the submit button to be disabled and relevant messages displayed explaining what needs to be done.</p>
</div>
<div class="paragraph">
<p>This can be achieved by setting up a cascade of pipelines that link and merge together.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is a <a href="#reference-published">@Published</a> property matching each of the user input fields.
<a href="#reference-combinelatest">combineLatest</a> is used to take the continually published updates from the properties and merge them into a single pipeline.
A <a href="#reference-map">map</a> operator enforces the rules about characters required and the values needing to be the same.
If the values don&#8217;t match the required output, we pass a nil value down the pipeline.</p>
</li>
<li>
<p>Another validation pipeline is set up for value1, just using a <a href="#reference-map">map</a> operator to validate the value, or return nil.</p>
</li>
<li>
<p>The logic within the map operators  doing the validation is also used to update the label messages in the user interface.</p>
</li>
<li>
<p>A final pipeline uses <a href="#reference-combinelatest">combineLatest</a> to merge the two validation pipelines into a single pipeline.
A subscriber is attached to this combined pipeline to determine if the submission button should be enabled.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The example below shows these all connected.</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/FormViewController.swift">UIKit-Combine/FormViewController.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">Combine</span>

<span class="kd">class</span> <span class="kt">FormViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">value1_input</span><span class="p">:</span> <span class="kt">UITextField</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">value2_input</span><span class="p">:</span> <span class="kt">UITextField</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">value2_repeat_input</span><span class="p">:</span> <span class="kt">UITextField</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">submission_button</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">value1_message_label</span><span class="p">:</span> <span class="kt">UILabel</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">value2_message_label</span><span class="p">:</span> <span class="kt">UILabel</span><span class="o">!</span>

    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">value1_updated</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UITextField</span><span class="p">)</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="n">value1</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span> <span class="p">??</span> <span class="s">""</span>
    <span class="p">}</span>
    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">value2_updated</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UITextField</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">value2</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span> <span class="p">??</span> <span class="s">""</span>
    <span class="p">}</span>
    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">value2_repeat_updated</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UITextField</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">value2_repeat</span> <span class="o">=</span> <span class="n">sender</span><span class="o">.</span><span class="n">text</span> <span class="p">??</span> <span class="s">""</span>
    <span class="p">}</span>

    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">value1</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">value2</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>
    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">value2_repeat</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span>

    <span class="k">var</span> <span class="nv">validatedValue1</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="k">return</span> <span class="err">$</span><span class="n">value1</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value1</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="n">value1</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">{</span>
                <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
                    <span class="k">self</span><span class="o">.</span><span class="n">value1_message_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"minimum of 3 characters required"</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
            <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">value1_message_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">""</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">value1</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">validatedValue2</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">?,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span> <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="k">return</span> <span class="kt">Publishers</span><span class="o">.</span><span class="kt">CombineLatest</span><span class="p">(</span><span class="err">$</span><span class="n">value2</span><span class="p">,</span> <span class="err">$</span><span class="n">value2_repeat</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value2</span><span class="p">,</span> <span class="n">value2_repeat</span> <span class="k">in</span>
                <span class="k">guard</span> <span class="n">value2_repeat</span> <span class="o">==</span> <span class="n">value2</span><span class="p">,</span> <span class="n">value2</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">value2_message_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"values must match and have at least 5 characters"</span>
                    <span class="k">return</span> <span class="kc">nil</span>
                <span class="p">}</span>
                <span class="k">self</span><span class="o">.</span><span class="n">value2_message_label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">""</span>
                <span class="k">return</span> <span class="n">value2</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">readyToSubmit</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)?,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span> <i class="conum" data-value="6"></i><b>(6)</b>
        <span class="k">return</span> <span class="kt">Publishers</span><span class="o">.</span><span class="kt">CombineLatest</span><span class="p">(</span><span class="n">validatedValue2</span><span class="p">,</span> <span class="n">validatedValue1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">value2</span><span class="p">,</span> <span class="n">value1</span> <span class="k">in</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">realValue2</span> <span class="o">=</span> <span class="n">value2</span><span class="p">,</span> <span class="k">let</span> <span class="nv">realValue1</span> <span class="o">=</span> <span class="n">value1</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">nil</span>
                <span class="p">}</span>
                <span class="nf">return</span> <span class="p">(</span><span class="n">realValue2</span><span class="p">,</span> <span class="n">realValue1</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="k">var</span> <span class="nv">cancellableSet</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">AnyCancellable</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[]</span> <i class="conum" data-value="7"></i><b>(7)</b>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

        <span class="k">self</span><span class="o">.</span><span class="n">readyToSubmit</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">}</span> <i class="conum" data-value="8"></i><b>(8)</b>
            <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">submission_button</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">store</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">cancellableSet</span><span class="p">)</span> <i class="conum" data-value="9"></i><b>(9)</b>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The start of this code follows the same patterns laid out in <a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a>.
IBAction messages are used to update the <a href="#reference-published">@Published</a> properties, triggering updates to any subscribers attached.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The first validation pipeline uses a <a href="#reference-map">map</a> operator to take the string value input and convert it to nil if it doesn&#8217;t match the validation rules.
This is also converting the output type from the published property of <code>&lt;String&gt;</code> to the optional <code>&lt;String?&gt;</code>.
The same logic is also used to trigger updates to the messages label to provide information about what is required.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Since we are updating user interface elements, we explicitly make those updates wrapped in <code>DispatchQueue.main.async</code> to invoke on the main thread.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><a href="#reference-combinelatest">combineLatest</a> takes two publishers and merges them into a single pipeline with an output type that is the combined values of each of the upstream publishers.
In this case, the output type is a tuple of <code>(&lt;String&gt;, &lt;String&gt;)</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Rather than use <code>DispatchQueue.main.async</code>, we can use the <a href="#reference-receive">receive</a> operator to explicitly run the next operator on the main thread, since it will be doing UI updates.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The two validation pipelines are combined with <a href="#reference-combinelatest">combineLatest</a>, and the output of those checked and merged into a single tuple output.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>We could store the assignment pipeline as an <code>AnyCancellable?</code> reference (to map it to the life of the viewcontroller) but another option is to create something to collect all the cancellable references.
This starts as an empty set, and any sinks or assignment subscribers can be added to it to keep a reference to them so that they operate over the full lifetime of the view controller.
If you are creating a number of pipelines, this can be a convenient way to maintain references to all of them.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>If any of the values are nil, the <a href="#reference-map">map</a> operator returns nil down the pipeline.
Checking against a nil value provides the boolean used to enable (or disable) the submission button.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>the <code>store</code> method is available on the <a href="https://developer.apple.com/documentation/combine/cancellable">Cancellable</a> protocol, which is explicitly set up to support saving off references that can be used to cancel a pipeline.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-delegate-publisher-subject">Creating a repeating publisher by wrapping a delegate based API</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To use one of the Apple delegate APIs to provide values for a Combine pipeline.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-passthroughsubject">passthroughSubject</a></p>
</li>
<li>
<p><a href="#reference-currentvaluesubject">currentValueSubject</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-future">Wrapping an asynchronous call with a Future to create a one-shot publisher</a></p>
</li>
<li>
<p><a href="#reference-passthroughsubject">passthroughSubject</a></p>
</li>
<li>
<p><a href="#reference-delay">delay</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>Where a <a href="#reference-future">Future</a> publisher is great for wrapping existing code to make a single request, it doesn&#8217;t serve as well to make a publisher that produces lengthy, or potentially unbounded, amount of output.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Apple&#8217;s Cocoa APIs have tended to use a object/delegate pattern, where you can opt in to receiving any number of different callbacks (often with data).
One such example of that is included within the CoreLocation library, which offers a number of different data sources.</p>
</div>
<div class="paragraph">
<p>If you want to consume data provided by one of these kinds of APIs within a pipeline, you can wrap the object and use <a href="#reference-passthroughsubject">passthroughSubject</a> to expose a publisher.
The sample code below shows an example of wrapping CoreLocation&#8217;s CLManager object and consuming the data from it through a UIKit view controller.</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/LocationHeadingProxy.swift">UIKit-Combine/LocationHeadingProxy.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">Combine</span>
<span class="kd">import</span> <span class="kt">CoreLocation</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="kt">LocationHeadingProxy</span><span class="p">:</span> <span class="kt">NSObject</span><span class="p">,</span> <span class="kt">CLLocationManagerDelegate</span> <span class="p">{</span>

    <span class="k">let</span> <span class="nv">mgr</span><span class="p">:</span> <span class="kt">CLLocationManager</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">headingPublisher</span><span class="p">:</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">CLHeading</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="k">var</span> <span class="nv">publisher</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">CLHeading</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="k">override</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">mgr</span> <span class="o">=</span> <span class="kt">CLLocationManager</span><span class="p">()</span>
        <span class="n">headingPublisher</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">CLHeading</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">()</span>
        <span class="n">publisher</span> <span class="o">=</span> <span class="n">headingPublisher</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>

        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="n">mgr</span><span class="o">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="k">self</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">enable</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">mgr</span><span class="o">.</span><span class="nf">startUpdatingHeading</span><span class="p">()</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">disable</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">mgr</span><span class="o">.</span><span class="nf">stopUpdatingHeading</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="c1">// MARK - delegate methods</span>

    <span class="cm">/*
     *  locationManager:didUpdateHeading:
     *
     *  Discussion:
     *    Invoked when a new heading is available.
     */</span>
    <span class="kd">func</span> <span class="nf">locationManager</span><span class="p">(</span><span class="n">_</span> <span class="nv">manager</span><span class="p">:</span> <span class="kt">CLLocationManager</span><span class="p">,</span> <span class="n">didUpdateHeading</span> <span class="nv">newHeading</span><span class="p">:</span> <span class="kt">CLHeading</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">headingPublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="n">newHeading</span><span class="p">)</span> <i class="conum" data-value="6"></i><b>(6)</b>
    <span class="p">}</span>

    <span class="cm">/*
     *  locationManager:didFailWithError:
     *  Discussion:
     *    Invoked when an error has occurred. Error types are defined in "CLError.h".
     */</span>
    <span class="kd">func</span> <span class="nf">locationManager</span><span class="p">(</span><span class="n">_</span> <span class="nv">manager</span><span class="p">:</span> <span class="kt">CLLocationManager</span><span class="p">,</span> <span class="n">didFailWithError</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">Error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">headingPublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="kt">Subscribers</span><span class="o">.</span><span class="kt">Completion</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">error</span><span class="p">))</span> <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><a href="https://developer.apple.com/documentation/corelocation/cllocationmanager">CLLocationManager</a> is the heart of what is being wrapped, part of CoreLocation.
Because it has additional methods that need to be called for using the framework, I exposed it as a public read-only property.
This is useful for requesting user permission to use the location API, which the framework exposes as a method on <code>CLLocationManager</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A private instance of <code>PassthroughSubject</code> with the data type we want to publish provides our inside-the-class access to forward data.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A public property <code>publisher</code> exposes the publisher from that subject for external subscriptions.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The heart of this works by assigning this class as the delegate to the <code>CLLocationManager</code> instance, which is set up at the tail end of initialization.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The CoreLocation API doesn&#8217;t immediately start sending information.
There are methods that need to be called to start (and stop) the data flow, and these are wrapped and exposed on this proxy object.
Most publishers are set up to subscribe and drive consumption based on subscription, so this is a bit out of the norm for how a publisher starts generating data.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>With the delegate defined and the <code>CLLocationManager</code> activated, the data will be provided via callbacks defined on the <a href="https://developer.apple.com/documentation/corelocation/cllocationmanagerdelegate">CLLocationManagerDelegate</a>.
We implement the callbacks we want for this wrapped object, and within them we use <a href="#reference-passthroughsubject">passthroughSubject</a> <code>.send()</code> to forward the information to any existing subscribers.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>While not strictly required, the delegate provided an <code>Error</code> reporting callback, so we included that as an example of forwarding an error through <a href="#reference-passthroughsubject">passthroughSubject</a>.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/HeadingViewController.swift">UIKit-Combine/HeadingViewController.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">Combine</span>
<span class="kd">import</span> <span class="kt">CoreLocation</span>

<span class="kd">class</span> <span class="kt">HeadingViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">headingSubscriber</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>

    <span class="k">let</span> <span class="nv">coreLocationProxy</span> <span class="o">=</span> <span class="kt">LocationHeadingProxy</span><span class="p">()</span>
    <span class="k">var</span> <span class="nv">headingBackgroundQueue</span><span class="p">:</span> <span class="kt">DispatchQueue</span> <span class="o">=</span> <span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"headingBackgroundQueue"</span><span class="p">)</span>

    <span class="c1">// MARK - lifecycle methods</span>

    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">permissionButton</span><span class="p">:</span> <span class="kt">UIButton</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">activateTrackingSwitch</span><span class="p">:</span> <span class="kt">UISwitch</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">headingLabel</span><span class="p">:</span> <span class="kt">UILabel</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">locationPermissionLabel</span><span class="p">:</span> <span class="kt">UILabel</span><span class="o">!</span>

    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">requestPermission</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UIButton</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"requesting corelocation permission"</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">promise</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="k">self</span><span class="o">.</span><span class="n">coreLocationProxy</span><span class="o">.</span><span class="n">mgr</span><span class="o">.</span><span class="nf">requestWhenInUseAuthorization</span><span class="p">()</span>
            <span class="k">return</span> <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">delay</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">headingBackgroundQueue</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"updating corelocation permission label"</span><span class="p">)</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">updatePermissionStatus</span><span class="p">()</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">@IBAction</span> <span class="kd">func</span> <span class="nf">trackingToggled</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UISwitch</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="n">sender</span><span class="o">.</span><span class="n">isOn</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nv">true</span><span class="p">:</span>
            <span class="k">self</span><span class="o">.</span><span class="n">coreLocationProxy</span><span class="o">.</span><span class="nf">enable</span><span class="p">()</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Enabling heading tracking"</span><span class="p">)</span>
        <span class="k">case</span> <span class="nv">false</span><span class="p">:</span>
            <span class="k">self</span><span class="o">.</span><span class="n">coreLocationProxy</span><span class="o">.</span><span class="nf">disable</span><span class="p">()</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Disabling heading tracking"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">updatePermissionStatus</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">x</span> <span class="o">=</span> <span class="kt">CLLocationManager</span><span class="o">.</span><span class="nf">authorizationStatus</span><span class="p">()</span>
        <span class="k">switch</span> <span class="n">x</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">authorizedWhenInUse</span><span class="p">:</span>
            <span class="n">locationPermissionLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"Allowed when in use"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">notDetermined</span><span class="p">:</span>
            <span class="n">locationPermissionLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"notDetermined"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">restricted</span><span class="p">:</span>
            <span class="n">locationPermissionLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"restricted"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">denied</span><span class="p">:</span>
            <span class="n">locationPermissionLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"denied"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">authorizedAlways</span><span class="p">:</span>
            <span class="n">locationPermissionLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"authorizedAlways"</span>
        <span class="kd">@unknown</span> <span class="k">default</span><span class="p">:</span>
            <span class="n">locationPermissionLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"unknown default"</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="c1">// Do any additional setup after loading the view.</span>

        <span class="c1">// request authorization for the corelocation data</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">updatePermissionStatus</span><span class="p">()</span>

        <span class="k">let</span> <span class="nv">corelocationsub</span> <span class="o">=</span> <span class="n">coreLocationProxy</span>
            <span class="o">.</span><span class="n">publisher</span>
            <span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"headingSubscriber"</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
            <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span> <i class="conum" data-value="5"></i><b>(5)</b>
                <span class="k">self</span><span class="o">.</span><span class="n">headingLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="n">someValue</span><span class="o">.</span><span class="n">trueHeading</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="n">headingSubscriber</span> <span class="o">=</span> <span class="kt">AnyCancellable</span><span class="p">(</span><span class="n">corelocationsub</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>One of the quirks of CoreLocation is the requirement to ask for permission from the user to access the data.
The API provided to initiate this request returns immediately, but provides no detail if the user allowed or denied the request.
The <code>CLLocationManager</code> class includes the information, and exposes it as a class method when you want to retrieve it, but there is no information provided to know when, or if, the user has responded to the request.
Since the operation doesn&#8217;t provide any return, we provide an integer as the pipeline data, primarily to represent that the request has been made.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Since there isn&#8217;t a clear way to judge when the user will grant permission, but the permission is persistent, we simply use a <a href="#reference-delay">delay</a> operator before attempting to retrieve the data.
This use simply delays the propagation of the value for two seconds.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>After that delay, we invoke the class method and attempt to update information in the interface with the results of the current provided status.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Since CoreLocation requires methods to be explicitly enabled or disabled to provide the data, this connects a <code>UISwitch</code> toggle <code>IBAction</code> to the methods exposed on our publisher proxy.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The heading data is received in this <a href="#reference-sink">sink</a> subscriber, where in this example we write it to a text label.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-notificationcenter">Responding to updates from NotificationCenter</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Receiving notifications from NotificationCenter as a publisher to declaratively react to the information provided.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-notificationcenter">NotificationCenter</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The unit tests at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/NotificationCenterPublisherTests.swift"><code>UsingCombineTests/NotificationCenterPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>A large number of frameworks and user interface components provide information about their state and interactions via Notifications from NotificationCenter.
Apple&#8217;s documentation includes an article on <a href="https://developer.apple.com/documentation/combine/receiving_and_handling_events_with_combine">receiving and handling events with Combine</a> specifically referencing NotificationCenter.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="https://developer.apple.com/documentation/foundation/notification">Notifications</a> flowing through <a href="https://developer.apple.com/documentation/foundation/notificationcenter">NotificationCenter</a> provide a common, central location for events within your application.</p>
</div>
<div class="paragraph">
<p>You can also add your own notifications to your application, and upon sending them may include an additional dictionary in their <code>userInfo</code> property.
An example of defining your own notification <code>.myExampleNotification</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">extension</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">myExampleNotification</span> <span class="o">=</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span><span class="p">(</span><span class="s">"an-example-notification"</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notification names are structured, and based on Strings.
Object references can be passed when a notification is posted to the NotificationCenter, indicating which object sent the notification.
Additionally, Notifications may include a <code>userInfo</code>, which has a type of <code>[AnyHashable : Any]?</code>.
This allows for arbitrary dictionaries, either reference or value typed, to be included with a notification.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">myUserInfo</span> <span class="o">=</span> <span class="p">[</span><span class="s">"foo"</span><span class="p">:</span> <span class="s">"bar"</span><span class="p">]</span>

<span class="k">let</span> <span class="nv">note</span> <span class="o">=</span> <span class="kt">Notification</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="o">.</span><span class="n">myExampleNotification</span><span class="p">,</span> <span class="nv">userInfo</span><span class="p">:</span> <span class="n">myUserInfo</span><span class="p">)</span>
<span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="n">note</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While commonly in use within AppKit and macOS applications, not all developers are comfortable with heavily using NotificationCenter.
Originating within the more dynamic Objective-C runtime, Notifications leverage Any and optional types quite extensively.
Using them within Swift code, or a pipeline, implies that the pipeline will have to provide the type assertions and deal with any possible errors related to data that may or may not be expected.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When creating the NotificationCenter publisher, you provide the name of the notification for which you want to receive, and optionally an object reference to filter to specific types of objects.
A number of AppKit components that are subclasses of <a href="https://developer.apple.com/documentation/appkit/nscontrol">NSControl</a> share a set of notifications, and filtering can be critical to getting the right notification.</p>
</div>
<div class="paragraph">
<p>An example of subscribing to AppKit generated notifications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">sub</span> <span class="o">=</span> <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">NSControl</span><span class="o">.</span><span class="n">textDidChangeNotification</span><span class="p">,</span> <i class="conum" data-value="1"></i><b>(1)</b>
                                               <span class="nv">object</span><span class="p">:</span> <span class="n">filterField</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="p">(</span><span class="nv">$0</span><span class="o">.</span><span class="n">object</span> <span class="k">as!</span> <span class="kt">NSTextField</span><span class="p">)</span><span class="o">.</span><span class="n">stringValue</span> <span class="p">}</span>  <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="kt">MyViewModel</span><span class="o">.</span><span class="n">filterString</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">myViewModel</span><span class="p">)</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>TextFields within AppKit generate a <code>textDidChangeNotification</code> when the values are updated.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>An AppKit application can frequently have a large number of text fields that may be changed.
Including a reference to the sending control can be used to filter to text changed notifications to which you are specifically interested in responding.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <a href="#reference-map">map</a> operator can be used to get into the object references included with the notification, in this case the <code>.stringValue</code> property of the text field that sent the notification, providing its updated value</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The resulting string can be assigned using a writable <code>KeyValue</code> path.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example of subscribing to your own notifications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">myExampleNotification</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="c1">// can't use the object parameter to filter on a value reference, only class references, but</span>
    <span class="c1">// filtering on 'nil' only constrains to notification name, so value objects *can* be passed</span>
    <span class="c1">// in the notification itself.</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedNotification</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"passed through: "</span><span class="p">,</span> <span class="n">receivedNotification</span><span class="p">)</span>
        <span class="c1">// receivedNotification.name</span>
        <span class="c1">// receivedNotification.object - object sending the notification (sometimes nil)</span>
        <span class="c1">// receivedNotification.userInfo - often nil</span>
    <span class="p">}</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="patterns-swiftui-integration">SwiftUI Integration</h3>
<div class="sect3">
<h4 id="pattern-observableobject">Using ObservableObject with SwiftUI models as a publisher source</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>SwiftUI includes @ObservedObject and the ObservableObject protocol, which provides a means of externalizing state for a SwiftUI view while alerting SwiftUI to the model changing.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-published">@Published</a></p>
</li>
<li>
<p><a href="#reference-observableobject">ObservableObject</a></p>
</li>
<li>
<p><a href="#reference-currentvaluesubject">currentValueSubject</a></p>
</li>
<li>
<p><a href="#reference-combinelatest">combineLatest</a></p>
</li>
<li>
<p><a href="#reference-map">map</a></p>
</li>
<li>
<p><a href="#reference-onreceive">onReceive</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<p>The SwiftUI example code:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/SwiftUI-Notes/ReactiveForm.swift"><code>SwiftUI-Notes/ReactiveForm.swift</code></a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/SwiftUI-Notes/ReactiveFormModel.swift"><code>SwiftUI-Notes/ReactiveFormModel.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>SwiftUI views are declarative structures that are rendered based on some known state, being invalidated and updated when that state changes.
We can use Combine to provide reactive updates to manipulate this state and expose it back to SwiftUI.
The example provided here is a simple form entry input, with the goal of providing reactive and dynamic feedback based on the inputs to two fields.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The following rules are encoded into Combine pipelines:
1. the two fields need to be identical - as in entering a password or email address and then validating it by a second entry.
2. the value entered is required to be a minimum of 5 characters in length.
3. A button to submit is enabled or disabled based on the results of these rules.</p>
</div>
<div class="paragraph">
<p>This is accomplished with SwiftUI by externalizing the state into properties on a class and referencing that class into the model using the <code>ObservableObject</code> protocol.
Two properties are directly represented: <code>firstEntry</code> and <code>secondEntry</code> as Strings using the <a href="#reference-published">@Published</a> property wrapper to allow SwiftUI to bind to their updates, as well as update them.
A third property <code>submitAllowed</code> is exposed as a Combine publisher to be used within the view, which maintains the @State internally to the view.
A fourth property - an array of Strings called <code>validationMessages</code> - is computed within the Combine pipelines from the first two properties, and also exposed to SwiftUI using the <a href="#reference-published">@Published</a> property wrapper.</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/SwiftUI-Notes/ReactiveFormModel.swift">SwiftUI-Notes/ReactiveFormModel.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">Foundation</span>
<span class="kd">import</span> <span class="kt">Combine</span>

<span class="kd">class</span> <span class="kt">ReactiveFormModel</span> <span class="p">:</span> <span class="kt">ObservableObject</span> <span class="p">{</span>

    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">firstEntry</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="n">firstEntryPublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">firstEntry</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">firstEntryPublisher</span> <span class="o">=</span> <span class="kt">CurrentValueSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">secondEntry</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span> <span class="p">{</span>
        <span class="k">didSet</span> <span class="p">{</span>
            <span class="n">secondEntryPublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">secondEntry</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">private</span> <span class="k">let</span> <span class="nv">secondEntryPublisher</span> <span class="o">=</span> <span class="kt">CurrentValueSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">(</span><span class="s">""</span><span class="p">)</span>

    <span class="kd">@Published</span> <span class="k">var</span> <span class="nv">validationMessages</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
    <span class="kd">private</span> <span class="k">var</span> <span class="nv">cancellableSet</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">AnyCancellable</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">var</span> <span class="nv">submitAllowed</span><span class="p">:</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span>

    <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">let</span> <span class="nv">validationPipeline</span> <span class="o">=</span> <span class="kt">Publishers</span><span class="o">.</span><span class="kt">CombineLatest</span><span class="p">(</span><span class="n">firstEntryPublisher</span><span class="p">,</span> <span class="n">secondEntryPublisher</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span> <span class="k">in</span> <i class="conum" data-value="4"></i><b>(4)</b>
                <span class="k">var</span> <span class="nv">diagMsgs</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">]()</span>
                <span class="k">let</span> <span class="p">(</span><span class="nv">value</span><span class="p">,</span> <span class="nv">value_repeat</span><span class="p">)</span> <span class="o">=</span> <span class="n">arg</span>
                <span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="n">value_repeat</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">diagMsgs</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"Values for fields must match."</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">||</span> <span class="n">value_repeat</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">diagMsgs</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"Please enter values of at least 5 characters."</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="n">diagMsgs</span>
            <span class="p">}</span>

        <span class="n">submitAllowed</span> <span class="o">=</span> <span class="n">validationPipeline</span> <i class="conum" data-value="5"></i><b>(5)</b>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">stringArray</span> <span class="k">in</span>
                <span class="k">return</span> <span class="n">stringArray</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">1</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span>

        <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">validationPipeline</span> <i class="conum" data-value="6"></i><b>(6)</b>
            <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">validationMessages</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
            <span class="o">.</span><span class="nf">store</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">cancellableSet</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The firstEntry and secondEntry properties are both set with default values of an empty string.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>These properties are then also mirrored with a <a href="#reference-currentvaluesubject">currentValueSubject</a>, which is updated using <code>didSet</code> from each of the <code>@Published</code> properties. This drives the combine pipelines defined below to trigger the reactive updates when the values are changed from the SwiftUI view.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="#reference-combinelatest">combineLatest</a> is used to merge updates from either of <code>firstEntry</code> or <code>secondEntry</code> so that updates will be triggered from either source.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><a href="#reference-map">map</a> takes the input values and uses them to determine and publish a list of validating messages. This overall flow is the source for two follow on pipelines.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The first of the follow on pipelines uses the list of validation messages to determine a true or false Boolean publisher that is used to enable, or disable, the submit button.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The second of the follow on pipelines takes the validation messages and updates them locally on this ObservedObject reference for SwiftUI to watch and use as it sees fit.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The two different methods of exposing state changes - as a publisher, or as external state, are presented as examples for how you can utilize either pattern.
The submit button enable/disable choice could be exposed as a <code>@Published</code> property, and the validation messages could be exposed as a publisher of <code>&lt;String[], Never&gt;</code>.
If the need involves tracking as explicit state, it is likely cleaner and less directly coupled by exposing <code>@Published</code> properties - but either mechanism can be used.</p>
</div>
<div class="paragraph">
<p>The model above is coupled to a SwiftUI View declaration that uses the externalized state.</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/SwiftUI-Notes/ReactiveForm.swift">SwiftUI-Notes/ReactiveForm.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">SwiftUI</span>

<span class="kd">struct</span> <span class="kt">ReactiveForm</span><span class="p">:</span> <span class="kt">View</span> <span class="p">{</span>

    <span class="kd">@ObservedObject</span> <span class="k">var</span> <span class="nv">model</span><span class="p">:</span> <span class="kt">ReactiveFormModel</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="c1">// $model is a ObservedObject&lt;ExampleModel&gt;.Wrapper</span>
    <span class="c1">// and $model.objectWillChange is a Binding&lt;ObservableObjectPublisher&gt;</span>
    <span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">buttonIsDisabled</span> <span class="o">=</span> <span class="kc">true</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="c1">// $buttonIsDisabled is a Binding&lt;Bool&gt;</span>

    <span class="k">var</span> <span class="nv">body</span><span class="p">:</span> <span class="n">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">VStack</span> <span class="p">{</span>
            <span class="kt">Text</span><span class="p">(</span><span class="s">"Reactive Form"</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">headline</span><span class="p">)</span>

            <span class="kt">Form</span> <span class="p">{</span>
                <span class="kt">TextField</span><span class="p">(</span><span class="s">"first entry"</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="err">$</span><span class="n">model</span><span class="o">.</span><span class="n">firstEntry</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
                    <span class="o">.</span><span class="nf">textFieldStyle</span><span class="p">(</span><span class="kt">RoundedBorderTextFieldStyle</span><span class="p">())</span>
                    <span class="o">.</span><span class="nf">lineLimit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">multilineTextAlignment</span><span class="p">(</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>

                <span class="kt">TextField</span><span class="p">(</span><span class="s">"second entry"</span><span class="p">,</span> <span class="nv">text</span><span class="p">:</span> <span class="err">$</span><span class="n">model</span><span class="o">.</span><span class="n">secondEntry</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">textFieldStyle</span><span class="p">(</span><span class="kt">RoundedBorderTextFieldStyle</span><span class="p">())</span>
                    <span class="o">.</span><span class="nf">multilineTextAlignment</span><span class="p">(</span><span class="o">.</span><span class="n">center</span><span class="p">)</span>
                    <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>

                <span class="kt">VStack</span> <span class="p">{</span>
                    <span class="kt">ForEach</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">validationMessages</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">msg</span> <span class="k">in</span> <i class="conum" data-value="4"></i><b>(4)</b>
                        <span class="kt">Text</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">foregroundColor</span><span class="p">(</span><span class="o">.</span><span class="n">red</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">font</span><span class="p">(</span><span class="o">.</span><span class="n">callout</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="kt">Button</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="p">{})</span> <span class="p">{</span>
                <span class="kt">Text</span><span class="p">(</span><span class="s">"Submit"</span><span class="p">)</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">disabled</span><span class="p">(</span><span class="n">buttonIsDisabled</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">onReceive</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">submitAllowed</span><span class="p">)</span> <span class="p">{</span> <span class="n">submitAllowed</span> <span class="k">in</span> <i class="conum" data-value="5"></i><b>(5)</b>
                    <span class="k">self</span><span class="o">.</span><span class="n">buttonIsDisabled</span> <span class="o">=</span> <span class="o">!</span><span class="n">submitAllowed</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">padding</span><span class="p">()</span>
            <span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">RoundedRectangle</span><span class="p">(</span><span class="nv">cornerRadius</span><span class="p">:</span> <span class="mi">10</span><span class="p">)</span>
                <span class="o">.</span><span class="nf">stroke</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">blue</span><span class="p">,</span> <span class="nv">lineWidth</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="kt">Spacer</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">struct</span> <span class="kt">ReactiveForm_Previews</span><span class="p">:</span> <span class="kt">PreviewProvider</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">previews</span><span class="p">:</span> <span class="n">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="kt">ReactiveForm</span><span class="p">(</span><span class="nv">model</span><span class="p">:</span> <span class="kt">ReactiveFormModel</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The model is exposed to SwiftUI using <code>@ObservedObject</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@State</code> buttonIsDisabled is declared locally to this view, with a default value of <code>true</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The projected value from the property wrapper (<code>$model.firstEntry</code> and <code>$model.secondEntry</code>) are used to pass a Binding to the TextField view element. The <code>Binding</code> will trigger updates back on the reference model when the user changes a value, and will let SwiftUI&#8217;s components know that changes are about to happen if the exposed model is changing.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The validation messages, which are generated and assigned within the model is invisible to SwiftUI here as a combine publisher pipeline. Instead this only reacts to the model changes being exposed by those values changing, irregardless of what mechanism changed them.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>As an example of how to use a published with <a href="#reference-onreceive">onReceive</a>, an <code>onReceive</code> subscriber is used to listen to a publisher which is exposed from the model reference. In this case, we take the value and store is locally as <code>@State</code> within the SwiftUI view, but it could also be used after some transformation if that logic were more relevant to just the view display of the resulting values. In this case, we use it with <code>disabled</code> on <code>Button</code> to enabled SwiftUI to enable or disable that UI element based on the value stored in the <code>@State</code>.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="patterns-testing-and-debugging">Testing and Debugging</h3>
<div class="paragraph">
<p>The Publisher/Subscriber interface in Combine is beautifully suited to be an easily testable interface.</p>
</div>
<div class="paragraph">
<p>With the composability of Combine, you can use this to your advantage, creating APIs that present, or consume, code that conforms to <a href="https://developer.apple.com/documentation/combine/publisher">Publisher</a>.</p>
</div>
<div class="paragraph">
<p>With the <a href="https://developer.apple.com/documentation/combine/publisher">publisher protocol</a> as the key interface, you can replace either side to validate your code in isolation.</p>
</div>
<div class="paragraph">
<p>For example, if your code was focused on providing its data from external web services through Combine, you might make the interface to this conform to <code>AnyPublisher&lt;Data, Error&gt;</code>.
You could then use that interface to test either side of that pipeline independently.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can mock data responses that emulate the underlying API calls and possible responses, including various error conditions.
This might include returning data from a publisher created with <a href="#reference-just">Just</a> or <a href="#reference-fail">Fail</a>, or something more complex using <a href="#reference-future">Future</a>.
None of these options require you to make actual network interface calls.</p>
</li>
<li>
<p>Likewise you can isolate the testing of making the publisher do the API calls and verify the various success and failure conditions expected.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="patterns-testing-publisher">Testing a publisher with XCTestExpectation</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>For testing a publisher (and any pipeline attached)</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DataTaskPublisherTests.swift">UsingCombineTests/DataTaskPublisherTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/EmptyPublisherTests.swift">UsingCombineTests/EmptyPublisherTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FuturePublisherTests.swift">UsingCombineTests/FuturePublisherTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/PublisherTests.swift">UsingCombineTests/PublisherTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift">UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-testing-publisher">Testing a publisher with XCTestExpectation</a></p>
</li>
<li>
<p><a href="#patterns-testing-subscriber-scheduled">Testing a subscriber with scheduled sends from PassthroughSubject</a></p>
</li>
<li>
<p><a href="#patterns-testing-subscriber">Testing a subscriber with a PassthroughSubject</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>When you are testing a publisher, or something that creates a publisher, you may not have the option of controlling when the publisher returns data for your tests.
Combine, being driven by its subscribers, can set up a sync that initiates the data flow.
You can use an <a href="https://developer.apple.com/documentation/xctest/xctestexpectation">XCTestExpectation</a> to wait an explicit amount of time for the test to run to completion.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A general pattern for using this with Combine includes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>set up the expectation within the test</p>
</li>
<li>
<p>establish the code you are going to test</p>
</li>
<li>
<p>set up the code to be invoked such that on the success path you call the expectation&#8217;s <code>.fulfill()</code> function</p>
</li>
<li>
<p>set up a <code>wait()</code> function with an explicit timeout that will fail the test if the expectation isn&#8217;t fulfilled within that time window.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you are testing the data results from a pipeline, then triggering the <code>fulfill()</code> function within the <a href="#reference-sink">sink</a> operator <code>receiveValue</code> closure can be very convenient.
If you are testing a failure condition from the pipeline, then often including <code>fulfill()</code> within the <a href="#reference-sink">sink</a> operator <code>receiveCompletion</code> closure is effective.</p>
</div>
<div class="paragraph">
<p>The following example shows testing a one-shot publisher (<a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a> in this case) using expectation, and expecting the data to flow without an error.</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DataTaskPublisherTests.swift#L47">UsingCombineTests/DataTaskPublisherTests.swift - testDataTaskPublisher</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">func</span> <span class="nf">testDataTaskPublisher</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// setup</span>
        <span class="k">let</span> <span class="nv">expectation</span> <span class="o">=</span> <span class="kt">XCTestExpectation</span><span class="p">(</span><span class="nv">description</span><span class="p">:</span> <span class="s">"Download from </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">testURL</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">testURL</span><span class="o">!</span><span class="p">)</span>
            <span class="c1">// validate</span>
            <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">fini</span> <span class="k">in</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">fini</span><span class="p">))</span>
                <span class="k">switch</span> <span class="n">fini</span> <span class="p">{</span>
                <span class="k">case</span> <span class="o">.</span><span class="nv">finished</span><span class="p">:</span> <span class="n">expectation</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">()</span> <i class="conum" data-value="2"></i><b>(2)</b>
                <span class="k">case</span> <span class="o">.</span><span class="nv">failure</span><span class="p">:</span> <span class="kt">XCTFail</span><span class="p">()</span> <i class="conum" data-value="3"></i><b>(3)</b>
                <span class="p">}</span>
            <span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span> <span class="k">in</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="kt">XCTFail</span><span class="p">(</span><span class="s">"Unable to parse response an HTTPURLResponse"</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="p">}</span>
                <span class="kt">XCTAssertNotNil</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="c1">// print(".sink() data received \(data)")</span>
                <span class="kt">XCTAssertNotNil</span><span class="p">(</span><span class="n">httpResponse</span><span class="p">)</span>
                <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <i class="conum" data-value="4"></i><b>(4)</b>
                <span class="c1">// print(".sink() httpResponse received \(httpResponse)")</span>
            <span class="p">})</span>

        <span class="kt">XCTAssertNotNil</span><span class="p">(</span><span class="n">remoteDataPublisher</span><span class="p">)</span>
        <span class="nf">wait</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="p">[</span><span class="n">expectation</span><span class="p">],</span> <span class="nv">timeout</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The expectation is set up with a string that makes debugging in the event of failure a bit easier.
This string is really only seen when a test failure occurs.
The code we are testing here is <code>dataTaskPublisher</code> retrieving data from a preset test URL, defined earlier in the test.
The publisher is invoked by attaching the <a href="#reference-sink">sink</a> subscriber to it.
Without the expectation, the code will still run, but the test running structure wouldn&#8217;t wait to see if there were any exceptions.
The expectation within the test "holds the test" waiting for a response to let the operators do their work.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In this case, the test is expected to complete successfully and terminate normally, therefore the <code>expectation.fulfill()</code> invocation is set within the receiveCompletion closure,  specifically linked to a received <code>.finished</code> completion.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Since we don&#8217;t expect a failure, we also have an explicit <code>XCTFail()</code> invocation if we receive a <code>.failure</code> completion.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We have a few additional assertions within the receiveValue.
Since this publisher set returns a single value and then terminates, we can make inline assertions about the data received.
If we received multiple values, then we could collect those and make assertions on what was received after the fact.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>This test uses a single expectation, but you can include multiple independent expectations to require fulfillment.
It also sets that maximum time that this test can run to five seconds.
The test will not always take five seconds, as it will complete the test as soon as the fulfill is received.
If for some reason the test takes longer than five seconds to respond, the XCTest will report a test failure.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-testing-subscriber">Testing a subscriber with a PassthroughSubject</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>For testing a subscriber, or something that includes a subscriber, we can emulate the publishing source with PassthroughSubject to provide explicit control of what data gets sent and when.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/EncodeDecodeTests.swift">UsingCombineTests/EncodeDecodeTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FilterPublisherTests.swift">UsingCombineTests/FilterPublisherTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FuturePublisherTests.swift">UsingCombineTests/FuturePublisherTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/RetryPublisherTests.swift">UsingCombineTests/RetryPublisherTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SinkSubscriberTests.swift">UsingCombineTests/SinkSubscriberTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SwitchAndFlatMapPublisherTests.swift">UsingCombineTests/SwitchAndFlatMapPublisherTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift">UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-testing-publisher">Testing a publisher with XCTestExpectation</a></p>
</li>
<li>
<p><a href="#reference-passthroughsubject">passthroughSubject</a></p>
</li>
<li>
<p><a href="#patterns-testing-subscriber-scheduled">Testing a subscriber with scheduled sends from PassthroughSubject</a></p>
</li>
<li>
<p><a href="#patterns-testable-publisher-subscriber">Using EntwineTest to create a testable publisher and subscriber</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>When you are testing a subscriber in isolation, you can get more fine-grained control of your tests by emulating the publisher with a <a href="#reference-passthroughsubject">passthroughSubject</a> and using the associated <code>.send()</code> method to trigger updates.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This pattern relies on the subscriber setting up the initial part of the publisher-subscriber lifecycle upon construction, and leaving the code to stand waiting until data is provided.
With a <code>PassthroughSubject</code>, sending the data to trigger the pipeline and subscriber closures, or following state changes that can be verified, is at the control of the test code itself.</p>
</div>
<div class="paragraph">
<p>This kind of testing pattern also works well when you are testing the response of the subscriber to a failure, which might otherwise terminate a subscription.</p>
</div>
<div class="paragraph">
<p>A general pattern for using this kind of test construct is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up your subscriber and any pipeline leading to it that you want to include within the test.</p>
</li>
<li>
<p>Create a <code>PassthroughSubject</code> in the test that produces an output type and failure type to match with your subscriber.</p>
</li>
<li>
<p>Assert any initial values or preconditions.</p>
</li>
<li>
<p>Send the data through the subject.</p>
</li>
<li>
<p>Test the results of having sent the data - either directly or asserting on state changes that were expected.</p>
</li>
<li>
<p>Send additional data if desired.</p>
</li>
<li>
<p>Test further evolution of state or other changes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An example of this pattern follows:</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SinkSubscriberTests.swift#L44">UsingCombineTests/SinkSubscriberTests.swift - testSinkReceiveDataThenError</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">func</span> <span class="nf">testSinkReceiveDataThenError</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// setup - preconditions </span><i class="conum" data-value="1"></i><b>(1)</b>
    <span class="k">let</span> <span class="nv">expectedValues</span> <span class="o">=</span> <span class="p">[</span><span class="s">"firstStringValue"</span><span class="p">,</span> <span class="s">"secondStringValue"</span><span class="p">]</span>
    <span class="kd">enum</span> <span class="kt">TestFailureCondition</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">anErrorExample</span>
    <span class="p">}</span>
    <span class="k">var</span> <span class="nv">countValuesReceived</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">var</span> <span class="nv">countCompletionsReceived</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1">// setup</span>
    <span class="k">let</span> <span class="nv">simplePublisher</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">()</span> <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">simplePublisher</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
            <span class="n">countCompletionsReceived</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">switch</span> <span class="n">completion</span> <span class="p">{</span> <i class="conum" data-value="4"></i><b>(4)</b>
            <span class="k">case</span> <span class="o">.</span><span class="nv">finished</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion:"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">completion</span><span class="p">))</span>
                <span class="c1">// no associated data, but you can react to knowing the</span>
                <span class="c1">// request has been completed</span>
                <span class="kt">XCTFail</span><span class="p">(</span><span class="s">"We should never receive the completion, the error should happen first"</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">anError</span><span class="p">):</span>
                <span class="c1">// do what you want with the error details, presenting,</span>
                <span class="c1">// logging, or hiding as appropriate</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"received the error: "</span><span class="p">,</span> <span class="n">anError</span><span class="p">)</span>
                <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">anError</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">,</span>
                               <span class="kt">TestFailureCondition</span><span class="o">.</span><span class="n">anErrorExample</span><span class="o">.</span><span class="n">localizedDescription</span><span class="p">)</span> <i class="conum" data-value="5"></i><b>(5)</b>
                <span class="k">break</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span> <i class="conum" data-value="6"></i><b>(6)</b>
            <span class="c1">// do what you want with the resulting value passed down</span>
            <span class="c1">// be aware that depending on the data type being returned,</span>
            <span class="c1">// you may get this closure invoked multiple times.</span>
            <span class="kt">XCTAssertNotNil</span><span class="p">(</span><span class="n">someValue</span><span class="p">)</span>
            <span class="kt">XCTAssertTrue</span><span class="p">(</span><span class="n">expectedValues</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">someValue</span><span class="p">))</span>
            <span class="n">countValuesReceived</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="n">someValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">})</span>

    <span class="c1">// validate</span>
    <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">countValuesReceived</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <i class="conum" data-value="7"></i><b>(7)</b>
    <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">countCompletionsReceived</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"firstStringValue"</span><span class="p">)</span> <i class="conum" data-value="8"></i><b>(8)</b>
    <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">countValuesReceived</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">countCompletionsReceived</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"secondStringValue"</span><span class="p">)</span>
    <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">countValuesReceived</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">countCompletionsReceived</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="kt">Subscribers</span><span class="o">.</span><span class="kt">Completion</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="kt">TestFailureCondition</span><span class="o">.</span><span class="n">anErrorExample</span><span class="p">))</span>  <i class="conum" data-value="9"></i><b>(9)</b>
    <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">countValuesReceived</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">countCompletionsReceived</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1">// this data will never be seen by anything in the pipeline above because</span>
    <span class="c1">// we have already sent a completion</span>
    <span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="kt">Subscribers</span><span class="o">.</span><span class="kt">Completion</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span> <i class="conum" data-value="10"></i><b>(10)</b>
    <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">countValuesReceived</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">countCompletionsReceived</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This test sets up some variables to capture and modify during test execution that we use to validate when and how the sink code operates.
Additionally, we have an error defined here because it&#8217;s not coming from other code elsewhere.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The setup for this code uses the <a href="#reference-passthroughsubject">passthroughSubject</a> to drive the test, but the code we are interested in testing is the subscriber.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The subscriber setup under test (in this case, a standard <a href="#reference-sink">sink</a>).
We have code paths that trigger on receiving data and completions.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Within the completion path, we switch on the type of completion, adding an assertion that will fail the test if a finish is called, as we expect to only generate a <code>.failure</code> completion.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Testing error equality in Swift can be awkward, but if the error is code you are controlling, you can sometimes use the <code>localizedDescription</code> as a convenient way to test the type of error received.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <code>receiveValue</code> closure is more complex in how it asserts against received values.
Since we are receiving multiple values in the process of this test, we have some additional logic to  check that the values are within the set that we send.
Like the completion handler, We also increment test specific variables that we will assert on later to validate state and order of operation.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The count variables are validated as preconditions before we send any data to double check our assumptions.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>In the test, the <code>send()</code> triggers the actions, and immediately after we can test the side effects through the test variables we are updating.
In your own code, you may not be able to (or want to) modify your subscriber, but you may be able to provide private/testable properties or windows into the objects to validate them in a similar fashion.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>We also use <code>send()</code> to trigger a completion, in this case a failure completion.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>And the final <code>send()</code> is validating the operation of the failure that just happened - that it was not processed, and no further state updates happened.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-testing-subscriber-scheduled">Testing a subscriber with scheduled sends from PassthroughSubject</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>For testing a pipeline, or subscriber, when what you want to test is the timing of the pipeline.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/PublisherTests.swift">UsingCombineTests/PublisherTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FuturePublisherTests.swift">UsingCombineTests/FuturePublisherTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SinkSubscriberTests.swift">UsingCombineTests/SinkSubscriberTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SwitchAndFlatMapPublisherTests.swift">UsingCombineTests/SwitchAndFlatMapPublisherTests.swift</a></p>
</li>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift">UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-testing-subscriber">Testing a subscriber with a PassthroughSubject</a></p>
</li>
<li>
<p><a href="#patterns-testable-publisher-subscriber">Using EntwineTest to create a testable publisher and subscriber</a></p>
</li>
<li>
<p><a href="#patterns-testing-publisher">Testing a publisher with XCTestExpectation</a></p>
</li>
<li>
<p><a href="#reference-passthroughsubject">passthroughSubject</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>There are a number of operators in Combine that are specific to the timing of data, including <a href="#reference-debounce">debounce</a>, <a href="#reference-throttle">throttle</a>, and <a href="#reference-delay">delay</a>.
You may want to test that your pipeline timing is having the desired impact, independently of doing UI testing.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>One way of handling this leverages the both <a href="https://developer.apple.com/documentation/xctest/xctestexpectation">XCTestExpectation</a> and a <a href="#reference-passthroughsubject">passthroughSubject</a>, combining the two.
Building on both <a href="#patterns-testing-publisher">Testing a publisher with XCTestExpectation</a> and <a href="#patterns-testing-subscriber">Testing a subscriber with a PassthroughSubject</a>, add <a href="https://developer.apple.com/documentation/dispatch/dispatchqueue">DispatchQueue</a> in the test to schedule invocations of PassthroughSubject&#8217;s <code>.send()</code> method.</p>
</div>
<div class="paragraph">
<p>An example of this:</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/PublisherTests.swift#L178">UsingCombineTests/PublisherTests.swift - testKVOPublisher</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">func</span> <span class="nf">testKVOPublisher</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">expectation</span> <span class="o">=</span> <span class="kt">XCTestExpectation</span><span class="p">(</span><span class="nv">description</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">debugDescription</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">KVOAbleNSObject</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">q</span> <span class="o">=</span> <span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">debugDescription</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">intValue</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">print</span><span class="p">()</span>
        <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"value of intValue updated to: &gt;&gt;</span><span class="se">\(</span><span class="n">someValue</span><span class="se">)</span><span class="s">&lt;&lt;"</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="n">q</span><span class="o">.</span><span class="nf">asyncAfter</span><span class="p">(</span><span class="nv">deadline</span><span class="p">:</span> <span class="o">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nv">execute</span><span class="p">:</span> <span class="p">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Updating to foo.intValue on background queue"</span><span class="p">)</span>
        <span class="n">foo</span><span class="o">.</span><span class="n">intValue</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">expectation</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">()</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="p">})</span>
    <span class="nf">wait</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="p">[</span><span class="n">expectation</span><span class="p">],</span> <span class="nv">timeout</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">)</span> <i class="conum" data-value="4"></i><b>(4)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This adds a <code>DispatchQueue</code> to your test, naming the queue after the test itself.
This really only shows when debugging test failures, and is convenient as a reminder of what is happening in the test code vs. any other background queues that might be in use.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>.asyncAfter</code> is used along with the deadline parameter to define when a call gets made.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The simplest form embeds any relevant assertions into the subscriber or around the subscriber. Additionally, invoking the <code>.fulfill()</code> on your expectation as the last queued entry you send lets the test know that it is now complete.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Make sure that when you set up the wait that allow for sufficient time for your queue&#8217;d calls to be invoked.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A definite downside to this technique is that it forces the test to take a minimum amount of time matching the maximum queue delay in the test.</p>
</div>
<div class="paragraph">
<p>Another option is a 3rd party library named EntwineTest, which was inspired by the RxTest library.
EntwineTest is part of Entwine, a Swift library that expands on Combine with some helpers.
The library can be found on Github at <a href="https://github.com/tcldr/Entwine.git" class="bare">https://github.com/tcldr/Entwine.git</a>, available under the MIT license.</p>
</div>
<div class="paragraph">
<p>One of the key elements included in EntwineTest is a virtual time scheduler, as well as additional classes that schedule (<code>TestablePublisher</code>) and collect and record (<code>TestableSubscriber</code>) the timing of results while using this scheduler.</p>
</div>
<div class="paragraph">
<p>An example of this from the EntwineTest project README is included:</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/EntwineTestExampleTests.swift">UsingCombineTests/EntwineTestExampleTests.swift - testExampleUsingVirtualTimeScheduler</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">func</span> <span class="nf">testExampleUsingVirtualTimeScheduler</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">scheduler</span> <span class="o">=</span> <span class="kt">TestScheduler</span><span class="p">(</span><span class="nv">initialClock</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="k">var</span> <span class="nv">didSink</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="o">.</span><span class="nf">delay</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">scheduler</span><span class="p">)</span>
        <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
            <span class="n">didSink</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="p">}</span>

    <span class="kt">XCTAssertNotNil</span><span class="p">(</span><span class="n">cancellable</span><span class="p">)</span>
    <span class="c1">// where a real scheduler would have triggered when .sink() was invoked</span>
    <span class="c1">// the virtual time scheduler requires resume() to commence and runs to</span>
    <span class="c1">// completion.</span>
    <span class="n">scheduler</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="kt">XCTAssertTrue</span><span class="p">(</span><span class="n">didSink</span><span class="p">)</span> <i class="conum" data-value="4"></i><b>(4)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Using the virtual time scheduler requires you create one at the start of the test, initializing its clock to a starting value.
The virtual time scheduler in EntwineTest will commence subscription at the value <code>200</code> and times out at <code>900</code> if the pipeline isn&#8217;t complete by that time.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You create your pipeline, along with any publishers or subscribers, as normal.
EntwineTest also offers a testable publisher and a testable subscriber that could be used as well.
For more details on these parts of EntwineTest, see <a href="#patterns-testable-publisher-subscriber">Using EntwineTest to create a testable publisher and subscriber</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>.resume()</code> needs to be invoked on the virtual time scheduler to commence its operation and run the pipeline.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Assert against expected end results after the pipeline has run to completion.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-testable-publisher-subscriber">Using EntwineTest to create a testable publisher and subscriber</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>For testing a pipeline, or subscriber, when what you want to test is the timing of the pipeline.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/EntwineTestExampleTests.swift">UsingCombineTests/EntwineTestExampleTests.swift</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-testing-publisher">Testing a publisher with XCTestExpectation</a></p>
</li>
<li>
<p><a href="#patterns-testing-subscriber">Testing a subscriber with a PassthroughSubject</a></p>
</li>
<li>
<p><a href="#patterns-testing-subscriber-scheduled">Testing a subscriber with scheduled sends from PassthroughSubject</a></p>
</li>
<li>
<p><a href="#reference-passthroughsubject">passthroughSubject</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>The EntwineTest library, available from GitHub at <a href="https://github.com/tcldr/Entwine.git" class="bare">https://github.com/tcldr/Entwine.git</a>, provides some additional options for making your pipelines testable.
In addition to a virtual time scheduler, EntwineTest has a <code>TestablePublisher</code> and a <code>TestableSubscriber</code>.
These work in coordination with the virtual time scheduler to allow you to specify the timing of the publisher generating data, and to valid the data received by the subscriber.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Xcode 11.2, there is a bug with SwiftPM that impacts the use of Entwine as a testing library.
The details can be found at <a href="https://bugs.swift.org/plugins/servlet/mobile#issue/SR-11564">SR-11564</a> in Swift&#8217;s open source bug reporting.</p>
</div>
<div class="paragraph">
<p>The workaround, which you may need to apply if using Xcode 11.2, is to set the project setting <code>DEAD_CODE_STRIPPING=NO</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example of this from the EntwineTest project is included:</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/EntwineTestExampleTests.swift">UsingCombineTests/EntwineTestExampleTests.swift - testMap</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">XCTest</span>
<span class="kd">import</span> <span class="kt">EntwineTest</span>
<span class="c1">// library loaded from</span>
<span class="c1">// https://github.com/tcldr/Entwine/blob/master/Assets/EntwineTest/README.md</span>
<span class="c1">// as a Swift package https://github.com/tcldr/Entwine.git : 0.6.0,</span>
<span class="c1">// Next Major Version</span>

<span class="kd">class</span> <span class="kt">EntwineTestExampleTests</span><span class="p">:</span> <span class="kt">XCTestCase</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">testMap</span><span class="p">()</span> <span class="p">{</span>

        <span class="k">let</span> <span class="nv">testScheduler</span> <span class="o">=</span> <span class="kt">TestScheduler</span><span class="p">(</span><span class="nv">initialClock</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1">// creates a publisher that will schedule its elements relatively</span>
        <span class="c1">// at the point of subscription</span>
        <span class="k">let</span> <span class="nv">testablePublisher</span><span class="p">:</span> <span class="kt">TestablePublisher</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">testScheduler</span><span class="o">.</span><span class="nf">createRelativeTestablePublisher</span><span class="p">([</span> <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="o">.</span><span class="nf">input</span><span class="p">(</span><span class="s">"a"</span><span class="p">)),</span>
            <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="o">.</span><span class="nf">input</span><span class="p">(</span><span class="s">"b"</span><span class="p">)),</span>
            <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="o">.</span><span class="nf">input</span><span class="p">(</span><span class="s">"c"</span><span class="p">)),</span>
        <span class="p">])</span>

        <span class="c1">// a publisher that maps strings to uppercase</span>
        <span class="k">let</span> <span class="nv">subjectUnderTest</span> <span class="o">=</span> <span class="n">testablePublisher</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">uppercased</span><span class="p">()</span> <span class="p">}</span>

        <span class="c1">// uses the method described above (schedules a subscription at 200</span>
        <span class="c1">// to be cancelled at 900)</span>
        <span class="k">let</span> <span class="nv">results</span> <span class="o">=</span> <span class="n">testScheduler</span><span class="o">.</span><span class="n">start</span> <span class="p">{</span> <span class="n">subjectUnderTest</span> <span class="p">}</span> <i class="conum" data-value="2"></i><b>(2)</b>

        <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">recordedOutput</span><span class="p">,</span> <span class="p">[</span> <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="o">.</span><span class="n">subscription</span><span class="p">),</span>
            <span class="c1">// subscribed at 200</span>
            <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="o">.</span><span class="nf">input</span><span class="p">(</span><span class="s">"A"</span><span class="p">)),</span>
            <span class="c1">// received uppercased input @ 100 + subscription time</span>
            <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="o">.</span><span class="nf">input</span><span class="p">(</span><span class="s">"B"</span><span class="p">)),</span>
            <span class="c1">// received uppercased input @ 200 + subscription time</span>
            <span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="o">.</span><span class="nf">input</span><span class="p">(</span><span class="s">"C"</span><span class="p">)),</span>
            <span class="c1">// received uppercased input @ 300 + subscription time</span>
        <span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>TestablePublisher</code> lets you set up a publisher that returns specific values at specific times.
In this case, it&#8217;s returning 3 items at consistent intervals.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When you use the virtual time scheduler, it is important to make sure to invoke it with start.
This runs the virtual time scheduler, which can run faster than a clock since it only needs to increment the virtual time and not wait for elapsed time.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>results</code> is a TestableSubscriber object, and includes a <code>recordedOutput</code> property which provides  an ordered list of all the data and combine control path interactions with their timing.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If this test sequence had been done with asyncAfter, then the test would have taken a minimum of 500ms to complete.
When I ran this test on my laptop, it was recording 0.0121 seconds to complete the test (12.1ms).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A side effect of EntwineTest is that tests using the virtual time scheduler can run much faster than a real time clock.
The same tests being created using real time scheduling mechanisms to delay data sending values can take significantly longer to complete.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-debugging-print">Debugging pipelines with the print operator</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To gain understanding of what is happening in a pipeline, seeing all control and data interactions.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-print">print</a></p>
</li>
<li>
<p><a href="#reference-sink">sink</a></p>
</li>
<li>
<p><a href="#reference-retry">retry</a></p>
</li>
<li>
<p>The ViewController with this code is in the github project at <a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/GithubViewController.swift">UIKit-Combine/GithubViewController.swift</a></p>
</li>
<li>
<p>The retry unit tests in the github project at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/RetryPublisherTests.swift">UsingCombineTests/RetryPublisherTests.swift</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
<li>
<p><a href="#patterns-sequencing-operations">Sequencing operations with Combine</a></p>
</li>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
<li>
<p><a href="#patterns-debugging-breakpoint">Debugging pipelines with the debugger</a></p>
</li>
<li>
<p><a href="#patterns-debugging-handleevents">Debugging pipelines with the handleEvents operator</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>I have found the greatest detail of information comes from selectively using the <a href="#reference-print">print</a> operator.
The downside is that it prints quite a lot of information, so the output can quickly become overwhelming.
For understanding a simple pipeline, using the <code>.print()</code> as an operator without any parameters is very straightforward.
As soon as you want to add more than one print operator, you will likely want to use the string parameter, which is puts in as a prefix to the output.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The example <a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a> uses it in several places, with long descriptive prefixes to make it clear which pipeline is providing the information.</p>
</div>
<div class="paragraph">
<p>The two pipelines cascade together by connecting through a private published variable - the github user data.
The two relevant pipelines from that example code:</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/GithubViewController.swift">UIKit-Combine/GithubViewController.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="n">usernameSubscriber</span> <span class="o">=</span> <span class="err">$</span><span class="n">username</span>
    <span class="o">.</span><span class="nf">throttle</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">myBackgroundQueue</span><span class="p">,</span> <span class="nv">latest</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="c1">// ^^ scheduler myBackGroundQueue publishes resulting elements</span>
    <span class="c1">// into that queue, resulting on this processing moving off the</span>
    <span class="c1">// main runloop.</span>
    <span class="o">.</span><span class="nf">removeDuplicates</span><span class="p">()</span>
    <span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"username pipeline: "</span><span class="p">)</span> <span class="c1">// debugging output for pipeline</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">username</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">GithubAPIUser</span><span class="p">],</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="k">in</span>
        <span class="k">return</span> <span class="kt">GithubAPI</span><span class="o">.</span><span class="nf">retrieveGithubUser</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// ^^ type returned in the pipeline is a Publisher, so we use</span>
    <span class="c1">// switchToLatest to flatten the values out of that</span>
    <span class="c1">// pipeline to return down the chain, rather than returning a</span>
    <span class="c1">// publisher down the pipeline.</span>
    <span class="o">.</span><span class="nf">switchToLatest</span><span class="p">()</span>
    <span class="c1">// using a sink to get the results from the API search lets us</span>
    <span class="c1">// get not only the user, but also any errors attempting to get it.</span>
    <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">githubUserData</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>

<span class="c1">// using .assign() on the other hand (which returns an</span>
<span class="c1">// AnyCancellable) *DOES* require a Failure type of &lt;Never&gt;</span>
<span class="n">repositoryCountSubscriber</span> <span class="o">=</span> <span class="err">$</span><span class="n">githubUserData</span>
    <span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"github user data: "</span><span class="p">)</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">userData</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">firstUser</span> <span class="o">=</span> <span class="n">userData</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kt">String</span><span class="p">(</span><span class="n">firstUser</span><span class="o">.</span><span class="n">public_repos</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s">"unknown"</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">repositoryCountLabel</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When you run the UIKit-Combine example code, the terminal shows the following output as I slowly enter the username <code>heckj</code>.
In the course of doing these lookups, two other github accounts are found and retrieved (<code>hec</code> and <code>heck</code>) before the final one.</p>
</div>
<div class="listingblock">
<div class="title">interactive output from simulator</div>
<div class="content">
<pre class="rouge highlight"><code>username pipeline: : receive subscription: (RemoveDuplicates)
username pipeline: : request unlimited
github user data: : receive subscription: (CurrentValueSubject)
github user data: : request unlimited
github user data: : receive value: ([])
username pipeline: : receive value: ()
github user data: : receive value: ([])

Set username to  h
username pipeline: : receive value: (h)
github user data: : receive value: ([])

Set username to  he
username pipeline: : receive value: (he)
github user data: : receive value: ([])

Set username to  hec
username pipeline: : receive value: (hec)

Set username to  heck
github user data: : receive value: ([UIKit_Combine.GithubAPIUser(login: "hec", public_repos: 3, avatar_url: "https://avatars3.githubusercontent.com/u/53656?v=4")])

username pipeline: : receive value: (heck)
github user data: : receive value: ([UIKit_Combine.GithubAPIUser(login: "heck", public_repos: 6, avatar_url: "https://avatars3.githubusercontent.com/u/138508?v=4")])

Set username to  heckj
username pipeline: : receive value: (heckj)
github user data: : receive value: ([UIKit_Combine.GithubAPIUser(login: "heckj", public_repos: 69, avatar_url: "https://avatars0.githubusercontent.com/u/43388?v=4")])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some of the extraneous print statements placed in <a href="#reference-sink">sink</a> closures to see final results have been removed.</p>
</div>
<div class="paragraph">
<p>You see the initial subscription setup at the very beginning, and then notifications, including the debug representation of the value passed through the <code>print</code> operator.
Although it is not shown in the example content above, you will also see cancellations when an error occurs, or completions when they emit from a publisher reporting no further data is available.</p>
</div>
<div class="paragraph">
<p>It can also be beneficial to use a <code>print</code> operator on either side of an operator to understand how it is operating.</p>
</div>
<div class="paragraph">
<p>An example of doing this, leveraging the prefix to show the <a href="#reference-retry">retry</a> operator and how it works:</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/RetryPublisherTests.swift">UsingCombineTests/RetryPublisherTests.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">func</span> <span class="nf">testRetryWithOneShotFailPublisher</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// setup</span>

    <span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="kt">Fail</span><span class="p">(</span><span class="nv">outputType</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">failure</span><span class="p">:</span> <span class="kt">TestFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"(1)&gt;"</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="o">.</span><span class="nf">retry</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"(2)&gt;"</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">fini</span> <span class="k">in</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">" ** .sink() received the completion:"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">fini</span><span class="p">))</span>
        <span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">stringValue</span> <span class="k">in</span>
            <span class="kt">XCTAssertNotNil</span><span class="p">(</span><span class="n">stringValue</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">" ** .sink() received </span><span class="se">\(</span><span class="n">stringValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">})</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>(1)</code> prefix is to show the interactions above the <code>retry</code> operator</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <code>(2)</code> prefix shows the interactions after the <code>retry</code> operator</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">output from unit test</div>
<div class="content">
<pre class="rouge highlight"><code>Test Suite 'Selected tests' started at 2019-07-26 15:59:48.042
Test Suite 'UsingCombineTests.xctest' started at 2019-07-26 15:59:48.043
Test Suite 'RetryPublisherTests' started at 2019-07-26 15:59:48.043
Test Case '-[UsingCombineTests.RetryPublisherTests testRetryWithOneShotFailPublisher]' started.
(1)&gt;: receive subscription: (Empty) <i class="conum" data-value="1"></i><b>(1)</b>
(1)&gt;: receive error: (invalidServerResponse)
(1)&gt;: receive subscription: (Empty)
(1)&gt;: receive error: (invalidServerResponse)
(1)&gt;: receive subscription: (Empty)
(1)&gt;: receive error: (invalidServerResponse)
(1)&gt;: receive subscription: (Empty)
(1)&gt;: receive error: (invalidServerResponse)
(2)&gt;: receive error: (invalidServerResponse) <i class="conum" data-value="2"></i><b>(2)</b>
 ** .sink() received the completion: failure(UsingCombineTests.RetryPublisherTests.TestFailureCondition.invalidServerResponse)
(2)&gt;: receive subscription: (Retry)
(2)&gt;: request unlimited
(2)&gt;: receive cancel
Test Case '-[UsingCombineTests.RetryPublisherTests testRetryWithOneShotFailPublisher]' passed (0.010 seconds).
Test Suite 'RetryPublisherTests' passed at 2019-07-26 15:59:48.054.
	 Executed 1 test, with 0 failures (0 unexpected) in 0.010 (0.011) seconds
Test Suite 'UsingCombineTests.xctest' passed at 2019-07-26 15:59:48.054.
	 Executed 1 test, with 0 failures (0 unexpected) in 0.010 (0.011) seconds
Test Suite 'Selected tests' passed at 2019-07-26 15:59:48.057.
	 Executed 1 test, with 0 failures (0 unexpected) in 0.010 (0.015) seconds</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In the test sample, the publisher always reports a failure, resulting in seeing the prefix <code>(1)</code> receiving the error, and then the resubscription from the <code>retry</code> operator.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>And after 4 of those attempts (3 "retries"), then you see the error falling through the pipeline.
After the error hits the sink, you see the <code>cancel</code> signal propagated back up, which stops at the retry operator.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>While very effective, the <code>print</code> operator can be a blunt tool, generating a lot of output that you have to parse and review.
If you want to be more selective with what you identify and print, or if you need to process the data passing through for it to be used more meaningfully, then you look at the <a href="#reference-handleevents">handleEvents</a> operator.
More detail on how to use this operator for debugging is in  <a href="#patterns-debugging-handleevents">Debugging pipelines with the handleEvents operator</a>.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-debugging-handleevents">Debugging pipelines with the handleEvents operator</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To get more targeted understanding of what is happening within a pipeline, employing breakpoints, print or logging statements, or additional logic.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-handleevents">handleEvents</a></p>
</li>
<li>
<p>A ViewController using handleEvents is in the github project at <a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/GithubViewController.swift">UIKit-Combine/GithubViewController.swift</a></p>
</li>
<li>
<p>The handleEvents unit tests in the github project at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/HandleEventsPublisherTests.swift">UsingCombineTests/HandleEventsPublisherTests.swift</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-debugging-print">Debugging pipelines with the print operator</a></p>
</li>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
<li>
<p><a href="#patterns-sequencing-operations">Sequencing operations with Combine</a></p>
</li>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
<li>
<p><a href="#patterns-debugging-breakpoint">Debugging pipelines with the debugger</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p><a href="#reference-handleevents">handleEvents</a> passes data through, making no modifications to the output and failure types, or the data.
When you put in the operator, you can specify a number of optional closures, allowing you to focus on the aspect of what you want to see.
The <a href="#reference-handleevents">handleEvents</a> operator with specific closures can be a great way to get a window to see what is happening when a pipeline is cancelling, erroring, or otherwise terminating expectedly.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The closures you can provide include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>receiveSubscription</code></p>
</li>
<li>
<p><code>receiveRequest</code></p>
</li>
<li>
<p><code>receiveCancel</code></p>
</li>
<li>
<p><code>receiveOutput</code></p>
</li>
<li>
<p><code>receiveCompletion</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the closures each included a print statement, this operator would be acting very much like the <a href="#reference-print">print</a> operator, as detailed in <a href="#patterns-debugging-print">Debugging pipelines with the print operator</a>.</p>
</div>
<div class="paragraph">
<p>The power of handleEvents for debugging is in selecting what you want to view, reducing the amount of output, or manipulating the data to get a better understanding of it.</p>
</div>
<div class="paragraph">
<p>In the example viewcontroller at <a href="https://github.com/heckj/swiftui-notes/blob/master/UIKit-Combine/GithubViewController.swift">UIKit-Combine/GithubViewController.swift</a>, the subscription, cancellation, and completion handlers are used to provide a side effect of starting, or stopping, an activity indicator.</p>
</div>
<div class="paragraph">
<p>If you only wanted to see the data being passed on the pipeline, and didn&#8217;t care about the control messages, then providing a single closure for receiveOutput and ignoring the other closures can let you focus on just that detail.</p>
</div>
<div class="paragraph">
<p>The unit test example showing handleEvents has all options active with comments:</p>
</div>
<div class="listingblock">
<div class="title"><a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/HandleEventsPublisherTests.swift">UsingCombineTests/HandleEventsPublisherTests.swift</a></div>
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">handleEvents</span><span class="p">(</span><span class="nv">receiveSubscription</span><span class="p">:</span> <span class="p">{</span> <span class="n">aValue</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"receiveSubscription event called with </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">aValue</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="p">},</span> <span class="nv">receiveOutput</span><span class="p">:</span> <span class="p">{</span> <span class="n">aValue</span> <span class="k">in</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="nf">print</span><span class="p">(</span><span class="s">"receiveOutput was invoked with </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">aValue</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">},</span> <span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">aValue</span> <span class="k">in</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="nf">print</span><span class="p">(</span><span class="s">"receiveCompletion event called with </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">aValue</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">},</span> <span class="nv">receiveCancel</span><span class="p">:</span> <span class="p">{</span> <i class="conum" data-value="5"></i><b>(5)</b>
    <span class="nf">print</span><span class="p">(</span><span class="s">"receiveCancel event invoked"</span><span class="p">)</span>
<span class="p">},</span> <span class="nv">receiveRequest</span><span class="p">:</span> <span class="p">{</span> <span class="n">aValue</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="nf">print</span><span class="p">(</span><span class="s">"receiveRequest event called with </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">aValue</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first closure called is <code>receiveRequest</code>, which will have the demand value passed into it.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The second closure <code>receiveSubscription</code> is commonly the returning subscription from the publisher, which passes in a reference to the publisher.
At this point, the pipeline is operational, and the publisher will provide data based on the amount of data requested in the original request.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This data is passed into <code>receiveOutput</code> as the publisher makes it available, invoking the closure for each value passed.
This will repeat for as many values as the publisher sends.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If the pipeline is closed - either normally or terminated due to a failure - the <code>receiveCompletion</code> closure will get the completion.
Just the like the <a href="#reference-sink">sink</a> closure, you can switch on the completion provided, and if it is a <code>.failure</code> completion, then you can inspect the enclosed error.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>If the pipeline is cancelled, then the <code>receiveCancel</code> closure will be called.
No data is passed into the cancellation closure.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>While you can also use <a href="#reference-breakpoint">breakpoint</a> and <a href="#reference-breakpointonerror">breakpointOnError</a> operators to break into a debugger (as shown in <a href="#patterns-debugging-breakpoint">Debugging pipelines with the debugger</a>), the <code>handleEvents()</code> operator with closures allows you to set breakpoints within Xcode.
This allows you to immediately jump into the debugger to inspect the data flowing through the pipeline, or to get references to the subscriber, or the error in the case of a failed completion.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="patterns-debugging-breakpoint">Debugging pipelines with the debugger</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Goal</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>To force the pipeline to trap into a debugger on specific scenarios or conditions.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>References</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#reference-handleevents">handleEvents</a></p>
</li>
<li>
<p><a href="#reference-map">map</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>See also</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-debugging-print">Debugging pipelines with the print operator</a></p>
</li>
<li>
<p><a href="#patterns-debugging-handleevents">Debugging pipelines with the handleEvents operator</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Code and explanation</em></dt>
<dd>
<p>You can set a breakpoint within any closure to any operator within a pipeline, triggering the debugger to activate to inspect the data.
Since the <a href="#reference-map">map</a> operator is frequently used for simple output type conversions, it is often an excellent candidate that has a closure you can use.
If you want to see into the control messages, then a breakpoint within any of the closures provided to <a href="#reference-handleevents">handleEvents</a> makes a very convenient target.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can also use the <a href="#reference-breakpoint">breakpoint</a> operator to trigger the debugger, which can be a very quick and convenient way to see what is happening in a pipeline.
The breakpoint operator acts very much like handleEvents, taking a number of optional parameters, closures that are expected to return a boolean, and if true will invoke the debugger.</p>
</div>
<div class="paragraph">
<p>The optional closures include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>receiveSubscription</code></p>
</li>
<li>
<p><code>receiveOutput</code></p>
</li>
<li>
<p><code>receiveCompletion</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">breakpoint</span><span class="p">(</span><span class="nv">receiveSubscription</span><span class="p">:</span> <span class="p">{</span> <span class="n">subscription</span> <span class="k">in</span>
    <span class="k">return</span> <span class="kc">false</span> <span class="c1">// return true to throw SIGTRAP and invoke the debugger</span>
<span class="p">},</span> <span class="nv">receiveOutput</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="k">return</span> <span class="kc">false</span> <span class="c1">// return true to throw SIGTRAP and invoke the debugger</span>
<span class="p">},</span> <span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
    <span class="k">return</span> <span class="kc">false</span> <span class="c1">// return true to throw SIGTRAP and invoke the debugger</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows you to provide logic to evaluate the data being passed through, and only triggering a breakpoint when your specific conditions are met.
With very active pipelines processing a lot of data, this can be a great tool to be more surgical in getting the debugger active when you need it, and letting the other data move on by.</p>
</div>
<div class="paragraph">
<p>If you are only interested in the breaking into the debugger on error conditions, then convenience operator <a href="#reference-breakpointonerror">breakPointOnError</a> is perfect.
It takes no parameters or closures, simply invoking the debugger when an error condition of any form is passed through the pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">breakpointOnError</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The location of the breakpoint that is triggered by the breakpoint operator isn&#8217;t in your code, so getting to local frames and information can be a bit tricky.
This does allow you to inspect global application state in highly specific instances (whenever the closure returns <code>true</code>, with logic you provide), but you may find it more effective to use regular breakpoints within closures.
The breakpoint() and breakpointOnError() operators don&#8217;t immediately drop you into a closure where you can see the data being passed, error thrown, or control signals that may have triggered the breakpoint.
You can often walk back up the stack trace within the debugging window to see the publisher.</p>
</div>
<div class="paragraph">
<p>When you trigger a breakpoint within an operator&#8217;s closure, the debugger immediately gets the context of that closure as well, so you can see/inspect the data being passed.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference">Reference</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The reference section of this book is intended to link to, reference, and expand on <a href="#introduction-appledocs">Apple&#8217;s Combine documentation</a>.</p>
</div>
<div class="sect2">
<h3 id="reference-publishers">Publishers</h3>
<div class="paragraph">
<p>For general information about publishers see <a href="#coreconcepts-publishers">Publishers</a> and <a href="#coreconcepts-lifecycle">Lifecycle of Publishers and Subscribers</a>.</p>
</div>
<div class="sect3">
<h4 id="reference-just">Just</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Just</code> provides a single result and then terminates, providing a publisher with a failure type of <code>&lt;Never&gt;</code></p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/just"><code>Just</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a></p>
</li>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Often used within a closure to <a href="#reference-flatmap">flatMap</a> in error handling, it creates a single-response pipeline for use in error handling of continuous values.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="reference-future">Future</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A <code>Future</code> is initialized with a closure that eventually resolves to a single output value or failure completion.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/future">Future</a>.</p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>Future</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FuturePublisherTests.swift"><code>UsingCombineTests/FuturePublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Future</code> is a publisher that let&#8217;s you combine in any asynchronous call and use that call to generate a value or a completion as a publisher.
It is ideal for when you want to make a single request, or get a single response, where the API you are using has a completion handler closure.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The obvious example that everyone immediately thinks about is <code>URLSession</code>.
Fortunately, <a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a> exists to make a call with a <code>URLSession</code> and return a publisher.
If you already have an API object that wraps the direct calls to <code>URLSession</code>, then making a single request using <code>Future</code> can be a great way to integrate the result into a Combine pipeline.</p>
</div>
<div class="paragraph">
<p>There are a number of APIs in the Apple frameworks that use a completion closure.
An example of one is requesting permission to access the contacts store in Contacts.
An example of wrapping that request for access into a publisher using <code>Future</code> might be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">import</span> <span class="kt">Contacts</span>
<span class="k">let</span> <span class="nv">futureAsyncPublisher</span> <span class="o">=</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">promise</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="kt">CNContactStore</span><span class="p">()</span><span class="o">.</span><span class="nf">requestAccess</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">contacts</span><span class="p">)</span> <span class="p">{</span> <span class="n">grantedAccess</span><span class="p">,</span> <span class="n">err</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="c1">// err is an optional</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">err</span> <span class="o">=</span> <span class="n">err</span> <span class="p">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">grantedAccess</span><span class="p">))</span> <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Future</code> itself has you define the return types and takes a closure.
It hands in a Result object matching the type description, which you interact.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You can invoke the async API however is relevant, including passing in its required closure.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Within the completion handler, you determine what would cause a failure or a success.
A call to <code>promise(.failure(&lt;FailureType&gt;))</code> returns the failure.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Or a call to <code>promise(.success(&lt;OutputType&gt;))</code> returns a value.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to wrap an async API that could return many values over time, you should not use <code>Future</code> directly, as it only returns a single value.
Instead, you should consider creating your own publisher based on <a href="#reference-passthroughsubject">passthroughSubject</a> or <a href="#reference-currentvaluesubject">currentValueSubject</a>, or wrapping the <code>Future</code> publisher with <a href="#reference-deferred">Deferred</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Future creates and invokes its closure to do the asynchronous request <strong>at the time of creation</strong>, not when the publisher receives a demand request.
This can be counter-intuitive, as many other publishers invoke their closures when they receive demand.
This also means that you can&#8217;t directly link a Future publisher to an operator like <code>retry</code>.</p>
</div>
<div class="paragraph">
<p>The <code>retry</code> operator works by making another subscription to the publisher, and <code>Future</code> doesn&#8217;t currently re-invoke the closure you provide upon additional request demands.
This means that chaining a <code>retry</code> operator after <code>Future</code> will not result in Future&#8217;s closure being invoked repeatedly when a <code>.failure</code> completion is returned.</p>
</div>
<div class="paragraph">
<p>The failure of the <code>retry</code> and <code>Future</code> to work together directly has been submitted to Apple as feedback: <code>FB7455914</code>.</p>
</div>
<div class="paragraph">
<p>The <code>Future</code> publisher can be wrapped with <code>Deferred</code> to have it work based on demand, rather than as a one-shot at the time of creation of the publisher.
You can see unit tests illustrating Future wrapped with <code>Deferred</code> in the tests at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FuturePublisherTests.swift"><code>UsingCombineTests/FuturePublisherTests.swift</code></a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are wanting repeated requests to a <code>Future</code> (for example, wanting to use a retry operator to retry failed requests), wrap the Future publisher with <code>Deferred</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">deferredPublisher</span> <span class="o">=</span> <span class="kt">Deferred</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="k">return</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">promise</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="k">self</span><span class="o">.</span><span class="nf">asyncAPICall</span><span class="p">(</span><span class="nv">sabotage</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">grantedAccess</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">err</span> <span class="o">=</span> <span class="n">err</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nf">promise</span><span class="p">(</span><span class="o">.</span><span class="nf">success</span><span class="p">(</span><span class="n">grantedAccess</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The closure provided in to <code>Deferred</code> will be invoked as demand requests come to the publisher.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This in turn resolves the underlying api call to generate the result as a Promise, with internal closures to resolve the promise.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="reference-empty">Empty</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>empty</code> never publishes any values, and optionally finishes immediately.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/empty"><code>Empty</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a> shows an example of using <code>catch</code> to handle errors with a one-shot publisher.</p>
</li>
<li>
<p><a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a> shows an example of using <code>catch</code> with <code>flatMap</code> to handle errors with a continual publisher.</p>
</li>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
<li>
<p>The unit tests at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/EmptyPublisherTests.swift"><code>UsingCombineTests/EmptyPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Empty</code> is useful in error handling scenarios where the value is an optional, or where you want to resolve an error by simply not sending anything.
Empty can be invoked to be a publisher of any output and failure type combination.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>Empty</code> is most commonly used where you need to return a publisher, but don&#8217;t want to propagate any values (a possible error handling scenario).
If you want a publisher that provides a single value, then look at <a href="#reference-just">Just</a> or <a href="#reference-deferred">Deferred</a> publishers as alternatives.</p>
</div>
<div class="paragraph">
<p>When subscribed to, an instance of the <code>Empty</code> publisher will not return any values (or errors) and will immediately return a finished completion message to the subscriber.</p>
</div>
<div class="paragraph">
<p>An example of using <code>Empty</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">myEmptyPublisher</span> <span class="o">=</span> <span class="kt">Empty</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Because the types are not be able to be inferred, expect to define the types you want to return.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="reference-fail">Fail</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Fail</code> immediately terminates publishing with the specified failure.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/fail"><code>Fail</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The unit tests at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FailedPublisherTests.swift"><code>UsingCombineTests/FailedPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Fail</code> is commonly used when implementing an API that returns a publisher.
In the case where you want to return an immediate failure, Fail provides a publisher that immediately triggers a failure on subscription.
One way this might be used is to provide a failure response when invalid parameters are passed.
The Fail publisher lets you generate a publisher of the correct type that provides a failure completion when demand is requested.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Initializing a <code>Fail</code> publisher can be done two ways: with the type notation specifying the output and failure types or with the types implied by handing parameters to the initializer.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="paragraph">
<p>Initializing <code>Fail</code> by specifying the types</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="kt">Fail</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">error</span><span class="p">:</span> <span class="kt">TestFailureCondition</span><span class="o">.</span><span class="n">exampleFailure</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Initializing <code>Fail</code> by providing types as parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="kt">Fail</span><span class="p">(</span><span class="nv">outputType</span><span class="p">:</span> <span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">failure</span><span class="p">:</span> <span class="kt">TestFailureCondition</span><span class="o">.</span><span class="n">exampleFailure</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-sequence">Publishers.Sequence</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Sequence</code> publishes a provided sequence of elements, most often used through convenience initializers.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/sequence"><code>Publishers.Sequence</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The unit tests at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequencePublisherTests.swift"><code>UsingCombineTests/SequencePublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Sequence</code> provides a way to return values as subscribers demand them initialized from a collection.
Formally, it provides elements from any type conforming to the <a href="https://developer.apple.com/documentation/swift/sequence">sequence protocol</a>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If a subscriber requests unlimited demand, all elements will be sent, and then a <code>.finished</code> completion will terminate the output.
If the subscribe requests a single element at a time, then individual elements will be returned based on demand.</p>
</div>
<div class="paragraph">
<p>If the type within the sequence is denoted as <code>optional</code>, and a nil value is included within the sequence, that will be sent as an instance of the optional type.</p>
</div>
<div class="paragraph">
<p>Combine provides an extension onto the <code>Sequence</code> protocol so that anything that corresponds to it can act as a sequence publisher.
It does so by making a <code>.publisher</code> property available, which implicitly creates a <a href="#reference-sequence">Publishers.Sequence</a> publisher.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">initialSequence</span> <span class="o">=</span> <span class="p">[</span><span class="s">"one"</span><span class="p">,</span> <span class="s">"two"</span><span class="p">,</span> <span class="s">"red"</span><span class="p">,</span> <span class="s">"blue"</span><span class="p">]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">initialSequence</span><span class="o">.</span><span class="n">publisher</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-record">Record</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that allows for recording a series of inputs and a completion, for later playback to each subscriber.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/combine/record"><code>Record</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/record/recording"><code>Recording</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>Record</code> is illustrated in the unit tests <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/RecordPublisherTests.swift"><code>UsingCombineTests/RecordPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Record</code> allows you to create a publisher with pre-recorded values for repeated playback.
<code>Record</code> acts very similarly to <a href="#reference-sequence">Publishers.Sequence</a> if you want to publish a sequence of values and then send a <code>.finished</code> completion.
It goes beyond that allowing you to specify a <code>.failure</code> completion to be sent from the recording.
<code>Record</code> does not allow you to control the timing of the values being returned, only the order and the eventual completion following them.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>Record</code> can also be serialized (encoded and decoded) as long as the output and failure values can be serialized as well.</p>
</div>
<div class="paragraph">
<p>An example of a simple recording that sends several string values and then a <code>.finished completion</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="c1">// creates a recording</span>
<span class="k">let</span> <span class="nv">recordedPublisher</span> <span class="o">=</span> <span class="kt">Record</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="p">{</span> <span class="n">example</span> <span class="k">in</span>
    <span class="c1">// example : type is Record&lt;String, Never&gt;.Recording</span>
    <span class="n">example</span><span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="s">"one"</span><span class="p">)</span>
    <span class="n">example</span><span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="s">"two"</span><span class="p">)</span>
    <span class="n">example</span><span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="s">"three"</span><span class="p">)</span>
    <span class="n">example</span><span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="o">.</span><span class="n">finished</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting instance can be used as a publisher immediately:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="n">recordedPublisher</span><span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion: "</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">err</span><span class="p">))</span>
    <span class="n">expectation</span><span class="o">.</span><span class="nf">fulfill</span><span class="p">()</span>
<span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received value: "</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Record</code> also has a property <code>recording</code> that can be inspected, with its own properties of output and completion.
<code>Record</code> and <code>recording</code> do not conform to <a href="https://developer.apple.com/documentation/swift/equatable"><code>Equatable</code></a>, so can&#8217;t be easily compared within tests.
It is fairly easy to compare the properties of <code>output</code> or <code>completion</code>, which are <code>Equatable</code> if the underlying contents (output type and failure type) are equatable.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>No convenience methods exist for creating a recording as a subscriber.
You can use the <code>receive</code> methods to create one, wrapping a <a href="#reference-sink">sink</a> subscriber.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="reference-deferred">Deferred</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>The <code>Deferred</code> publisher waits for a subscriber before running the provided closure to create values for the subscriber.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/deferred"><code>Deferred</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The unit tests at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DeferredPublisherTests.swift"><code>UsingCombineTests/DeferredPublisherTests.swift</code></a></p>
</li>
<li>
<p>The unit tests at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FuturePublisherTests.swift"><code>UsingCombineTests/FuturePublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Deferred</code> is useful when creating an API to return a publisher, where creating the publisher is an expensive effort, either computationally or in the time it takes to set up.
<code>Deferred</code> holds off on setting up any publisher data structures until a subscription is requested.
This provides a means of deferring the setup of the publisher until it is actually needed.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>Deferred</code> publisher is particularly useful with <a href="#reference-future">Future</a>, which does not wait on demand to start the resolution of underlying (wrapped) asynchronous APIs.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="reference-makeconnectable">MakeConnectable</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Creates a or converts a publisher to one that explicitly conforms to the <a href="https://developer.apple.com/documentation/combine/connectablepublisher"><code>ConnectablePublisher</code></a> protocol.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The failure type of the publisher must be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/makeconnectable"><code>MakeConnectable</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>makeConnectable</code> is illustrated in the unit tests <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MulticastSharePublisherTests.swift"><code>UsingCombineTests/MulticastSharePublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>A connectable publisher has an explicit mechanism for enabling when a subscription and the flow of demand from subscribers will be allowed to the publisher.
By conforming to the <a href="https://developer.apple.com/documentation/combine/connectablepublisher"><code>ConnectablePublisher</code></a> protocol, a publisher will have two additional methods exposed for this control: <code>connect</code> and <code>autoconnect</code>.
Both of these methods return a <code>Cancellable</code> (similar to <a href="#reference-sink">sink</a> or <a href="#reference-assign">assign</a>).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When using <code>connect</code>, the receipt of subscription will be under imperative control.
Normally when a subscriber is linked to a publisher, the connection is made automatically, subscriptions get sent, and demand gets negotiated per the <a href="#coreconcepts-lifecycle">Lifecycle of Publishers and Subscribers</a>.
With a connectable publisher, in addition to setting up the subscription <code>connect()</code> needs to be explicitly invoked.
Until <code>connect()</code> is invoked, the subscription won&#8217;t be received by the publisher.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">var</span> <span class="nv">cancellables</span> <span class="o">=</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">AnyCancellable</span><span class="o">&gt;</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">publisher</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="s">"woot"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">makeConnectable</span><span class="p">()</span>

<span class="n">publisher</span><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Value received in sink: "</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="p">}</span>
<span class="o">.</span><span class="nf">store</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">cancellables</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code will not activate the subscription, and in turn show any results.
In order to enable the subscription, an explicit <code>connect()</code> is required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="n">publisher</span>
    <span class="o">.</span><span class="nf">connect</span><span class="p">()</span>
    <span class="o">.</span><span class="nf">store</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">cancellables</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One of the primary uses of having a connectable publisher is to coordinate the timing of connecting multiple subscribers with <a href="#reference-multicast">multicast</a>.
Because multicast only shares existing events and does not replay anything, a subscription joining late could miss some data.
By explicitly enabling the <code>connect()</code>, all subscribers can be attached before any upstream processing begins.</p>
</div>
<div class="paragraph">
<p>In comparison, <code>autoconnect()</code> makes a <code>Connectable</code> publisher act like a non-connectable one.
When you enabled <code>autoconnect()</code> on a <code>Connectable</code> publisher, it will automate the connection such that the first subscription will activate upstream publishers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">var</span> <span class="nv">cancellables</span> <span class="o">=</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">AnyCancellable</span><span class="o">&gt;</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">publisher</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="s">"woot"</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">makeConnectable</span><span class="p">()</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="nf">autoconnect</span><span class="p">()</span> <i class="conum" data-value="2"></i><b>(2)</b>

<span class="n">publisher</span><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Value received in sink: "</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="p">}</span>
<span class="o">.</span><span class="nf">store</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">cancellables</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>makeConnectable</code> wraps an existing publisher and makes it explicitly connectable.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>autoconnect</code> automates the process of establishing the connection for you; The first subscriber will establish the connection, subscriptions will be forwards and demand negotiated.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Making a publisher connectable and then immediately enabling <code>autoconnect</code> is an odd example, as you typically want one explicit pattern of behavior or the other.
The two mechanisms allow you to choose which you want for the needs of your code.
As such, it is extremely unlikely that you would ever want to use <code>makeConnectable()</code> followed immediately by <code>autoconnect()</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both <a href="#reference-timer">Timer</a> and <a href="#reference-multicast">multicast</a> are examples of connectable publishers.</p>
</div>
</div>
<div class="sect3">
<h4 id="reference-swiftui">SwiftUI</h4>
<div class="paragraph">
<p>The SwiftUI framework is based upon displaying views from explicit state; as the state changes, the view updates.</p>
</div>
<div class="paragraph">
<p>SwiftUI uses a variety of property wrappers within its Views to reference and display content from outside of those views.
<code>@ObservedObject</code>, <code>@EnvironmentObject</code>, and <code>@Published</code> are the most common that relate to Combine.
SwiftUI uses these property wrappers to create a publisher that will inform SwiftUI when those models have changed, creating a objectWillChange publisher.
Having an object conform to ObservableObject will also get a default <code>objectWillChange</code> publisher.</p>
</div>
<div class="paragraph">
<p>SwiftUI uses <a href="#reference-observableobject">ObservableObject</a>, which has a default concrete class implementation called <code>ObservableObjectPublisher</code> that exposes a publisher for reference objects (classes) marked with <code>@ObservedObject</code>.</p>
</div>
<div class="sect4">
<h5 id="binding">Binding</h5>
<div class="paragraph">
<p>SwiftUI does this primarily by tracking the state and changes to the state using the SwiftUI struct <code>Binding</code>.
A binding is <strong>not</strong> a Combine pipeline, or even usable as one.
A <code>Binding</code> is based on closures that are used when you get or set data through the binding.
When creating a <code>Binding</code>, you can specify the closures, or use the defaults, which handles the needs of SwiftUI elements to react when data is set or request data when a view requires it.</p>
</div>
<div class="paragraph">
<p>There are a number of SwiftUI property wrappers that create bindings:</p>
</div>
<div class="paragraph">
<p><code>@State</code>: creates a binding to a local view property, and is intended to be used only in one view</p>
</div>
<div class="paragraph">
<p>when you create:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">@State</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">exampleString</span> <span class="o">=</span> <span class="s">""</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>then: <code>exampleString</code> is the state itself and the property wrapper creates <code>$exampleString</code> (also known as property wrapper&#8217;s projected value) which is of type <code>Binding&lt;String&gt;</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Binding</code>:  is used to reference an externally provided binding that the view wants to use to present itself.
You will see there upon occasion when a view is expected to be component, and it is watching for its relevant state data from an enclosing view.</p>
</li>
<li>
<p><code>@EnvironmentObject</code>: make state visible and usable across a set of views.
<code>@EnvironmentObject</code> is used to inject your own objects or state models into the environment, making them available to be used by any of the views within the current view hierarchy.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The exception to <code>@EnvironmentObject</code> cascading across the view hierarchy in SwiftUI is notably when using sheets. Sheets don&#8217;t inherit the environment from the view through which they are presented.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Environment</code> is used to expose environmental information already available from within the frameworks, for example:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">@Environment(\.horizontalSizeClass)</span> <span class="k">var</span> <span class="nv">horizontalSizeClass</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="swiftui-and-combine">SwiftUI and Combine</h5>
<div class="paragraph">
<p>All of this detail on Binding is important to how SwiftUI works, but irrelevant to Combine - Bindings are not combine pipelines or structures, and the classes and structs that SwiftUI uses are directly transformable from Combine publishers or subscribers.</p>
</div>
<div class="paragraph">
<p>SwiftUI does, however, use combine in coordination with Bindings.
Combine fits in to SwiftUI when the state has been externalized into a reference to a model object, most often using the property wrappers <code>@ObservedObject</code> to reference a class conforming to the <code>ObservableObject</code> protocol.
The core of the <code>ObservableObject</code> protocol is a combine publisher <code>objectWillChange</code>, which is used by the SwiftUI framework to know when it needs to invalidate a view based on a model changing.
The <code>objectWillChange</code> publisher only provides an indicator that <strong>something</strong> has changed on the model, not which property, or what changed about it.
The author of the model class can "opt-in" properties into triggering that change using the <code>@Published</code> property wrapper.
If a model has properties that aren&#8217;t wrapped with <code>@Published</code>, then the automatic <code>objectWillChange</code> notification won&#8217;t get triggered when those values are modified.
Typically the model properties will be referenced directly within the View elements.
When the view is invalidated by a value being published through the <code>objectWillChange</code> publisher, the SwiftUI View will request the data it needs, as it needs it, directly from the various model references.</p>
</div>
<div class="paragraph">
<p>The other way that Combine fits into SwiftUI is the method <a href="#reference-onreceive">onReceive</a>, which is a generic instance method on SwiftUI views.</p>
</div>
<div class="paragraph">
<p><a href="#reference-onreceive">onReceive</a> can be used when a view needs to be updated based on some external event that isn&#8217;t directly reflected in a model&#8217;s state being updated.</p>
</div>
<div class="paragraph">
<p>While there is no explicit guidance from Apple on how to use <code>onReceive</code> vs. models, as a general guideline it will be a cleaner pattern to update the model using Combine, keeping the combine publishers and pipelines external to SwiftUI views.
In this mode, you would generally let the <code>@ObservedObject</code> SwiftUI declaration automatically invalidate and update the view, which separates the model updating from the presentation of the view itself.
The alternative ends up having the view bound fairly tightly to the combine publishers providing asynchronous updates, rather than a coherent view of the end state.
There are still some edge cases and needs where you want to trigger a view update directly from a publishers output, and that is where <code>onReceive</code> is most effectively used.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-observableobject">ObservableObject</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Used with <a href="https://developer.apple.com/documentation/swiftui">SwiftUI</a>, objects conforming to <a href="https://developer.apple.com/documentation/combine/observableobject">ObservableObject</a> protocol can provide a publisher.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/combine/observableobject"><code>ObservableObject</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/observableobjectpublisher"><code>ObservableObjectPublisher</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/swiftui/observedobject"><code>@ObservedObject</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The unit tests at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/ObservableObjectPublisherTests.swift"><code>UsingCombineTests/ObservableObjectPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>When a class includes a Published property and conforms to the <a href="https://developer.apple.com/documentation/combine/observableobject">ObservableObject protocol</a>, this class instances will get a <code>objectWillChange</code> publisher endpoint providing this publisher.
The <code>objectWillChange</code> publisher will not return any of the changed data, only an indicator that the referenced object has changed.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The output type of <code>ObservableObject.Output</code> is type aliased to Void, so while it is not nil, it will not provide any meaningful data.
Because the output type does not include what changes on the referenced object, the best method for responding to changes is probably best done using <a href="#reference-sink">sink</a>.</p>
</div>
<div class="paragraph">
<p>In practice, this method is most frequently used by the SwiftUI framework.
SwiftUI views use the <code>@ObservedObject</code> property wrapper to know when to invalidate and refresh views that reference classes implementing ObservableObject.</p>
</div>
<div class="paragraph">
<p>Classes implementing ObservedObject are also expected to use @Published to provide notifications of changes on specific properties, or to optionally provide a custom announcement that indicates the object has changed.</p>
</div>
<div class="paragraph">
<p>It can also be used locally to watch for updates to a reference-type model.</p>
</div>
</div>
<div class="sect3">
<h4 id="reference-published">@Published</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A property wrapper that adds a Combine publisher to any property</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/published">Published</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
<li>
<p>unit tests illustrating using Published: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/PublisherTests.swift"><code>UsingCombineTests/PublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>@Published</code> is part of Combine, but allows you to wrap a property, enabling you to get a publisher that triggers data updates whenever the property is changed.
The publisher&#8217;s output type is inferred from the type of the property, and the error type of the provided publisher is <code>&lt;Never&gt;</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A smaller examples of how it can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">@Published</span> <span class="k">var</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">""</span> <i class="conum" data-value="1"></i><b>(1)</b>

<span class="err">$</span><span class="n">username</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">someString</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"value of username updated to: "</span><span class="p">,</span> <span class="n">someString</span><span class="p">)</span>
    <span class="p">}</span>

<span class="err">$</span><span class="n">username</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="o">.</span><span class="nf">assign</span><span class="p">(\</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">myLabel</span><span class="p">)</span>

<span class="kd">@Published</span> <span class="kd">private</span> <span class="k">var</span> <span class="nv">githubUserData</span><span class="p">:</span> <span class="p">[</span><span class="kt">GithubAPIUser</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@Published</code> wraps the property, username, and will generate events whenever the property is changed.
If there is a subscriber at initialization time, the subscriber will also receive the initial value being set.
The publisher for the property is available at the same scope, and with the same permissions, as the property itself.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The publisher is accessible as <code>$username</code>, of type <code>Published&lt;String&gt;.publisher</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A Published property can have more than one subscriber pipeline triggering from it.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If you are publishing your own type, you may find it convenient to publish an array of that type as the property, even if you only reference a single value.
This allows you represent an "Empty" result that is still a concrete result within Combine pipelines, as <a href="#reference-assign">assign</a> and <a href="#reference-sink">sink</a> subscribers will only trigger updates on non-nil values.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the publisher generated from <code>@Published</code> receives a cancellation from any subscriber, it is expected to, and will cease, reporting property changes.
Because of this expectation, it is common to arrange pipelines from these publishers that have an error type of <code>&lt;Never&gt;</code> and do all error handling within the pipelines.
For example, if a <a href="#reference-sink">sink</a> subscriber is set up to capture errors from a pipeline originating from a` @Published` property, when the error is received, the sink will send a <code>cancel</code> message, causing the publisher to cease generating any updates on change.
This is illustrated in the test <code>testPublishedSinkWithError</code> at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/PublisherTests.swift"><code>UsingCombineTests/PublisherTests.swift</code></a></p>
</div>
<div class="paragraph">
<p>Additional examples of how to arrange error handling for a continuous publisher like <code>@Published</code> can be found at <a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using <code>@Published</code> should only be done within reference types - that is, within classes.
An early beta (beta2) allowed <code>@Published</code> wrapped within a struct.
This is no longer allowed or supported.
As of beta5, the compiler will not throw an error if this is attempted:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>&lt;unknown&gt;:0: error: 'wrappedValue' is unavailable: @Published is only available on properties of classes
	     Combine.Published:5:16: note: 'wrappedValue' has been explicitly marked unavailable here
	         public var wrappedValue: Value { get set }
                        ^</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="reference-foundation">Foundation</h4>

</div>
<div class="sect3">
<h4 id="reference-notificationcenter">NotificationCenter</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Foundation&#8217;s NotificationCenter added the capability to act as a publisher, providing <a href="https://developer.apple.com/documentation/foundation/notifications">Notifications</a> to pipelines.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/foundation/notificationcenter/"><code>NotificationCenter</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-notificationcenter">Responding to updates from NotificationCenter</a></p>
</li>
<li>
<p>The unit tests at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/NotificationCenterPublisherTests.swift"><code>UsingCombineTests/NotificationCenterPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/appkit">AppKit</a> and MacOS applications have heavily relied on <a href="https://developer.apple.com/documentation/foundation/notification">Notifications</a> to provide general application state information.
A number of components also use Notifications through <a href="https://developer.apple.com/documentation/foundation/notificationcenter">NotificationCenter</a> to provide updates on user interactions, such as</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>NotificationCenter provides a publisher upon which you may create pipelines to declaratively react to application or system notifications.
The publisher optionally takes an object reference which further filters notifications to those provided by the specific reference.</p>
</div>
<div class="paragraph">
<p>Notifications are identified primarily by name, defined by a string in your own code, or a constant from a relevant framework.
You can find a good general list of existing Notifications by name at <a href="https://developer.apple.com/documentation/foundation/nsnotification/name" class="bare">https://developer.apple.com/documentation/foundation/nsnotification/name</a>.
A number of specific notifications are often included within cocoa frameworks.
For example, within AppKit, there are a number of common notifications under <a href="https://developer.apple.com/documentation/appkit/nscontrol">NSControl</a>.</p>
</div>
<div class="paragraph">
<p>A number of AppKit controls provide notifications when the control has been updated.
For example, AppKit&#8217;s <a href="https://developer.apple.com/documentation/appkit/views_and_controls/text_field">TextField</a> triggers a number of notifications including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>textDidBeginEditingNotification</code></p>
</li>
<li>
<p><code>textDidChangeNotification</code></p>
</li>
<li>
<p><code>textDidEndEditingNotification</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">extension</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">yourNotification</span> <span class="o">=</span> <span class="kt">Notification</span><span class="o">.</span><span class="kt">Name</span><span class="p">(</span><span class="s">"your-notification"</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span><span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">yourNotification</span><span class="p">,</span> <span class="nv">object</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span>
        <span class="nf">print</span> <span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Notifications are defined by a string for their name.
If defining your own, be careful to define the strings uniquely.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A <code>NotificationCenter</code> publisher can be created for a single type of notification, <code>.yourNotification</code> in this case, defined previously in your code.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><a href="https://developer.apple.com/documentation/foundation/notifications">Notifications</a> are received from the publisher.
These include at least their name, and optionally a <code>object</code> reference from the sending object - most commonly provided from Apple frameworks.
Notifications may also include a <code>userInfo</code> dictionary of arbitrary values, which can be used to pass additional information within your application.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="reference-timer">Timer</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Foundation&#8217;s <code>Timer</code> added the capability to act as a publisher, providing a publisher to repeatedly send values to pipelines based on a <code>Timer</code> instance.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/foundation/timer"><code>Timer</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The unit tests at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/TimerPublisherTests.swift"><code>UsingCombineTests/TimerPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Timer.publish</code> returns an instance of <a href="https://developer.apple.com/documentation/foundation/timer/timerpublisher"><code>Timer.TimerPublisher</code></a>.
This publisher is a connectable publisher, conforming to <a href="https://developer.apple.com/documentation/combine/connectablepublisher"><code>ConnectablePublisher</code></a>.
This means that even when subscribers are connected to it, it will not start producing values until <code>connect()</code> or <code>autoconnect()</code> is invoked on the publisher.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Creating the timer publisher requires an interval in seconds, and a RunLoop and mode upon which to run.
The publisher may optionally take an additional parameter <code>tolerance</code>, which defines a variance allowed in the generation of timed events.
The default for tolerance is nil, allowing any variance.</p>
</div>
<div class="paragraph">
<p>The publisher has an output type of <a href="https://developer.apple.com/documentation/foundation/date">Date</a> and a failure type of <code>&lt;Never&gt;</code>.</p>
</div>
<div class="paragraph">
<p>If you want the publisher to automatically connect and start receiving values as soon as subscribers are connected and make requests for values, then you may include <code>autoconnect()</code> in the pipeline to have it automatically start to generate values as soon as a subscriber requests data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="kt">Timer</span><span class="o">.</span><span class="nf">publish</span><span class="p">(</span><span class="nv">every</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">common</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">autoconnect</span><span class="p">()</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedTimeStamp</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"passed through: "</span><span class="p">,</span> <span class="n">receivedTimeStamp</span><span class="p">)</span>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, you can connect up the subscribers, which will receive no values until you invoke <code>connect()</code> on the publisher, which also returns a <a href="https://developer.apple.com/documentation/combine/cancellable">Cancellable</a> reference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">timerPublisher</span> <span class="o">=</span> <span class="kt">Timer</span><span class="o">.</span><span class="nf">publish</span><span class="p">(</span><span class="nv">every</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="k">default</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">cancellableSink</span> <span class="o">=</span> <span class="n">timerPublisher</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">receivedTimeStamp</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"passed through: "</span><span class="p">,</span> <span class="n">receivedTimeStamp</span><span class="p">)</span>
    <span class="p">}</span>
<span class="c1">// no values until the following is invoked elsewhere/later:</span>
<span class="k">let</span> <span class="nv">cancellablePublisher</span> <span class="o">=</span> <span class="n">timerPublisher</span><span class="o">.</span><span class="nf">connect</span><span class="p">()</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-kvo-publisher">publisher from a KeyValueObserving instance</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Foundation added the ability to get a publisher on any <code>NSObject</code> that can be watched with Key Value Observing.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/objectivec/nsobject/keyvalueobservingpublisher">'KeyValueObservingPublisher'</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The unit tests at <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/PublisherTests.swift"><code>UsingCombineTests/PublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Any key-value-observing instance can produce a publisher.
To create this publisher, you call the function <code>publisher</code> on the object, providing it with a single (required) KeyPath value.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">private</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">KVOAbleNSObject</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    <span class="kd">@objc</span> <span class="kd">dynamic</span> <span class="k">var</span> <span class="nv">intValue</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="kd">@objc</span> <span class="kd">dynamic</span> <span class="k">var</span> <span class="nv">boolValue</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">foo</span> <span class="o">=</span> <span class="kt">KVOAbleNSObject</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="nf">publisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">intValue</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">someValue</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"value updated to: &gt;&gt;</span><span class="se">\(</span><span class="n">someValue</span><span class="se">)</span><span class="s">&lt;&lt;"</span><span class="p">)</span>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>KVO publisher access implies that with macOS 10.15 release or iOS 13, most of Appkit and UIKit interface instances will be accessible as publishers.
Relying on the interface element&#8217;s state to trigger updates into pipelines can lead to your state being very tightly bound to the interface elements, rather than your model.
You may be better served by explicitly creating your own state to react to from a <a href="#reference-published">@Published</a> property wrapper.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="reference-datataskpublisher">URLSession.dataTaskPublisher</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Foundation&#8217;s <a href="https://developer.apple.com/documentation/foundation/urlsession"><code>URLSession</code></a> has a publisher specifically for requesting data from URLs: <code>dataTaskPublisher</code></p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/foundation/urlsession/datataskpublisher"><code>URLSession.DataTaskPublisher</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-datataskpublisher-decode">Making a network request with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Retrying in the event of a temporary failure</a></p>
</li>
<li>
<p><a href="#patterns-constrained-network">Requesting data from an alternate URL when the network is constrained</a></p>
</li>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>dataTaskPublisher</code>, on URLSession, has two variants for creating a publisher.
The first takes an instance of <a href="https://developer.apple.com/documentation/foundation/url">URL</a>, the second <a href="https://developer.apple.com/documentation/foundation/urlrequest">URLRequest</a>.
The data returned from the publisher is a tuple of <code>(data: Data, response: <a href="https://developer.apple.com/documentation/foundation/urlResponse">URLResponse</a>)</code>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">regularURL</span><span class="p">)</span>
<span class="k">return</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-result">Result</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Foundation also adds <code>Result</code> as a publisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/swift/result" class="bare">https://developer.apple.com/documentation/swift/result</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>Result.publisher</code> is illustrated in the unit tests <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MulticastSharePublisherTests.swift"><code>UsingCombineTests/MulticastSharePublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Combine augments <code>Result</code> from the swift standard library with a <code>.publisher</code> property, returning a publisher with an output type of <code>Success</code> and a failure type of <code>Failure</code>, defined by the <code>Result</code> instance.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Any method that returns an instance of <code>Result</code> can use this property to get a publisher that will provide the resulting value and followed by a <code>.finished</code> completion, or a <code>.failure</code> completion with the relevant <code>Error</code>.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
<div class="sect3">
<h4 id="reference-realitykit">RealityKit</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit"><code>RealityKit</code></a> <a href="https://developer.apple.com/documentation/realitykit/scene"><code>.Scene</code></a> <a href="https://developer.apple.com/documentation/realitykit/scene/3254685-publisher"><code>.publisher()</code></a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Scene Publisher (from <a href="https://developer.apple.com/documentation/realitykit">RealityKit</a>)</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit/scene/publisher">Scene.Publisher</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit/sceneevents">SceneEvents</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit/animationevents">AnimationEvents</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit/audioevents">AudioEvents</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/realitykit/collisionevents">CollisionEvents</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="reference-operators">Operators</h3>
<div class="paragraph">
<p>The <a href="#coreconcepts">chapter on Core Concepts</a> includes an overview of all available <a href="#coreconcepts-operators">Operators</a>.</p>
</div>
<div class="sect3">
<h4 id="reference-operators-mapping">Mapping elements</h4>
<div class="sect4">
<h5 id="reference-scan">scan</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>scan</code> acts like an accumulator, collecting and modifying values according to a closure you provide, and publishing intermediate results with each change from upstream.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/scan.svg" alt="scan operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/scan" class="bare">https://developer.apple.com/documentation/combine/publishers/scan</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>While the published docs are unfortunately anemic, the generated swift headers has useful detail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="c1">/// Transforms elements from the upstream publisher by providing the current element to a closure along with the last value returned by the closure.</span>
<span class="c1">///</span>
<span class="c1">///     let pub = (0...5)</span>
<span class="c1">///         .publisher</span>
<span class="c1">///         .scan(0, { return $0 + $1 })</span>
<span class="c1">///         .sink(receiveValue: { print ("\($0)", terminator: " ") })</span>
<span class="c1">///      // Prints "0 1 3 6 10 15 ".</span>
<span class="c1">///</span>
<span class="c1">///</span>
<span class="c1">/// - Parameters:</span>
<span class="c1">///   - initialResult: The previous result returned by the `nextPartialResult` closure.</span>
<span class="c1">///   - nextPartialResult: A closure that takes as its arguments the previous value returned by the closure and the next element emitted from the upstream publisher.</span>
<span class="c1">/// - Returns: A publisher that transforms elements by applying a closure that receives its previous return value and the next element from the upstream publisher.</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>scan</code> : <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/ScanPublisherTests.swift"><code>UsingCombineTests/ScanPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Scan</code> lets you accumulate values or otherwise modify a type as changes flow through the pipeline.
You can use this to collect values into an array, implement a counter, or any number of other interesting use cases.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If you want to be able to throw an error from within the closure doing the accumulation to indicate an error condition, use the <a href="#reference-tryscan">tryScan</a> operator.
If you want to accumulate and process values, but refrain from publishing any results until the upstream publisher completes, consider using the <a href="#reference-reduce">reduce</a> or <a href="#reference-tryreduce">tryReduce</a> operators.</p>
</div>
<div class="paragraph">
<p>When you create a <code>scan</code> operator, you provide an initial value (of the type determined by the upstream publisher) and a closure that takes two parameters - the result returned from the previous invocation of the closure and a new value from the upstream publisher.
You do not need to maintain the type of the upstream publisher, but can convert the type in your closure, returning whatever is appropriate to your needs.</p>
</div>
<div class="paragraph">
<p>For example, the following <code>scan</code> operator implementation counts the number of characters in strings provided by an upstream publisher, publishing an updated count every time a new string is received:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">scan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">{</span> <span class="n">prevVal</span><span class="p">,</span> <span class="n">newValueFromPublisher</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">prevVal</span> <span class="o">+</span> <span class="n">newValueFromPublisher</span><span class="o">.</span><span class="n">count</span>
<span class="p">})</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryscan">tryScan</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>tryScan</code> is a variant of the <code>scan</code> operator which allows for the provided closure to throw an error and cancel the pipeline.
The closure provided updates and modifies a value based on any inputs from an upstream publisher and publishing intermediate results.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/tryscan.svg" alt="tryscan operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/tryscan" class="bare">https://developer.apple.com/documentation/combine/publishers/tryscan</a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>While the published docs are unfortunately anemic, the generated swift headers has some detail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="c1">/// Transforms elements from the upstream publisher by providing the current element to an error-throwing closure along with the last value returned by the closure.</span>
<span class="c1">///</span>
<span class="c1">/// If the closure throws an error, the publisher fails with the error.</span>
<span class="c1">/// - Parameters:</span>
<span class="c1">///   - initialResult: The previous result returned by the `nextPartialResult` closure.</span>
<span class="c1">///   - nextPartialResult: An error-throwing closure that takes as its arguments the previous value returned by the closure and the next element emitted from the upstream publisher.</span>
<span class="c1">/// - Returns: A publisher that transforms elements by applying a closure that receives its previous return value and the next element from the upstream publisher.</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryScan</code> : <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/ScanPublisherTests.swift"><code>UsingCombineTests/ScanPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>tryScan</code> lets you accumulate values or otherwise modify a type as changes flow through the pipeline while also supporting an error state.
If either the combined and updates values, or the incoming value, matches logic you define within the closure, you can throw an error, terminating the pipeline.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="reference-map">map</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>map</code> is most commonly used to convert one data type into another along a pipeline.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/map.svg" alt="map operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/map" class="bare">https://developer.apple.com/documentation/combine/publishers/map</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-datataskpublisher-decode">Making a network request with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Retrying in the event of a temporary failure</a></p>
</li>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
<li>
<p>unit tests illustrating using map with dataTaskPublisher: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DataTaskPublisherTests.swift"><code>UsingCombineTests/DataTaskPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <code>map</code> operator does not allow for any additional failures to be thrown and does not transform the failure type.
If you want to throw an error within your closure, use the <a href="#reference-trymap">tryMap</a> operator.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>map</code> takes a single closure where you provide the logic for the map operation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>map</code> is the all purpose workhorse operator in Combine.
It provides the ability to manipulate the data, or the type of data, and is the most commonly used operator in pipelines.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the <a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a> provides a tuple of <code>(data: Data, response: URLResponse)`</code> as its output.
You can use <code>map</code> to pass along the data, for example to use with <a href="#reference-decode">decode</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">data</span> <span class="p">}</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>$0</code> indicates to grab the first parameter passed in, which is a tuple of <code>data</code> and <code>response</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In some cases, the closure may not be able to infer what data type you are returning, so you may need to provide a definition to help the compiler.
For example, if you have an object getting passed down that has a boolean property "isValid" on it, and you want the boolean for your pipeline, you might set that up like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">struct</span> <span class="kt">MyStruct</span> <span class="p">{</span>
    <span class="nv">isValid</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span>
<span class="c1">//</span>
<span class="kt">Just</span><span class="p">(</span><span class="kt">MyStruct</span><span class="p">())</span>
<span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">inValue</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="n">inValue</span><span class="o">.</span><span class="n">isValid</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>inValue</code> is named as the parameter coming in, and the return type is being explicitly specified to <code>Bool</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A single line is an implicit return, in this case it is pulling the <code>isValid</code> property off the struct and passing it down.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-trymap">tryMap</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>tryMap</code> is similar to <a href="#reference-map">map</a>, except that it also allows you to provide a closure that throws additional errors if your conversion logic is unsuccessful.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/trymap" class="bare">https://developer.apple.com/documentation/combine/publishers/trymap</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-datataskpublisher-trymap">Stricter request processing with dataTaskPublisher</a></p>
</li>
<li>
<p>unit tests illustrating using tryMap with dataTaskPublisher: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DataTaskPublisherTests.swift"><code>UsingCombineTests/DataTaskPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>tryMap</code> is useful when you have more complex business logic around your map and you want to indicate that the data passed in is an error, possibly handling that error later in the pipeline.
If you are looking at <code>tryMap</code> to decode JSON, you may want to consider using the <a href="#reference-decode">decode</a> operator instead, which is set up for that common task.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">enum</span> <span class="kt">MyFailure</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">notBigEnough</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">inValue</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="p">{</span> <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="k">throw</span> <span class="kt">MyFailure</span><span class="o">.</span><span class="n">notBigEnough</span> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">inValue</span> <i class="conum" data-value="3"></i><b>(3)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You can specify whatever logic is relevant to your use case within tryMap</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>and throw an error, although throwing an Error isn&#8217;t required.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If the error condition doesn&#8217;t occur, you do need to pass down data for any further subscribers.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-flatmap">flatMap</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Used with error recovery or async operations that might fail (for example <code>Future</code>), <code>flatMap</code> will replace any incoming values with another publisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/flatmap"><code>flatMap</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a></p>
</li>
<li>
<p>unit tests illustrating <code>flatMap</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SwitchAndFlatMapPublisherTests.swift"><code>UsingCombineTests/SwitchAndFlatMapPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Typically used in error handling scenarios, <code>flatMap</code> takes a closure that allows you to read the incoming data value, and provide a publisher that returns a value to the pipeline.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In error handling, this is most frequently used to take the incoming value and create a one-shot pipeline that does some potentially failing operation, and then handling the error condition with a <a href="#reference-catch">catch</a> operator.</p>
</div>
<div class="paragraph">
<p>A simple example <code>flatMap</code>, arranged to show recovering from a decoding error and returning a placeholder value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
    <span class="k">return</span> <span class="kt">Just</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">YourType</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="kt">JSONDecoder</span><span class="p">())</span>
    <span class="o">.</span><span class="k">catch</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">Just</span><span class="p">(</span><span class="kt">YourType</span><span class="o">.</span><span class="n">placeholder</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A diagram version of this pipeline construct:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/flatmap.svg" alt="flatMap operator">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>flatMap</code> expects to create a new pipeline within its closure for every input value that it receives.
The expected result of this internal pipeline is a Publisher with its own output and failure type.
The output type of the publisher resulting from the internal pipeline defines the output type of the <code>flatMap</code> operator.
The error type of the internal publisher is often expected to be <code>&lt;Never&gt;</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-setfailuretype">setFailureType</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>setFailureType</code> does not send a <code>.failure</code> completion, it just changes the Failure type associated with the pipeline.
Use this publisher type when you need to match the error types for two otherwise mismatched publishers.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/setfailuretype.svg" alt="setfailuretype operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The upstream publisher must have a failure type of <code>&lt;Never&gt;</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/setfailuretype"><code>setFailureType</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating setFailureType: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FailedPublisherTests.swift"><code>UsingCombineTests/FailedPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>setFailureType</code> is an operator for transforming the error type within a pipeline, often from <code>&lt;Never&gt;</code> to some error type you may want to produce.
<code>setFailureType</code> does not induce an error, but changes the types of the pipeline.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This can be especially convenient if you need to match an operator or subscriber that expects a failure type other than <code>&lt;Never&gt;</code> when you are working with a test or single-value publisher such as <a href="#reference-just">Just</a> or <a href="#reference-just">Sequence</a>.</p>
</div>
<div class="paragraph">
<p>If you want to return a <code>.failure</code> completion of a specific type into a pipeline, use the <a href="#reference-fail">Fail</a> operator.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-filtering">Filtering elements</h4>
<div class="sect4">
<h5 id="reference-compactmap">compactMap</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Calls a closure with each received element and publishes any returned optional that has a value.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/compactmap.svg" alt="compactMap operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/compactmap"><code>compactMap</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>compactMap</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FilteringOperatorTests.swift"><code>UsingCombineTests/FilteringOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>compactMap is very similar to the <a href="#reference-map">map</a> operator, with the exception that it expects the closure to return an optional value, and drops any nil values from published responses.
This is the combine equivalent of the <a href="https://developer.apple.com/documentation/swift/sequence/2950916-compactmap"><code>compactMap</code></a> function which iterates through a <a href="https://developer.apple.com/documentation/swift/sequence"><code>Sequence</code></a> and returns a sequence of any non-nil values.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>It can also be used to process results from an upstream publisher that produces an optional Output type, and collapse those into an unwrapped type.
The simplest version of this just returns the incoming value directly, which will filter out the <code>nil</code> values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">compactMap</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$0</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There is also a variation of this operator, <a href="#reference-trycompactmap">tryCompactMap</a>, which allows the provided closure to throw an Error and cancel the stream on invalid conditions.</p>
</div>
<div class="paragraph">
<p>If you want to convert an optional type into a concrete type, always replacing the <code>nil</code> with an explicit value, you should likely use the <a href="#reference-replacenil">replaceNil</a> operator.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-trycompactmap">tryCompactMap</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Calls a closure with each received element and publishes any returned optional that has a value, or optionally throw an Error cancelling the pipeline.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/trycompactmap"><code>tryCompactMap</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryCompactMap</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FilteringOperatorTests.swift"><code>UsingCombineTests/FilteringOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>tryCompactMap</code> is a variant of the <a href="#reference-compactmap">compactMap</a> operator, allowing the values processed to throw an <code>Error</code> condition.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">tryCompactMap</span> <span class="p">{</span> <span class="n">someVal</span> <span class="o">-&gt;</span> <span class="kt">String</span><span class="p">?</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="k">if</span> <span class="p">(</span><span class="n">someVal</span> <span class="o">==</span> <span class="s">"boom"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">TestExampleError</span><span class="o">.</span><span class="n">example</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">someVal</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>If you specify the return type within the closure, it should be an optional value.
The operator that invokes the closure is responsible for filtering the non-<code>nil</code> values it publishes.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to convert an optional type into a concrete type, always replacing the <code>nil</code> with an explicit value, you should likely use the <a href="#reference-replacenil">replaceNil</a> operator.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-filter">filter</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Filter</code> passes through all instances of the output type that match a provided closure, dropping any that don&#8217;t match.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/filter.svg" alt="flatMap operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/filter"><code>filter</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
<li>
<p>unit tests illustrating using <code>filter</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FilterPublisherTests.swift"><code>UsingCombineTests/FilterPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Filter</code> takes a single closure as a parameter that is provided the value from the previous publisher and returns a Bool value.
If the return from the closure is <code>true</code>, then the operator republishes the value further down the chain.
If the return from the closure is <code>false</code>, then the operator drops the value.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If you need a variation of this that will generate an error condition in the pipeline to be handled use the <a href="#reference-tryfilter">tryFilter</a> operator, which allows the closure to throw an error in the evaluation.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryfilter">tryFilter</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>tryFilter</code> passes through all instances of the output type that match a provided closure, dropping any that don&#8217;t match, and allows generating an error during the evaluation of that closure.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/tryfilter"><code>tryFilter</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryFilter</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FilterPublisherTests.swift"><code>UsingCombineTests/FilterPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Like <a href="#reference-filter">filter</a>, tryFilter takes a single closure as a parameter that is provided the value from the previous publisher and returns a Bool value.
If the return from the closure is <code>true</code>, then the operator republishes the value further down the chain.
If the return from the closure is <code>false</code>, then the operator drops the value.
You can additionally throw an error during the evaluation of tryFilter, which will then be propagated as the failure type down the pipeline.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="reference-removeduplicates">removeDuplicates</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>removeDuplicates</code> remembers what was previously sent in the pipeline, and only passes forward values that don&#8217;t match the current value.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/removeduplicates.svg" alt="removeDuplicates operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Available when Output of the previous publisher conforms to Equatable.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/removeduplicates"><code>removeDuplicates</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>removeDuplicates</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift"><code>UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The default usage of <code>removeDuplicates</code> doesn&#8217;t require any parameters, and the operator will publish only elements that don&#8217;t match the previously sent element.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">removeDuplicates</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A second usage of <code>removeDuplicates</code> takes a single parameter <code>by</code> that accepts a closure that allows you to determine the logic of what will be removed.
The parameter version does not have the constraint on the Output type being equatable, but requires you to provide the relevant logic.
If the closure returns true, the <code>removeDuplicates</code> predicate will consider the values matched and not forward a the duplicate value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">removeDuplicates</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="p">{</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="c1">// your logic is required if the output type doesn't conform to equatable.</span>
    <span class="n">first</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">second</span><span class="o">.</span><span class="n">id</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A variation of <code>removeDuplicates</code> exists that allows the predicate closure to throw an error exists: <a href="#reference-tryremoveduplicates">tryRemoveDuplicates</a></p>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryremoveduplicates">tryRemoveDuplicates</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>tryRemoveDuplicates</code> is a variant of <a href="#reference-removeduplicates">removeDuplicates</a> that allows the predicate testing equality to throw an error, resulting in an <code>Error</code> completion type.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>none</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/tryremoveduplicates"><code>tryRemoveDuplicates</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryRemoveDuplicates</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift"><code>UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>tryRemoveDuplicates</code> is a variant of <a href="#reference-removeduplicates">removeDuplicates</a> taking a single parameter that can throw an error.
The parameter is a closure that allows you to determine the logic of what will be removed.
If the closure returns true, <code>tryRemoveDuplicates</code> will consider the values matched and not forward a the duplicate value.
If the closure throws an error, a failure completion will be propagated down the chain, and no value is sent.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">removeDuplicates</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="p">{</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">throws</span> <span class="k">in</span>
    <span class="c1">// your logic is required if the output type doesn't conform to equatable.</span>

<span class="p">})</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-replaceempty">replaceEmpty</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Replaces an empty stream with the provided element.
If the upstream publisher finishes without producing any elements, this publisher emits the provided element, then finishes normally.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/replaceempty.svg" alt="replaceEmpty operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/replaceempty"><code>replaceEmpty</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>replaceEmpty</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/ChangingErrorTests.swift"><code>UsingCombineTests/ChangingErrorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>replaceEmpty</code> will only produce a result if it has not received any values before it receives a <code>.finished</code> completion.
This operator will not trigger on an error passing through it, so if no value has been received with a <code>.failure</code> completion is triggered, it will simply not provide a value.
The operator takes a single parameter, <code>with</code> where you specify the replacement value.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">replaceEmpty</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="s">"-replacement-"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This operator is useful specifically when you want a stream to always provide a value, even if an upstream publisher may not propagate one.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-replaceerror">replaceError</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that replaces any errors with an output value that matches the upstream Output type.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>none</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/replaceerror"><code>replaceError</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>replaceError</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/ChangingErrorTests.swift"><code>UsingCombineTests/ChangingErrorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Where <a href="#reference-maperror">mapError</a> transforms an error, <code>replaceError</code> captures the error and returns a value that matches the Output type of the upstream publisher.
If you don&#8217;t care about the specifics of the error itself, it can be a more convenient operator than using <a href="#reference-catch">catch</a> to handle an error condition.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">replaceError</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="s">"foo"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>is more compact than</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
    <span class="k">return</span> <span class="kt">Just</span><span class="p">(</span><span class="s">"foo"</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#reference-catch">catch</a> would be the preferable error handler if you wanted to return another publisher rather than a singular value.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-replacenil">replaceNil</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Replaces nil elements in the stream with the provided element.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/replacenil.svg" alt="replaceNil operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The output type of the upstream publisher must be an optional type</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/empty/3343774-replacenil"><code>replaceNil</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>replaceNil</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/FilteringOperatorTests.swift"><code>UsingCombineTests/FilteringOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Used when the output type is an optional type, the <code>replaceNil</code> operator replaces any nil instances provided by the upstream publisher with a value provided by the user.
The operator takes a single parameter, <code>with</code> where you specify the replacement value.
The type of the replacement should be a non-optional version of the type provided by the upstream publisher.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">replaceNil</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="s">"-replacement-"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This operator can also be viewed as a way of converting an optional type to an explicit type, where optional values have a pre-determined placeholder.
Put another way, the <code>replaceNil</code> operator is a Combine specific variant of the swift coalescing operator that you might use when unwrapping an optional.</p>
</div>
<div class="paragraph">
<p>If you want to convert an optional type into a concrete type, simply ignoring or collapsing the nil values, you should likely use the <a href="#reference-compactmap">compactMap</a> (or <a href="#reference-trycompactmap">tryCompactMap</a>) operator.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-reducing">Reducing elements</h4>
<div class="sect4">
<h5 id="reference-collect">collect</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Collects all received elements, and emits a single array of the collection when the upstream publisher finishes.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/collect.svg" alt="collect operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/collect"><code>collect</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>collect</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/ReducingOperatorTests.swift"><code>UsingCombineTests/ReducingOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>There are two primary forms of <code>collect</code>, one you specify without any parameters, and one you provide a <code>count</code> parameter.
<code>Collect</code> can also take a more complex form, with a defined strategy for how to buffer and send on items.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For the version without any parameters, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">collect</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The operator will collect all elements from an upstream publisher, holding those in memory until the upstream publisher sends a completion.
Upon receiving the <code>.finished</code> completion, the operator will publish an array of all the values collected.
If the upstream publisher fails with an error, the <code>collect</code> operator forwards the error to the downstream receiver instead of sending its output.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This operator uses an unbounded amount of memory to store the received values.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>Collect</code> without any parameters will request an unlimited number of elements from its upstream publisher.
It only sends the collected array to its downstream after a request whose demand is greater than 0 items.</p>
</div>
<div class="paragraph">
<p>The second variation of <code>collect</code> takes a single parameter (<code>count</code>), which influences how many values it buffers and when it sends results.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">collect</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This version of <code>collect</code> will buffer up to the specified <code>count</code> number of elements.
When it has received the count specified, it emits a single array of the collection.</p>
</div>
<div class="paragraph">
<p>If the upstream publisher finishes before filling the buffer, this publisher sends an array of all the items it has received upon receiving a <code>finished</code> completion.
This may be fewer than <code>count</code> elements.</p>
</div>
<div class="paragraph">
<p>If the upstream publisher fails with an error, this publisher forwards the error to the downstream receiver instead of sending its output.</p>
</div>
<div class="paragraph">
<p>The more complex form of <code>collect</code> operates on a provided strategy of how to collect values and when to emit.</p>
</div>
<div class="paragraph">
<p>As of iOS 13.3 there are two strategies published in <a href="https://developer.apple.com/documentation/combine/publishers/timegroupingstrategy"><code>Publishers.TimeGroupingStrategy</code></a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>byTime</code></p>
</li>
<li>
<p><code>byTimeOrCount</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>byTime</code> allows you to specify a scheduler on which to operate, and a time interval stride over which to run.
It collects all values received within that stride and publishes any values it has received from its upstream publisher during that interval.
Like the parameterless version of <code>collect</code>, this will consume an unbounded amount of memory during that stride interval to collect values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">q</span> <span class="o">=</span> <span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">debugDescription</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="n">publisher</span>
    <span class="o">.</span><span class="nf">collect</span><span class="p">(</span><span class="o">.</span><span class="nf">byTime</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>byTime</code> operates very similarly to <a href="#reference-throttle">throttle</a> with its defined Scheduler and Stride, but where throttle collapses the values over a sequence of time, <code>collect(.byTime(q, 1.0))</code> will buffer and capture those values.
When the time stride interval is exceeded, the collected set will be sent to the operator&#8217;s subscriber.</p>
</div>
<div class="paragraph">
<p><code>byTimeOrCount</code> also takes a scheduler and a time interval stride, and in addition allows you to specify an upper bound on the count of items received before the operator sends the collected values to its subscriber.
The ability to provide a count allows you to have some confidence about the maximum amount of memory that the operator will consume while buffering values.</p>
</div>
<div class="paragraph">
<p>If either of the count or time interval provided are elapsed, the <code>collect</code> operator will forward the currently collected set to its subscribers.
If a <code>.finished</code> completion is received, the currently collected set will be immediately sent to it&#8217;s subscribers.
If a <code>.failure</code> completion is received, any currently buffered values are dropped and the <code>failure</code> completion is forwarded to collect&#8217;s subscribers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">q</span> <span class="o">=</span> <span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">debugDescription</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="n">publisher</span>
    <span class="o">.</span><span class="nf">collect</span><span class="p">(</span><span class="o">.</span><span class="nf">byTimeOrCount</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-ignoreoutput">ignoreOutput</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that ignores all upstream elements, but passes along a completion state (finish or failed).</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/ignoreoutput"><code>ignoreOutput</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>ignoreOutput</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/ReducingOperatorTests.swift"><code>UsingCombineTests/ReducingOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>If you only want to know if a stream has finished (or failed), then <code>ignoreOutput</code> may be what you want.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">ignoreOutput</span><span class="p">()</span>
<span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">completion</span><span class="p">))</span>
    <span class="k">switch</span> <span class="n">completion</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nv">finished</span><span class="p">:</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="n">finishReceived</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">break</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">anError</span><span class="p">):</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="nf">print</span><span class="p">(</span><span class="s">"received error: "</span><span class="p">,</span> <span class="n">anError</span><span class="p">)</span>
        <span class="n">failureReceived</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">break</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() data received"</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>No data will ever be presented to a downstream subscriber of <code>ignoreOutput</code>, so the <code>receiveValue</code> closure will never be invoked.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>When the stream completes, it will invoke <code>receiveCompletion</code>.
You can switch on the case from that completion to respond to the success.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Or you can do further processing based on receiving a failure.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-reduce">reduce</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that applies a closure to all received elements and produces an accumulated value when the upstream publisher finishes.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/reduce.svg" alt="reduce operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>none</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/reduce"><code>reduce</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using reduce: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/ReducingOperatorTests.swift"><code>UsingCombineTests/ReducingOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Very similar in function to the <a href="#reference-scan">scan</a> operator, <code>reduce</code> collects values produced within a stream.
The big difference between <code>scan</code> and <code>reduce</code> is that <code>reduce</code> does not trigger any values until the upstream publisher completes successfully.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When you create a <code>reduce</code> operator, you provide an initial value (of the type determined by the upstream publisher) and a closure that takes two parameters - the result returned from the previous invocation of the closure and a new value from the upstream publisher.</p>
</div>
<div class="paragraph">
<p>Like <code>scan</code>, you don&#8217;t need to maintain the type of the upstream publisher, but can convert the type in your closure, returning whatever is appropriate to your needs.</p>
</div>
<div class="paragraph">
<p>An example of <code>reduce</code> that collects strings and appends them together:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="p">{</span> <span class="n">prevVal</span><span class="p">,</span> <span class="n">newValueFromPublisher</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">prevVal</span><span class="o">+</span><span class="n">newValueFromPublisher</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>reduce</code> operator is excellent at converting a stream that provides many values over time into one that provides a single value upon completion.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryreduce">tryReduce</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that applies a closure to all received elements and produces an accumulated value when the upstream publisher finishes, while also allowing the closure to throw an exception, terminating the pipeline.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>none</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/tryreduce"><code>tryReduce</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryReduce</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/ReducingOperatorTests.swift"><code>UsingCombineTests/ReducingOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>tryReduce</code> is a variation of the <a href="#reference-reduce">reduce</a> operator that allows for the closure to throw an error.
If the exception path is taken, the <code>tryReduce</code> operator will not publish any output values to downstream subscribers.
Like <code>reduce</code>, the <code>tryReduce</code> will only publish a single downstream result upon a <code>.finished</code> completion from the upstream publisher.</p>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-mathematical">Mathematic operations on elements</h4>
<div class="sect4">
<h5 id="reference-max">max</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Publishes the max value of all values received upon completion of the upstream publisher.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/max.svg" alt="max operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The output type of the upstream publisher must conform to <a href="https://developer.apple.com/documentation/swift/comparable"><code>Comparable</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/sequence/3211183-max"><code>max</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>max</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MathOperatorTests.swift"><code>UsingCombineTests/MathOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>max</code> can be set up with either no parameters, or taking a closure.
If defined as an operator with no parameters, the Output type of the upstream publisher must conform to <a href="https://developer.apple.com/documentation/swift/comparable"><code>Comparable</code></a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">max</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If what you are publishing doesn&#8217;t conform to <a href="https://developer.apple.com/documentation/swift/comparable"><code>Comparable</code></a>, then you may specify a closure to provide the ordering for the operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">max</span> <span class="p">{</span> <span class="p">(</span><span class="n">struct1</span><span class="p">,</span> <span class="n">struct2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">struct1</span><span class="o">.</span><span class="n">property1</span> <span class="o">&lt;</span> <span class="n">struct2</span><span class="o">.</span><span class="n">property1</span>
    <span class="c1">// returning boolean true to order struct2 greater than struct1</span>
    <span class="c1">// the underlying method parameter for this closure hints to it:</span>
    <span class="c1">// `areInIncreasingOrder`</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The parameter name of the closure hints to how it should be provided, being named <code>areInIncreasingOrder</code>.
The closure will take two values of the output type of the upstream publisher, and within it you should provide a boolean result indicating if they are in increasing order.</p>
</div>
<div class="paragraph">
<p>The operator will not provide any results under the upstream published has sent a <code>.finished</code> completion.
If the upstream publisher sends a <code>failure</code> completion, then no values will be published and the <code>.failure</code> completion will be forwarded.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-trymax">tryMax</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Publishes the <code>max</code> value of all values received upon completion of the upstream publisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The output type of the upstream publisher must conform to <a href="https://developer.apple.com/documentation/swift/comparable"><code>Comparable</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/sequence/3344605-trymax"><code>tryMax</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryMax</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MathOperatorTests.swift"><code>UsingCombineTests/MathOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>A variation of the <a href="#reference-max">max</a> operator that takes a closure to define ordering, and it also allowed to throw an error.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="reference-min">min</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Publishes the minimum value of all values received upon completion of the upstream publisher.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/min.svg" alt="min operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The output type of the upstream publisher must conform to <a href="https://developer.apple.com/documentation/swift/comparable"><code>Comparable</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/sequence/3211194-min"><code>min</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>min</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MathOperatorTests.swift"><code>UsingCombineTests/MathOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>min</code> can be set up with either no parameters, or taking a closure.
If defined as an operator with no parameters, the Output type of the upstream publisher must conform to <a href="https://developer.apple.com/documentation/swift/comparable"><code>Comparable</code></a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">min</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If what you are publishing doesn&#8217;t conform to <a href="https://developer.apple.com/documentation/swift/comparable"><code>Comparable</code></a>, then you may specify a closure to provide the ordering for the operator.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">min</span> <span class="p">{</span> <span class="p">(</span><span class="n">struct1</span><span class="p">,</span> <span class="n">struct2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">struct1</span><span class="o">.</span><span class="n">property1</span> <span class="o">&lt;</span> <span class="n">struct2</span><span class="o">.</span><span class="n">property1</span>
    <span class="c1">// returning boolean true to order struct2 greater than struct1</span>
    <span class="c1">// the underlying method parameter for this closure hints to it:</span>
    <span class="c1">// `areInIncreasingOrder`</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The parameter name of the closure hints to how it should be provided, being named <code>areInIncreasingOrder</code>.
The closure will take two values of the output type of the upstream publisher, and within it you should provide a boolean result indicating if they are in increasing order.</p>
</div>
<div class="paragraph">
<p>The operator will not provide any results under the upstream published has sent a <code>.finished</code> completion.
If the upstream publisher sends a <code>.failure</code> completion, then no values will be published and the <code>failure</code> completion will be forwarded.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-trymin">tryMin</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Publishes the minimum value of all values received upon completion of the upstream publisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The output type of the upstream publisher must conform to <a href="https://developer.apple.com/documentation/swift/comparable"><code>Comparable</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/sequence/3344606-trymin"><code>tryMin</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryMin</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MathOperatorTests.swift"><code>UsingCombineTests/MathOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>A variation of the <a href="#reference-min">min</a> operator that takes a closure to define ordering, and it also allowed to throw an error.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="reference-count">count</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>count publishes the number of items received from the upstream publisher</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/count.svg" alt="count operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/count"><code>count</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>count</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MathOperatorTests.swift"><code>UsingCombineTests/MathOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The operator will not provide any results under the upstream published has sent a <code>.finished</code> completion.
If the upstream publisher sends a <code>.failure</code> completion, then no values will be published and the <code>failure</code> completion will be forwarded.</p>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-criteria">Applying matching criteria to elements</h4>
<div class="sect4">
<h5 id="reference-allsatisfy">allSatisfy</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that publishes a single Boolean value that indicates whether all received elements pass a provided predicate.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/allsatisfy.svg" alt="allSatisfy operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/allsatisfy"><code>allSatisfy</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>allSatisfy</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/CriteriaOperatorTests.swift"><code>UsingCombineTests/CriteriaOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>similar to the <a href="#reference-containswhere">containsWhere</a> operator, this operator is provided with a closure.
The type of the incoming value to this closure must match the Output type of the upstream publisher, and the closure must return a Boolean.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The operator will compare any incoming values, only responding when the upstream publisher sends a <code>.finished</code> completion.
At that point, the <code>allSatisfies</code> operator will return a single boolean value indicating if all the values received matched (or not) based on processing through the provided closure.</p>
</div>
<div class="paragraph">
<p>If the operator receives a <code>.failure</code> completion from the upstream publisher, or throws an error itself, then no data values will be published to subscribers.
In those cases, the operator will only return (or forward) the <code>.failure</code> completion.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryallsatisfy">tryAllSatisfy</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that publishes a single Boolean value that indicates whether all received elements pass a given throwing predicate.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/tryallsatisfy"><code>tryAllSatisfy</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryAllSatisfy</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/CriteriaOperatorTests.swift"><code>UsingCombineTests/CriteriaOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>similar to the <a href="#reference-trycontainswhere">tryContainsWhere</a> operator, you provide this operator with a closure which may also throw an error.
The type of the incoming value to this closure must match the Output type of the upstream publisher, and the closure must return a Boolean.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The operator will compare any incoming values, only responding when the upstream publisher sends a <code>.finished</code> completion.
At that point, the <code>tryAllSatisfies</code> operator will return a single boolean value indicating if all the values received matched (or not) based on processing through the provided closure.</p>
</div>
<div class="paragraph">
<p>If the operator receives a <code>.failure</code> completion from the upstream publisher, or throws an error itself, then no data values will be published to subscribers.
In those cases, the operator will only return (or forward) the <code>.failure</code> completion.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-contains">contains</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that emits a Boolean value when a specified element is received from its upstream publisher.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/contains.svg" alt="contains operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The upstream publisher&#8217;s output value must conform to the <a href="https://developer.apple.com/documentation/swift/equatable"><code>Equatable</code></a> protocol</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/contains"><code>contains</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>contains</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/CriteriaOperatorTests.swift"><code>UsingCombineTests/CriteriaOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The simplest form of <code>contains</code> accepts a single parameter.
The type of this parameter must match the Output type of the upstream publisher.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The operator will compare any incoming values, only responding when the incoming value is equatable to the parameter provided.
When it does find a match, the operator returns a single boolean value (<code>true</code>) and then terminates the stream.
Any further values published from the upstream provider are then ignored.</p>
</div>
<div class="paragraph">
<p>If the upstream published sends a <code>.finished</code> completion before any values do match, the operator will publish a single boolean (<code>false</code>) and then terminate the stream.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-containswhere">containsWhere</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that emits a Boolean value upon receiving an element that satisfies the predicate closure.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/containswhere.svg" alt="containsWhere operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/containswhere"><code>containsWhere</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>containsWhere</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/CriteriaOperatorTests.swift"><code>UsingCombineTests/CriteriaOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>A more flexible version of the <a href="#reference-contains">contains</a> operator.
Instead of taking a single parameter value to match, you provide a closure which takes in a single value (of the type provided by the upstream publisher) and returns a boolean.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Like <a href="#reference-contains">contains</a>, it will compare multiple incoming values, only responding when the incoming value is equatable to the parameter provided.
When it does find a match, the operator returns a single boolean value and  terminates the stream.
Any further values published from the upstream provider are ignored.</p>
</div>
<div class="paragraph">
<p>If the upstream published sends a <code>.finished</code> completion before any values do match, the operator will publish a single boolean (<code>false</code>) and terminates the stream.</p>
</div>
<div class="paragraph">
<p>If you want a variant of this functionality that checks multiple incoming values to determine if all of them match, consider using the <a href="#reference-allsatisfy">allSatisfy</a> operator.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-trycontainswhere">tryContainsWhere</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that emits a Boolean value upon receiving an element that satisfies the throwing predicate closure.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/trycontainswhere"><code>tryContainsWhere</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryContainsWhere</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/CriteriaOperatorTests.swift"><code>UsingCombineTests/CriteriaOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>A variation of the <a href="#reference-trycontainswhere">tryContainsWhere</a> operator which allows the closure to throw an error.
You provide a closure which takes in a single value (of the type provided by the upstream publisher) and returns a boolean.
This closure may also throw an error.
If the closure throws an error, then the operator will return no values, only the error to any subscribers, terminating the pipeline.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Like <a href="#reference-contains">contains</a>, it will compare multiple incoming values, only responding when the incoming value is equatable to the parameter provided.
When it does find a match, the operator returns a single boolean value and terminates the stream.
Any further values published from the upstream provider are ignored.</p>
</div>
<div class="paragraph">
<p>If the upstream published sends a <code>.finished</code> completion before any values do match, the operator will publish a single boolean (<code>false</code>) and terminates the stream.</p>
</div>
<div class="paragraph">
<p>If the operator receives a <code>.failure</code> completion from the upstream publisher, or throws an error itself, no data values will be published to subscribers.
In those cases, the operator will only return (or forward) the <code>.failure</code> completion.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-sequence">Applying sequence operations to elements</h4>
<div class="sect4">
<h5 id="reference-first">first</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Publishes the first element of a stream and then finishes.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/first.svg" alt="first operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/first"><code>first</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>first</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-first">first</a> operator, when used without any parameters, will pass through the first value it receives, after which it sends a <code>.finish</code> completion message to any subscribers.
If no values are received before the first operator receives a <code>.finish</code> completion from upstream publishers, the stream is terminated and no values are published.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">first</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want a set number of values from the front of the stream you can also use <a href="#reference-prefixuntiloutput">prefixUntilOutput</a> or the variants: <a href="#reference-prefixwhile">prefixWhile</a> and <a href="#reference-tryprefixwhile">tryPrefixWhile</a>.</p>
</div>
<div class="paragraph">
<p>If you want a set number of values from the middle the stream by count, you may want to use <a href="#reference-output">output</a>, which allows you to select either a single value, or a range value from the sequence of values received by this operator.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-firstwhere">firstWhere</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that only publishes the first element of a stream to satisfy a predicate closure.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/firstwhere"><code>firstWhere</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>firstWhere</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-firstwhere">firstWhere</a> operator is similar to <a href="#reference-first">first</a>, but instead lets you specify if the value should be the first value published by evaluating a closure.
The provided closure should accept a value of the type defined by the upstream publisher, returning a bool.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">first</span> <span class="p">{</span> <span class="p">(</span><span class="n">incomingobject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">incomingobject</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The first value received that satisfies this closure - that is, has count greater than 3 - is published.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to support an error condition that will terminate the pipeline within this closure, use <a href="#reference-tryfirstwhere">tryFirstWhere</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryfirstwhere">tryFirstWhere</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that only publishes the first element of a stream to satisfy a throwing predicate closure.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/tryfirstwhere"><code>tryFirstWhere</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryFirstWhere</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-tryfirstwhere">tryFirstWhere</a> operator is a variant of <a href="#reference-firstwhere">firstWhere</a> that accepts a closure that can throw an error.
The closure provided should accept a value of the type defined by the upstream publisher, returning a bool.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">tryFirst</span> <span class="p">{</span> <span class="p">(</span><span class="n">incomingobject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">incomingobject</span> <span class="o">==</span> <span class="s">"boom"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="kt">TestExampleError</span><span class="o">.</span><span class="n">invalidValue</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">incomingobject</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-last">last</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that only publishes the last element of a stream, once the stream finishes.</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/last.svg" alt="last operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/last"><code>last</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>last</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-last">last</a> operator waits until the upstream publisher sends a <code>finished</code> completion, then publishes the last value it received.
If no values were received prior to receiving the <code>finished</code> completion, no values are published to subscribers.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">last</span><span class="p">()</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-lastwhere">lastWhere</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that only publishes the last element of a stream that satisfies a predicate closure, once the stream finishes.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/lastwhere"><code>lastWhere</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>lastWhere</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-lastwhere">lastWhere</a> operator takes a single closure, accepting a value matching the output type of the upstream publisher, and returning a boolean.
The operator publishes a value when the upstream published completes with a <code>.finished</code> completion.
The value published will be the last one to satisfy the provide closure.
If no values satisfied the closure, then no values are published and the pipeline is terminated normally with a <code>.finished</code> completion.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">last</span> <span class="p">{</span> <span class="p">(</span><span class="n">incomingobject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">incomingobject</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Publishes the last value that has a length greater than 3.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-trylastwhere">tryLastWhere</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that only publishes the last element of a stream that satisfies a error-throwing predicate closure, once the stream finishes.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/trylastwhere"><code>tryLastWhere</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryLastWhere</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-trylastwhere">tryLastWhere</a> operator is a variant of the <a href="#reference-lastwhere">lastWhere</a> operator that accepts a closure that may also throw an error.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">tryLast</span> <span class="p">{</span> <span class="p">(</span><span class="n">incomingobject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">incomingobject</span> <span class="o">==</span> <span class="s">"boom"</span><span class="p">)</span> <span class="p">{</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="k">throw</span> <span class="kt">TestExampleError</span><span class="o">.</span><span class="n">invalidValue</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">incomingobject</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Publishes the last value that has a length greater than 3.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Logic that triggers an error, which will terminate the pipeline.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-dropuntiloutput">dropUntilOutput</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that ignores elements from the upstream publisher until it receives an element from second publisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/dropuntiloutput"><code>dropUntilOutput</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>dropUntilOutput</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-dropuntiloutput">dropUntilOutput</a> operator uses another publisher as a trigger, stopping output through a pipeline until a value is received.
Values received from the upstream publisher are ignored (and dropped) until the trigger is activated.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Any value propagated through the trigger publisher will cause the switch to activate, and allow future values through the pipeline.</p>
</div>
<div class="paragraph">
<p>Errors are still propagated from the upstream publisher, terminating the pipeline with a <code>failure</code> completion.
An error (<code>failure</code> completion) on either the upstream publisher or the trigger publisher will be propagated to any subscribers and terminate the pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">drop</span><span class="p">(</span><span class="nv">untilOutputFrom</span><span class="p">:</span> <span class="n">triggerPublisher</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use this kind of mechanism, but with a closure determining values from the upstream publisher, use the <a href="#reference-dropwhile">dropWhile</a> operator.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-dropwhile">dropWhile</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that omits elements from an upstream publisher until a given closure returns false.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/dropwhile"><code>dropWhile</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>dropWhile</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-dropwhile">dropWhile</a> operator takes a single closure, accepting an input value of the output type defined by the upstream publisher, returning a bool.
This closure is used to determine a trigger condition, after which values are allowed to propagate.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This is not the same as the <a href="#reference-filter">filter</a> operator, acting on each value.
Instead it uses a trigger that activates once, and propagates all values after it is activated until the upstream publisher finishes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">drop</span> <span class="p">{</span> <span class="n">upstreamValue</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">upstreamValue</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to use this mechanism, but with a publisher as the trigger instead of a closure, use the <a href="#reference-dropuntiloutput">dropUntilOutput</a> operator.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-trydropwhile">tryDropWhile</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that omits elements from an upstream publisher until a given error-throwing closure returns false.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/trydropwhile"><code>tryDropWhile</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryDropWhile</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>This is a variant of the <a href="#reference-dropwhile">dropWhile</a> operator that accepts a closure that can also throw an error.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">tryDrop</span> <span class="p">{</span> <span class="n">upstreamValue</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">upstreamValue</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-prepend">prepend</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that emits all of one publisher’s elements before those from another publisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Both publishers must match on Output and Failure types.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/concatenate"><code>concatenate</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>prepend</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-prepend">prepend</a> operator will act as a merging of two pipelines.
Also known as <code>Publishers.Concatenate</code>, it accepts all values from one publisher, publishing them to subscribers.
Once the first publisher is complete, the second publisher is used to provide values until it is complete.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The most general form of this can be invoked directly as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kt">Publishers</span><span class="o">.</span><span class="kt">Concatenate</span><span class="p">(</span><span class="nv">prefix</span><span class="p">:</span> <span class="n">firstPublisher</span><span class="p">,</span> <span class="nv">suffix</span><span class="p">:</span> <span class="n">secondPublisher</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is equivalent to the form directly in a pipeline:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="n">secondPublisher</span>
<span class="o">.</span><span class="nf">prepend</span><span class="p">(</span><span class="n">firstPublisher</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="#reference-prepend">prepend</a> operator is often used with single or sequence values that have a failure type of <code>&lt;Never&gt;</code>.
If the publishers do accept a failure type, then all values will be published from the prefix publisher even if the suffix publisher receives a <code>.failure</code> completion before it is complete.
Once the prefix publisher completes, the error will be propagated.</p>
</div>
<div class="paragraph">
<p>The <a href="#reference-prepend">prepend</a> operator also has convenience operators to send a sequence.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="n">secondPublisher</span>
<span class="o">.</span><span class="nf">prepend</span><span class="p">([</span><span class="s">"one"</span><span class="p">,</span> <span class="s">"two"</span><span class="p">])</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The sequence values will be published immediately on a subscriber requesting demand.
Further demand will be propagated upward to <code>secondPublisher</code>.
Values produced from <code>secondPublisher</code> will then be published until it completes.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another convenience operator exists to send a single value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="n">secondPublisher</span>
<span class="o">.</span><span class="nf">prepend</span><span class="p">(</span><span class="s">"one"</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The value will be published immediately on a subscriber requesting demand.
Further demand will be propagated upward to <code>secondPublisher</code>.
Values produced from <code>secondPublisher</code> will then be published until it completes.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-drop">drop</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that omits a specified number of elements before republishing later elements.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/drop"><code>drop</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>drop</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The simplest form of the <a href="#reference-drop">drop</a> operator drops a single value and then allows all further values to propagate through the pipeline.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">dropFirst</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A variant of this operator allows a count of values to be specified:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">dropFirst</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Drops the first three values received from the upstream publisher before propagating any further values published to downstream subscribers.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-prefixuntiloutput">prefixUntilOutput</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Republishes elements until another publisher emits an element. After the second publisher publishes an element, the publisher returned by this method finishes.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/prefixuntiloutput"><code>prefixUntilOutput</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>prefixUntilOutput</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-prefixuntiloutput">prefixUntilOutput</a> will propagate values from an upstream publisher until a second publisher is used as a trigger.
Once the trigger is activated by receiving a value, the operator will terminate the stream.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">prefix</span><span class="p">(</span><span class="nv">untilOutputFrom</span><span class="p">:</span> <span class="n">secondPublisher</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-prefixwhile">prefixWhile</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that republishes elements while a predicate closure indicates publishing should continue.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/prefixwhile"><code>prefixWhile</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>prefixWhile</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-prefixwhile">prefixWhile</a> operator takes a single closure, with an input matching the output type defined by the upstream publisher, returning a boolean.
This closure is evaluated on the data from the upstream publisher.
While it returns <code>true</code> the values are propagated to the subscriber.
Once the value returns <code>false</code>, the operator terminates the stream with a <code>.finished</code> completion.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="k">prefix</span> <span class="p">{</span> <span class="n">upstreamValue</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">upstreamValue</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-tryprefixwhile">tryPrefixWhile</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that republishes elements while an error-throwing predicate closure indicates publishing should continue.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/tryprefixwhile"><code>tryPrefixWhile</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>tryPrefixWhile</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-tryprefixwhile">tryPrefixWhile</a> operator is a variant of the <a href="#reference-prefixwhile">prefixWhile</a> operator that accepts a closure and may also throw an error.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="k">prefix</span> <span class="p">{</span> <span class="n">upstreamValue</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">upstreamValue</span><span class="o">.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">3</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-output">output</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that publishes elements specified by a range in the sequence of published elements.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/output"><code>output</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>output</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SequentialOperatorTests.swift"><code>UsingCombineTests/SequentialOperatorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <a href="#reference-output">output</a> operator takes a single parameter, either an integer or a swift range.
This value is used to select a specific value, or sequence of values, from an upstream publisher to send to subscribers.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="#reference-output">output</a> is choosing values from the middle of the stream.
If the upstream publisher completes before the values is received, the <code>.finished</code> completion will be propagated to the subscriber.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">output</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">3</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The selection is 0 indexed (meaning the count starts at 0).
This will select the fourth item published from the upstream publisher to propagate.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The alternate form takes a swift range descriptor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">output</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="mi">2</span><span class="o">...</span><span class="mi">3</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The selection is 0 indexed (the count starts at 0).
This will select the third and fourth item published from the upstream publisher to propagate.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-combinepublishers">Mixing elements from multiple publishers</h4>
<div class="sect4">
<h5 id="reference-combinelatest">combineLatest</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>CombineLatest</code> merges two pipelines into a single output, converting the output type to a tuple of values from the upstream pipelines, and providing an update when any of the upstream publishers provide a new value.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publishers</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>All upstream publishers must have the same failure type.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/combinelatest"><code>combineLatest</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/combinelatest3"><code>combineLatest3</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/combinelatest4"><code>combineLatest4</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-merging-streams-interface">Merging multiple pipelines to update UI elements</a></p>
</li>
<li>
<p>unit tests illustrating using <code>combineLatest</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MergingPipelineTests.swift"><code>UsingCombineTests/MergingPipelineTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>CombineLatest, and its variants of <code>combineLatest3</code> and <code>combineLatest4</code>, take multiple upstream publishers and create a single output stream, merging the streams together.
<code>CombineLatest</code> merges two upstream publishers.
<code>ComineLatest3</code> merges three upstream publishers and <code>combineLatest4</code> merges four upstream publishers.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The output type of the operator is a tuple of the output types of each of the publishers.
For example, if combineLatest was used to merge a publisher with the output type of <code>&lt;String&gt;</code> and another with the output type of <code>&lt;Int&gt;</code>, the resulting output type would be a tuple of <code>(&lt;String, Int&gt;)</code>.</p>
</div>
<div class="paragraph">
<p><code>CombineLatest</code> is most often used with continual publishers, and remembering the last output value provided from each publisher.
In turn, when any of the upstream publishers sends an updated value, the operator makes a new combined tuple of all previous "current" values, adds in the new value in the correct place, and sends that new combined value down the pipeline.</p>
</div>
<div class="paragraph">
<p>The <code>CombineLatest</code> operator requires the failure types of all three upstream publishers to be identical.
For example, you can not have one publisher that has a failure type of <code>Error</code> and another (or more) that have a failure type of <code>Never</code>.
If the <code>combineLatest</code> operator does receive a failure from any of the upstream publishers, then the operator (and the rest of the pipeline) is cancelled after propagating that failure.</p>
</div>
<div class="paragraph">
<p>If any of the upstream publishers finish normally (that is, they send a <code>.finished</code> completion), the <code>combineLatest</code> operator will continue operating and processing any messages from any of the other publishers that has additional data to send.</p>
</div>
<div class="paragraph">
<p>Other operators that merge multiple upstream pipelines include <a href="#reference-merge">merge</a> and <a href="#reference-zip">zip</a>.
If your upstream publishers have the same type and you want a stream of single values as opposed to tuples, use the <a href="#reference-merge">merge</a> operator.
If you want to wait on values from all upstream provides before providing an updated value, use the <a href="#reference-zip">zip</a> operator.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-merge">merge</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Merge</code> takes two upstream publishers and mixes the elements published into a single pipeline as they are received.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publishers</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>All upstream publishers must have the same output type.</p>
</li>
<li>
<p>All upstream publishers must have the same failure type.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/merge"><code>merge</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/merge3"><code>merge3</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/merge4"><code>merge4</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/merge5"><code>merge5</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/merge6"><code>merge6</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/merge7"><code>merge7</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/merge8"><code>merge8</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>merge</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MergingPipelineTests.swift"><code>UsingCombineTests/MergingPipelineTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Merge</code> subscribers to two upstream publishers, and as they provide data for the subscriber it interleaves them into a single pipeline.
<code>Merge3</code> accepts three upstream publishers, <code>merge4</code> accepts four upstream publishers, and so forth - through <code>merge8</code> accepting eight upstream publishers.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In all cases, the upstreams publishers are required to have the same output type, as well as the same failure type.</p>
</div>
<div class="paragraph">
<p>As with <a href="#reference-combinelatest">combineLatest</a>, if an error is propagated down any of the upstream publishers, the cancellation from the subscriber will terminate this operator and will propagate cancel to all upstream publishers as well.</p>
</div>
<div class="paragraph">
<p>If an upstream publisher completes with a normal finish, the <code>merge</code> operator continues interleaving and forwarding from any values other upstream publishers.</p>
</div>
<div class="paragraph">
<p>In the unlikely event that two values are provided at the same time from upstream publishers, the <code>merge</code> operator will interleave the values in the order upstream publishers are specified when the operator is initialized.</p>
</div>
<div class="paragraph">
<p>If you want to mix different upstream publisher types into a single stream, then you likely want to use either <a href="#reference-combinelatest">combineLatest</a> or <a href="#reference-zip">zip</a>, depending on how you want the timing of values to be handled.</p>
</div>
<div class="paragraph">
<p>If your upstream publishers have different types, but you want interleaved values to be propagated as they are available, use <a href="#reference-combinelatest">combineLatest</a>.
If you want to wait on values from all upstream provides before providing an updated value, then use the <a href="#reference-zip">zip</a> operator.</p>
</div>
</div>
<div class="sect4 MergeMany">
<h5 id="reference-Publishers">MergeMany</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>The <code>MergeMany</code> publisher takes multiple upstream publishers and mixes the published elements into a single pipeline as they are received. The upstream publisher can be of any type.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publishers</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>All upstream publishers must have the same output type.</p>
</li>
<li>
<p>All upstream publishers must have the same failure type.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/mergemany"><code>Publishers.MergeMany</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Unit tests illustrating using <code>MergeMany</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MergeManyPublisherTests.swift"><code>UsingCombineTests/MergeManyPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>When you went to mix together data from multiple sources as the data arrives, <code>MergeMany</code> provides a common solution for a wide number of publishers.
It is an evolution of the Merge3, Merge4, etc sequence of publishers that came about as the Swift language enabled variadic parameters.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Like <a href="#reference-merge">merge</a>, it publishes values until all publishers send a finished completion, or cancels entirely if any of the publishers sends a cancellation completion.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-zip">zip</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Zip</code> takes two upstream publishers and mixes the elements published into a single pipeline, waiting until values are paired up from each upstream publisher before forwarding the pair as a tuple.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publishers</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>All upstream publishers must have the same failure type.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/zip"><code>zip</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/zip3"><code>zip3</code></a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/publishers/zip4"><code>zip4</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>zip</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MergingPipelineTests.swift"><code>UsingCombineTests/MergingPipelineTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Zip</code> works very similarly to <a href="#reference-combinelatest">combineLatest</a>, connecting two upstream publishers and providing the output of those publishers as a single pipeline with a tuple output type composed of the types of the upstream publishers.
<code>Zip3</code> supports connecting three upstream publishers, and <code>zip4</code> supports connecting four upstream publishers.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The notable difference from <a href="#reference-combinelatest">combineLatest</a> is that <code>zip</code> waits for values to arrive from the upstream publishers, and will only publish a single new tuple when new values have been provided from all upstream publishers.</p>
</div>
<div class="paragraph">
<p>One example of using this is to wait until all streams have provided a single value to provide a synchronization point.
For example, if you have two independent network requests and require them to both be complete before continuing to process the results, you can use <code>zip</code> to wait until both publishers are complete before forwarding the combined tuples.</p>
</div>
<div class="paragraph">
<p>Other operators that merge multiple upstream pipelines include <a href="#reference-combinelatest">combineLatest</a> and <a href="#reference-merge">merge</a>.
If your upstream publishers have different types, but you want interleaved values to be propagated as they are available, use <a href="#reference-combinelatest">combineLatest</a>.
If your upstream publishers have the same type and you want a stream of single values, as opposed to tuples, then you probably want to use the <a href="#reference-merge">merge</a> operator.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-handlingerrors">Error Handling</h4>
<div class="paragraph">
<p>See <a href="#patterns-general-error-handling">Error Handling</a> for more detail on how you can design error handling.</p>
</div>
<div class="sect4">
<h5 id="reference-catch">catch</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>The operator <code>catch</code> handles errors (completion messages of type <code>.failure</code>) from an upstream publisher by replacing the failed publisher with another publisher.
The <code>catch</code> operator also transforms the Failure type to <code>&lt;Never&gt;</code>.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> Documentation reference</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/catch"><code>Publishers.Catch</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a> shows an example of using <code>catch</code> to handle errors with a one-shot publisher.</p>
</li>
<li>
<p><a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a> shows an example of using <code>catch</code> with <code>flatMap</code> to handle errors with a continual publisher.</p>
</li>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Once <code>catch</code> receives a <code>.failure</code> completion, it won&#8217;t send any further incoming values from the original upstream publisher.
You can also view <code>catch</code> as a switch that only toggles in one direction: to using a new publisher that you define, but only when the original publisher to which it is subscribed sends an error.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This is illustrated with the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">enum</span> <span class="kt">TestFailureCondition</span><span class="p">:</span> <span class="kt">Error</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">invalidServerResponse</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">simplePublisher</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">simplePublisher</span>
    <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
        <span class="c1">// must return a Publisher</span>
        <span class="k">return</span> <span class="kt">Just</span><span class="p">(</span><span class="s">"replacement value"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">fini</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion:"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">fini</span><span class="p">))</span>
    <span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">stringValue</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="n">stringValue</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">})</span>

<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"oneValue"</span><span class="p">)</span>
<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"twoValue"</span><span class="p">)</span>
<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="kt">Subscribers</span><span class="o">.</span><span class="kt">Completion</span><span class="o">.</span><span class="nf">failure</span><span class="p">(</span><span class="kt">TestFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span><span class="p">))</span>
<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"redValue"</span><span class="p">)</span>
<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="s">"blueValue"</span><span class="p">)</span>
<span class="n">simplePublisher</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="nv">completion</span><span class="p">:</span> <span class="o">.</span><span class="n">finished</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we are using a <code>PassthroughSubject</code> so that we can control when and what gets sent from the publisher.
In the above code, we are sending two good values, then a failure, then attempting to send two more good values.
The values you would see printed from our <code>.sink()</code> closures are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>.sink() received oneValue
.sink() received twoValue
.sink() received replacement value
.sink() received the completion: finished</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the failure was sent through the pipeline, catch intercepts it and returns a replacement value.
The replacement publisher it used (<code>Just</code>) sends a single value and then a completion.
If we want the pipeline to remain active, we need to change how we handle the errors.
See the pattern <a href="#patterns-continual-error-handling">Using flatMap with catch to handle errors</a> for an example of how that can be achieved.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-trycatch">tryCatch</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A variant of the <a href="#reference-catch">catch</a> operator that also allows an <code>&lt;Error&gt;</code> failure type, and doesn&#8217;t convert the failure type to <code>&lt;Never&gt;</code>.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/trycatch"><code>tryCatch</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-constrained-network">Requesting data from an alternate URL when the network is constrained</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>tryCatch</code> is a variant of <a href="#reference-catch">catch</a> that has a failure type of <code>&lt;Error&gt;</code> rather than catch&#8217;s failure type of <code>&lt;Never&gt;</code>.
This allows it to be used where you want to immediately react to an error by creating another publisher that may also produce a failure type.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="reference-assertnofailure">assertNoFailure</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Raises a fatal error when its upstream publisher fails, and otherwise republishes all received input and converts failure type to <code>&lt;Never&gt;</code>.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/assertnofailure" class="bare">https://developer.apple.com/documentation/combine/publishers/assertnofailure</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-assertnofailure">Verifying a failure hasn&#8217;t happened using assertNoFailure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>If you need to verify that no error has occurred (treating the error output as an invariant), this is the operator to use.
Like its namesakes, it will cause the program to terminate if the assert is violated.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Adding it into the pipeline requires no additional parameters, but you can include a string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">assertNoFailure</span><span class="p">()</span>
<span class="c1">// OR</span>
<span class="o">.</span><span class="nf">assertNoFailure</span><span class="p">(</span><span class="s">"What could possibly go wrong?"</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>I&#8217;m not entirely clear on where that string would appear if you did include it.</p>
</div>
<div class="paragraph">
<p>When trying out this code in unit tests, the tests invariably drop into a debugger at the assertion point when a .failure is processed through the pipeline.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to convert an failure type output of <code>&lt;Error&gt;</code> to <code>&lt;Never&gt;</code>, you probably want to look at the <a href="#reference-catch">catch</a> operator.</p>
</div>
<div class="paragraph">
<p>Apple asserts this function should be primarily used for testing and verifying <em>internal sanity checks that are active during testing</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-retry">retry</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>The <code>retry</code> operator is used to repeat requests to a previous publisher in the event of an error.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>failure type must be <code>&lt;Error&gt;</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/retry" class="bare">https://developer.apple.com/documentation/combine/publishers/retry</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-retry">Retrying in the event of a temporary failure</a></p>
</li>
<li>
<p>unit tests illustrating using <code>retry</code> with dataTaskPublisher: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DataTaskPublisherTests.swift"><code>UsingCombineTests/DataTaskPublisherTests.swift</code></a></p>
</li>
<li>
<p>unit tests illustrating <code>retry</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/RetryPublisherTests.swift"><code>UsingCombineTests/RetryPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>When you specify this operator in a pipeline and it receives a subscription, it first tries to request a subscription from its upstream publisher.
If the response to that subscription fails, then it will retry the subscription to the same publisher.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The retry operator accepts a single parameter that specifies a number of retries to attempt.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using <code>retry</code> with a high count can result in your pipeline not resolving any data or completions for quite a while, depending on how long each attempt takes.
You may also want to consider also using the <a href="#reference-timeout">timeout</a> operator to force a completion from the pipeline.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the number of retries is specified and all requests fail, then the <code>.failure</code> completion is passed down to the subscriber of this operator.</p>
</div>
<div class="paragraph">
<p>In practice, this is mostly commonly desired when attempting to request network resources with an unstable connection.
If you use a <code>retry</code> operator, you should add a specific number of retries so that the subscription doesn&#8217;t effectively get into an infinite loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">struct</span> <span class="kt">IPInfo</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="c1">// matching the data structure returned from ip.jsontest.com</span>
    <span class="k">var</span> <span class="nv">ip</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>
<span class="k">let</span> <span class="nv">myURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"http://ip.jsontest.com"</span><span class="p">)</span>
<span class="c1">// NOTE(heckj): you'll need to enable insecure downloads</span>
<span class="c1">// in your  Info.plist for this example</span>
<span class="c1">// because the URL scheme is 'http'</span>

<span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="n">myURL</span><span class="o">!</span><span class="p">)</span>
    <span class="c1">// the dataTaskPublisher output combination is</span>
    <span class="c1">// (data: Data, response: URLResponse)</span>
    <span class="o">.</span><span class="nf">retry</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="c1">// if the URLSession returns a .failure completion,</span>
    <span class="c1">// retry at most 3 times to get a successful response</span>
    <span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="p">(</span><span class="n">inputTuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span>
        <span class="k">return</span> <span class="n">inputTuple</span><span class="o">.</span><span class="n">data</span>
    <span class="p">})</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">IPInfo</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span>
    <span class="o">.</span><span class="k">catch</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
        <span class="k">return</span> <span class="kt">Publishers</span><span class="o">.</span><span class="kt">Just</span><span class="p">(</span><span class="kt">IPInfo</span><span class="p">(</span><span class="nv">ip</span><span class="p">:</span> <span class="s">"8.8.8.8"</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-maperror">mapError</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Converts any failure from the upstream publisher into a new error.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Failure type is some instance of <code>Error</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/maperror"><code>mapError</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating <code>mapError</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/ChangingErrorTests.swift"><code>UsingCombineTests/ChangingErrorTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>mapError</code> is an operator that allows you to transform the failure type by providing a closure where you convert errors from upstream publishers into a new type.
<code>mapError</code> is similar to <a href="#reference-replaceerror">replaceError</a>, but <code>replaceError</code> ignores any upstream errors and returns a single kind of error, where this operator lets you construct using the error provided by the upstream publisher.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">mapError</span> <span class="p">{</span> <span class="n">error</span> <span class="o">-&gt;</span> <span class="kt">ChangingErrorTests</span><span class="o">.</span><span class="kt">APIError</span> <span class="k">in</span>
    <span class="c1">// if it's our kind of error already, we can return it directly</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="k">as?</span> <span class="kt">APIError</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">error</span>
    <span class="p">}</span>
    <span class="c1">// if it is a URLError, we can convert it into our more general error kind</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">urlerror</span> <span class="o">=</span> <span class="n">error</span> <span class="k">as?</span> <span class="kt">URLError</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">APIError</span><span class="o">.</span><span class="nf">networkError</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">urlerror</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// if all else fails, return the unknown error condition</span>
    <span class="k">return</span> <span class="kt">APIError</span><span class="o">.</span><span class="n">unknown</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-adaptingtypes">Adapting publisher types</h4>
<div class="sect4">
<h5 id="reference-switchtolatest">switchToLatest</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher that flattens any nested publishers, using the most recent provided publisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/switchtolatest"><code>switchToLatest</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
<li>
<p>unit tests illustrating <code>switchToLatest</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SwitchAndFlatMapPublisherTests.swift"><code>UsingCombineTests/SwitchAndFlatMapPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>switchToLatest</code> operates similarly to <a href="#reference-flatmap">flatMap</a>, taking in a publisher instance and returning its value (or values).
Where <a href="#reference-flatmap">flatMap</a> operates over the values it is provided, <code>switchToLatest</code> operates on whatever publisher it is provided.
The primary difference is in where it gets the publisher.
In flatMap, the publisher is returned within the closure provided to flatMap, and the operator works upon that to subscribe and provide the relevant value down the pipeline.
In <code>switchToLatest</code>, the publisher instance is provided <strong>as the output type</strong> from a previous publisher or operator.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The most common form of using this is with a one-shot publisher such as <a href="#reference-just">Just</a> getting its value as a result of a <a href="#reference-map">map</a> transform.</p>
</div>
<div class="paragraph">
<p>It is also commonly used when working with an API that provides a publisher.
<code>switchToLatest</code> assists in taking the result of the publisher and sending that down the pipeline rather than sending the publisher as the output type.</p>
</div>
<div class="paragraph">
<p>The following snippet is part of the larger example <a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">username</span> <span class="o">-&gt;</span> <span class="kt">AnyPublisher</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">GithubAPIUser</span><span class="p">],</span> <span class="kt">Never</span><span class="o">&gt;</span> <span class="k">in</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="k">return</span> <span class="kt">GithubAPI</span><span class="o">.</span><span class="nf">retrieveGithubUser</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="n">username</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="p">}</span>
<span class="c1">// ^^ type returned in the pipeline is a Publisher, so we use</span>
<span class="c1">// switchToLatest to flatten the values out of that</span>
<span class="c1">// pipeline to return down the chain, rather than returning a</span>
<span class="c1">// publisher down the pipeline.</span>
<span class="o">.</span><span class="nf">switchToLatest</span><span class="p">()</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this example, an API instance (GithubAPI) has a function that returns a publisher.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="#reference-map">map</a> takes an earlier <code>String</code> output type, returning a publisher instance.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We want to use the value from that publisher, not the publisher itself, which is exactly what <code>switchToLatest</code> provides.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-timing">Controlling timing</h4>
<div class="sect4">
<h5 id="reference-debounce">debounce</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>debounce collapses multiple values within a specified time window into a single value</p>
</dd>
</dl>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/debounce.svg" alt="tryscan operator">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/debounce_break.svg" alt="tryscan operator">
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/debounce">'debounce'</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>debounce</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift"><code>UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The operator takes a minimum of two parameters, an amount of time over which to <code>debounce</code> the signal and a scheduler on which to apply the operations.
The operator will collapse any values received within the timeframe provided to a single, last value received from the upstream publisher within the time window.
If any value is received within the specified time window, it will collapse it.
It will  not return a result until the entire time window has elapsed with no additional values appearing.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This operator is frequently used with <a href="#reference-removeduplicates">removeDuplicates</a> when the publishing source is bound to UI interactions, primarily to prevent an "edit and revert" style of interaction from triggering unnecessary work.</p>
</div>
<div class="paragraph">
<p>If you wish to control the value returned within the time window, or if you want to simply control the volume of events by time, you may prefer to use <a href="#reference-throttle">throttle</a>, which allows you to choose the first or last value provided.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-delay">delay</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Delays delivery of all output to the downstream receiver by a specified amount of time on a particular scheduler.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/delay"><code>delay</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-delegate-publisher-subject">Creating a repeating publisher by wrapping a delegate based API</a></p>
</li>
<li>
<p><a href="#patterns-retry">Retrying in the event of a temporary failure</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <code>delay</code> operator passes through the data after a delay defined to the operator.
The <code>delay</code> operator also requires a scheduler, where the delay is explicitly invoked.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">delay</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">headingBackgroundQueue</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-measureinterval">measureInterval</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>measureInterval</code> measures and emits the time interval between events received from an upstream publisher, in turn publishing a value of <code>SchedulerTimeType.Stride</code> (which includes a magnitude and interval since the last value).
The specific upstream value is ignored beyond the detail of the time at which it was received.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/measureinterval"><code>measureInterval</code></a></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Output types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.apple.com/documentation/dispatch/dispatchqueue/schedulertimetype/stride">DispatchQueue.SchedulerTimeType.Stride</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/foundation/operationqueue/schedulertimetype/stride">OperationQueue.SchedulerTimeType.Stride</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/foundation/runloop/schedulertimetype/stride">RunLoop.SchedulerTimeType.Stride</a></p>
</li>
<li>
<p><a href="https://developer.apple.com/documentation/combine/immediatescheduler/schedulertimetype/stride">Immediate.SchedulerTimeType.Stride</a></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using throttle: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MeasureIntervalTests.swift"><code>UsingCombineTests/MeasureIntervalTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The operator takes a single parameter, the scheduler to be used.
The output type is the type <code>SchedulerTimeType.Stride</code> for the scheduler you designate.</p>
</dd>
</dl>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">measureInterval</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="n">q</span><span class="p">)</span> <span class="c1">// Output type is DispatchQueue.SchedulerTimeType.Stride</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>magnitude</code> (an Int) the stride is the number of nanoseconds since the last value, which is generally in nanoseconds.
You can also use the <code>interval</code> (a <a href="https://developer.apple.com/documentation/dispatch/dispatchtimeinterval"><code>DispatchTimeInterval</code></a>) which carries with it the specific units of the interval.</p>
</div>
<div class="paragraph">
<p>These values are not guaranteed on a high resolution timer, so use the resulting values judiciously.</p>
</div>
</div>
<div class="sect4">
<h5 id="reference-throttle">throttle</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Throttle</code> constrains the stream to publishing zero or one value within a specified time window, independent of the number of elements provided by the publisher.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Timing diagram with latest set to <code>true</code>:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/throttle_true.svg" alt="tryscan operator">
</div>
</div>
<div class="paragraph">
<p>Timing diagram with latest set to <code>false</code>:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/diagrams/throttle_false.svg" alt="tryscan operator">
</div>
</div>
<div class="paragraph">
<p>The timing examples in the marble diagrams are from the unit tests running under iOS 13.3.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/throttle"><code>throttle</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>throttle</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift"><code>UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Throttle</code> is akin to the <a href="#reference-debounce">debounce</a> operator in that it collapses values.
The primary difference is that <code>debounce</code> will wait for no further values, where <code>throttle</code> will last for a specific time window and then publish a result.
The operator will collapse any values received within the timeframe provided to a single value received from the upstream publisher within the time window.
The value chosen within the time window is influenced by the parameter <code>latest</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If values are received very close to the edges of the time window, the results can be a little unexpected.</p>
</div>
<div class="paragraph">
<p>The operator takes a minimum of three parameters, <code>for</code>: an amount of time over which to collapse the values received, <code>scheduler</code>: a scheduler on which to apply the operations, and <code>latest</code>: a boolean indicating if the first value or last value should be chosen.</p>
</div>
<div class="paragraph">
<p>This operator is often used with <a href="#reference-removeduplicates">removeDuplicates</a> when the publishing source is bound to UI interactions, primarily to prevent an "edit and revert" style of interaction from triggering unnecessary work.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">throttle</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">,</span> <span class="nv">latest</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In iOS 13.2 the behavior for setting <code>latest</code> to false appears to have changed from previous releases.
This was reported to apple as Feedback FB7424221.
This behavior changed again in Xcode 11.3 (iOS 13.3), most notably in changes when the upstream publisher starts with an initial value (such as @Published).
This results in extraneous early results (in iOS 13.3).
After the initial sliding window expires the results get far more consistent.</p>
</div>
<div class="paragraph">
<p>If you are relying on specific timing for some of your functions, double check you systems with tests to verify the behavior.
The outputs for timing scenarios are detailed in comments within the <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DebounceAndRemoveDuplicatesPublisherTests.swift">throttle unit tests</a> written for this book.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-timeout">timeout</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Terminates publishing if the upstream publisher exceeds the specified time interval without producing an element.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Requires the failure type to be <code>&lt;Never&gt;</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/timeout" class="bare">https://developer.apple.com/documentation/combine/publishers/timeout</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>retry</code> and <code>timeout</code> with <code>dataTaskPublisher</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/DataTaskPublisherTests.swift"><code>UsingCombineTests/DataTaskPublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Timeout</code> will force a resolution to a pipeline after a given amount of time, but does not guarantee either data or errors, only a completion.
If a <code>timeout</code> does trigger and force a completion, it will not generate an failure completion with an error.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>Timeout</code> is specified with two parameters: <code>time</code> and <code>scheduler</code>.</p>
</div>
<div class="paragraph">
<p>If you are using a specific background thread (for example, with the <a href="#reference-subscribe">subscribe</a> operator), then timeout should likely be using the same scheduler.</p>
</div>
<div class="paragraph">
<p>The time period specified will take a literal integer, but otherwise needs to conform to the protocol <a href="https://developer.apple.com/documentation/combine/schedulertimeintervalconvertible">SchedulerTimeIntervalConvertible</a>.
If you want to set a number from a <code>Float</code> or <code>Int</code>, you need to create the relevant structure, as <code>Int</code> or <code>Float</code> does not conform to <code>SchedulerTimeIntervalConvertible</code>.
For example, while using a <code>DispatchQueue</code>, you could use <a href="https://developer.apple.com/documentation/dispatch/dispatchqueue/schedulertimetype/stride">DispatchQueue.SchedulerTimeType.Stride</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="n">urlSession</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">mockURL</span><span class="o">!</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">delay</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">retry</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1">// 5 retries, 2 seconds each ~ 10 seconds for this to fall through</span>
    <span class="o">.</span><span class="nf">timeout</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span> <span class="c1">// max time of 5 seconds before failing</span>
    <span class="o">.</span><span class="n">tryMap</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span> <span class="o">-&gt;</span> <span class="kt">Data</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">httpResponse</span> <span class="o">=</span> <span class="n">response</span> <span class="k">as?</span> <span class="kt">HTTPURLResponse</span><span class="p">,</span>
            <span class="n">httpResponse</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">==</span> <span class="mi">200</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="kt">TestFailureCondition</span><span class="o">.</span><span class="n">invalidServerResponse</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span>
    <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-coding">Encoding and decoding</h4>
<div class="sect4">
<h5 id="reference-encode">encode</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Encode</code> converts the output from upstream Encodable object using a specified TopLevelEncoder. For example, use <code>JSONEncoder</code> or <code>PropertyListEncoder</code>..</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Available when the output type conforms to <code>Encodable</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/encode" class="bare">https://developer.apple.com/documentation/combine/publishers/encode</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>encode</code> and <code>decode</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/EncodeDecodeTests.swift"><code>UsingCombineTests/EncodeDecodeTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <code>encode</code> operator takes a single parameter: <code>encoder</code>
This is an instance of an object conforming to <a href="https://developer.apple.com/documentation/combine/toplevelencoder">TopLevelEncoder</a>. Frequently it is an instance of <a href="https://developer.apple.com/documentation/foundation/jsonencoder">JSONEncoder</a> or <a href="https://developer.apple.com/documentation/foundation/propertylistencoder">PropertyListEncoder</a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">fileprivate</span> <span class="kd">struct</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">valid</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">dataProvider</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="nv">encoder</span><span class="p">:</span> <span class="kt">JSONEncoder</span><span class="p">())</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">".sink() data received </span><span class="se">\(</span><span class="n">data</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">stringRepresentation</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">stringRepresentation</span><span class="p">)</span>
    <span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Like the <a href="#reference-decode">decode</a> operator, the encode process can also fail and throw an error.
Therefore it also returns a failure type of <code>&lt;Error&gt;</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>A common issue is if you try to pass an optional type to the <code>encode</code> operator.
This results in a error from the compiler.
In these cases, either you can change the type from optional to a concrete type with the <a href="#reference-trymap">tryMap</a> operator, or use an operator such as <a href="#reference-replacenil">replaceNil</a> to provide concrete values.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-decode">decode</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A commonly desired operation is to decode some provided data, so Combine provides the <code>decode</code> operator suited to that task.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Available when the output type conforms to <code>Decodable</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/decode" class="bare">https://developer.apple.com/documentation/combine/publishers/decode</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-datataskpublisher-decode">Making a network request with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-datataskpublisher-trymap">Stricter request processing with dataTaskPublisher</a></p>
</li>
<li>
<p><a href="#patterns-oneshot-error-handling">Using catch to handle errors in a one-shot pipeline</a></p>
</li>
<li>
<p><a href="#patterns-retry">Retrying in the event of a temporary failure</a></p>
</li>
<li>
<p>unit tests illustrating using <code>encode</code> and <code>decode</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/EncodeDecodeTests.swift"><code>UsingCombineTests/EncodeDecodeTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <code>decode</code> operator takes two parameters:</p>
<div class="ulist">
<ul>
<li>
<p><code>type</code> which is typically a reference to a struct you defined</p>
</li>
<li>
<p><code>decoder</code> an instance of an object conforming to <a href="https://developer.apple.com/documentation/combine/topleveldecoder">TopLevelDecoder</a>, frequently an instance of <a href="https://developer.apple.com/documentation/foundation/jsondecoder">JSONDecoder</a> or <a href="https://developer.apple.com/documentation/foundation/propertylistdecoder">PropertyListDecoder</a>.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Since decoding can fail, the operator returns a failure type of <code>Error</code>.
The data type returned by the operator is defined by the type you provided to decode.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">testUrlString</span> <span class="o">=</span> <span class="s">"https://postman-echo.com/time/valid?timestamp=2016-10-10"</span>
<span class="c1">// checks the validity of a timestamp - this one should return {"valid":true}</span>
<span class="c1">// matching the data structure returned from https://postman-echo.com/time/valid</span>
<span class="kd">fileprivate</span> <span class="kd">struct</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="p">:</span> <span class="kt">Decodable</span><span class="p">,</span> <span class="kt">Hashable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">valid</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">remoteDataPublisher</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskPublisher</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">testUrlString</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
    <span class="c1">// the dataTaskPublisher output combination is (data: Data, response: URLResponse)</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">data</span> <span class="p">}</span>
    <span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">PostmanEchoTimeStampCheckResponse</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">())</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-multiplesubscribers">Working with multiple subscribers</h4>
<div class="sect4">
<h5 id="reference-share">share</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>A publisher implemented as a class, which otherwise behaves like its upstream publisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/share" class="bare">https://developer.apple.com/documentation/combine/publishers/share</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>share</code> and <code>MulticastPublisher</code> are illustrated in the unit tests <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MulticastSharePublisherTests.swift"><code>UsingCombineTests/MulticastSharePublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>A publisher is often a struct within swift, following value semantics.
<code>share</code> is used when you want to create a publisher as a class to take advantage of reference semantics.
This is most frequently employed when creating a publisher that does expensive work so that you can isolate the expensive work and use it from multiple subscribers.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Very often, you will see <code>share</code> used to provide <a href="#reference-multicast">multicast</a> - to create a shared instance of a publisher and have multiple subscribers connected to that single publisher.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">expensivePublisher</span> <span class="o">=</span> <span class="n">somepublisher</span>
    <span class="o">.</span><span class="nf">share</span><span class="p">()</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-multicast">multicast</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Use a multicast publisher when you have multiple downstream subscribers, but you want upstream publishers to only process one receive(_:) call per event.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/multicast" class="bare">https://developer.apple.com/documentation/combine/publishers/multicast</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>share</code> and <code>MulticastPublisher</code> are illustrated in the unit tests <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/MulticastSharePublisherTests.swift"><code>UsingCombineTests/MulticastSharePublisherTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>A multicast publisher provides a means of consolidating the requests of data from a publisher into a single request.
A multicast publisher does not change data or types within a pipeline.
It does provide a bastion for subscriptions so that when demand is created from one subscriber, multiple subscribers can benefit from it.
It effectively allows one value to go to multiple subscribers.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Multicast is often created after using <a href="#reference-share">share</a> on a publisher to create a reference object as a publisher.
This allows you to consolidate expensive queries, such as external network requests, and provide the data to multiple consumers.</p>
</div>
<div class="paragraph">
<p>When creating using multicast, you either provide a <a href="#reference-subjects">Subjects</a> (with the parameter `subject) or create a <a href="#reference-subjects">Subjects</a> inline in a closure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">pipelineFork</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">multicastPublisher</span> <span class="o">=</span> <span class="n">somepublisher</span><span class="o">.</span><span class="nf">multicast</span><span class="p">(</span><span class="nv">subject</span><span class="p">:</span> <span class="n">pipelineFork</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">multicastPublisher</span> <span class="o">=</span> <span class="n">somepublisher</span>
    <span class="o">.</span><span class="n">multicast</span> <span class="p">{</span>
        <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">Bool</span><span class="p">,</span> <span class="kt">Error</span><span class="o">&gt;</span><span class="p">()</span>
    <span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A multicast publisher does not cache or maintain the history of a value.
If a multicast publisher is already making a request and another subscriber is added after the data has been returned to previously connected subscribers, new subscribers may only get a completion.
For this reason, multicast returns a <a href="#reference-makeconnectable">connectable publisher</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When making a multicast publisher, make sure you explicitly connect the publishers or you will see no data flow through your pipeline.
Do this either using <code>connect()</code> on your publisher after all subscribers have been connected, or by using <code>autoconnect()</code> to enable the connection on the first subscription..</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reference-operators-debugging">Debugging</h4>
<div class="sect4">
<h5 id="reference-breakpoint">breakpoint</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>The <code>breakpoint</code> operator raises a debugger signal when a provided closure identifies the need to stop the process in the debugger.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/breakpoint" class="bare">https://developer.apple.com/documentation/combine/publishers/breakpoint</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-debugging-breakpoint">Debugging pipelines with the debugger</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>When any of the provided closures returns true, this publisher raises a <code>SIGTRAP</code> signal to stop the process in the debugger. Otherwise, this publisher passes through values and completions.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The operator takes 3 optional closures as parameters, used to trigger when to raise a <code>SIGTRAP</code> signal:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>receiveSubscription</code></p>
</li>
<li>
<p><code>receiveOutput</code></p>
</li>
<li>
<p><code>receiveCompletion</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">breakpoint</span><span class="p">(</span><span class="nv">receiveSubscription</span><span class="p">:</span> <span class="p">{</span> <span class="n">subscription</span> <span class="k">in</span>
    <span class="k">return</span> <span class="kc">false</span> <span class="c1">// return true to throw SIGTRAP and invoke the debugger</span>
<span class="p">},</span> <span class="nv">receiveOutput</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="k">return</span> <span class="kc">false</span> <span class="c1">// return true to throw SIGTRAP and invoke the debugger</span>
<span class="p">},</span> <span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">completion</span> <span class="k">in</span>
    <span class="k">return</span> <span class="kc">false</span> <span class="c1">// return true to throw SIGTRAP and invoke the debugger</span>
<span class="p">})</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-breakpointonerror">breakpointOnError</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Raises a debugger signal upon receiving a failure.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/breakpoint/3205192-breakpointonerror" class="bare">https://developer.apple.com/documentation/combine/publishers/breakpoint/3205192-breakpointonerror</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-debugging-breakpoint">Debugging pipelines with the debugger</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>breakpointOnError</code> is a convenience method used to raise a <code>SIGTRAP</code> signal when an error is propagated through it within a pipeline.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">breakpointOnError</span><span class="p">()</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-handleevents">handleEvents</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>handleEvents</code> is an all purpose operator that allow you to specify closures be invoked when publisher events occur.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/handleevents" class="bare">https://developer.apple.com/documentation/combine/publishers/handleevents</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>handleEvents</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/HandleEventsPublisherTests.swift"><code>UsingCombineTests/HandleEventsPublisherTests.swift</code></a></p>
</li>
<li>
<p><a href="#patterns-debugging-handleevents">Debugging pipelines with the handleEvents operator</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>handleEvents</code> does not require any parameters, allowing you to specify a response to specific publisher events.
Optional closures can be provided for the following events:</p>
<div class="ulist">
<ul>
<li>
<p><code>receiveSubscription</code></p>
</li>
<li>
<p><code>receiveOutput</code></p>
</li>
<li>
<p><code>receiveCompletion</code></p>
</li>
<li>
<p><code>receiveCancel</code></p>
</li>
<li>
<p><code>receiveRequest</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>All of the closures are expected to return <code>Void</code>, which makes <code>handleEvents</code> useful for intentionally creating side effects based on what is happening in the pipeline.</p>
</div>
<div class="paragraph">
<p>You could, for example, use <code>handleEvents</code> to update an activityIndicator UI element, triggering it on with the receipt of the subscription, and terminating with the receipt of either cancel or completion.</p>
</div>
<div class="paragraph">
<p>If you only want to view the information flowing through the pipeline, you might consider using the <a href="#reference-print">print</a> operator instead.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">handleEvents</span><span class="p">(</span><span class="nv">receiveSubscription</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">startAnimating</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="nv">receiveCancel</span><span class="p">:</span> <span class="p">{</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">activityIndicator</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">})</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-print">print</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>Prints log messages for all publishing events.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publishers/print" class="bare">https://developer.apple.com/documentation/combine/publishers/print</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>unit tests illustrating using <code>print</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/PublisherTests.swift"><code>UsingCombineTests/PublisherTests.swift</code></a></p>
</li>
<li>
<p><a href="#patterns-debugging-print">Debugging pipelines with the print operator</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>The <code>print</code> operator does not require a parameter, but if provided will prepend it to any console output.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>Print</code> is incredibly useful to see "what&#8217;s happening" within a pipeline, and can be used as <em>printf debugging</em> within the pipeline.</p>
</div>
<div class="paragraph">
<p>Most of the example tests illustrating the operators within this reference use a <code>print</code> operator to provide additional text output to illustrate lifecycle events.</p>
</div>
<div class="paragraph">
<p>The <code>print</code> operator is not directly integrated with Apple&#8217;s unified logging, although there is an optional <code>to</code> parameter that lets you specific an instance conforming to <a href="https://developer.apple.com/documentation/swift/textoutputstream">TextOutputStream</a> to which it will send the output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="err">$</span><span class="n">username</span>
    <span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="k">self</span><span class="o">.</span><span class="n">debugDescription</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">tryMap</span><span class="p">({</span> <span class="n">myValue</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">myValue</span> <span class="o">==</span> <span class="s">"boom"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="kt">FailureCondition</span><span class="o">.</span><span class="n">selfDestruct</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s">"mappedValue"</span>
    <span class="p">})</span></code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="scheduler-and-thread-handling-operators">Scheduler and Thread handling operators</h4>
<div class="sect4">
<h5 id="reference-receive">receive</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Receive</code> defines the scheduler on which to receive elements from the publisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/publisher/3204743-receive"><code>receive</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-assign-subscriber">Creating a subscriber with assign</a> shows an example of using <code>receive</code> with <code>assign</code> to set an a boolean property on a UI element.</p>
</li>
<li>
<p>unit tests illustrating using <code>assign</code> with a <code>dataTaskPublisher</code>, as well as <code>subscribe</code> and <code>receive</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SubscribeReceiveAssignTests.swift"><code>UsingCombineTests/SubscribeReceiveAssignTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Receive</code> takes a single required parameter (<code>on:</code>) which accepts a scheduler, and an optional parameter (<code>optional:</code>) which can accept <code>SchedulerOptions</code>.
<a href="https://developer.apple.com/documentation/combine/scheduler">Scheduler</a> is a protocol in Combine, with the conforming types that are commonly used of <a href="https://developer.apple.com/documentation/foundation/runloop">RunLoop</a>, <a href="https://developer.apple.com/documentation/dispatch/dispatchqueue">DispatchQueue</a> and <a href="https://developer.apple.com/documentation/foundation/operationqueue">OperationQueue</a>.
<code>Receive</code> is frequently used with <a href="#reference-assign">assign</a> to make sure any following pipeline invocations happen on a specific thread, such as <code>RunLoop.main</code> when updating user interface objects.
<code>Receive</code> effects itself and any operators chained after it, but not previous operators.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If you want to influence a previously chained publishers (or operators) for where to run, you may want to look at the <a href="#reference-subscribe">subscribe</a> operator.
Alternately, you may also want to put a <code>receive</code> operator earlier in the pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="n">examplePublisher</span><span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="reference-subscribe">subscribe</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Subscribe</code> defines the scheduler on which to run a publisher in a pipeline.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/anypublisher/3204260-subscribe"><code>subscribe</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-assign-subscriber">Creating a subscriber with assign</a> shows an example of using assign to set an a boolean property on a UI element.</p>
</li>
<li>
<p>unit tests illustrating using an <code>assign</code> subscriber in a pipeline from a <code>dataTaskPublisher</code> with <code>subscribe</code> and <code>receive</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SubscribeReceiveAssignTests.swift"><code>UsingCombineTests/SubscribeReceiveAssignTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Subscribe</code> assigns a scheduler to the preceding pipeline invocation.
It is relatively infrequently used, specifically to encourage a publisher such as <a href="#reference-just">Just</a> or <a href="#reference-deferred">Deferred</a> to run on a specific queue.
If you want to control which queue operators run on, then it is more common to use the <a href="#reference-receive">receive</a> operator, which effects all following operators and subscribers.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>Subscribe</code> takes a single required parameter (<code>on:</code>) which accepts a scheduler, and an optional parameter (<code>optional:</code>) which can accept <code>SchedulerOptions</code>.
<a href="https://developer.apple.com/documentation/combine/scheduler">Scheduler</a> is a protocol in Combine, with the conforming types that are commonly used of <a href="https://developer.apple.com/documentation/foundation/runloop">RunLoop</a>, <a href="https://developer.apple.com/documentation/dispatch/dispatchqueue">DispatchQueue</a> and <a href="https://developer.apple.com/documentation/foundation/operationqueue">OperationQueue</a>.</p>
</div>
<div class="paragraph">
<p><code>Subscribe</code> effects a subset of the functions, and does not guarantee that a publisher will run on that queue.
In particular, it effects a publishers <code>receive</code> function, the subscribers <code>request</code> function, and the <code>cancel</code> function.
Some publishers (such as <a href="#reference-datataskpublisher">URLSession.dataTaskPublisher</a>) have complex internals that will run on alternative queues based on their configuration, and will be relatively unaffected by <code>subscribe</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="n">networkDataPublisher</span>
    <span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="n">backgroundQueue</span><span class="p">)</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">yourLabel</span><span class="p">)</span> <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the <code>subscribe</code> call requests the publisher (and any pipeline invocations before this in a chain) be invoked on the backgroundQueue.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <code>receive</code> call transfers the data to the main runloop, suitable for updating user interface elements</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <code>assign</code> call uses the <a href="#reference-assign">assign</a> subscriber to update the property <code>text</code> on a KVO compliant object, in this case <code>yourLabel</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When creating a <code>DispatchQueue</code> to use with Combine publishers on background threads, it is recommended that you use a regular serial queue rather than a concurrent queue <a href="https://forums.swift.org/t/runloop-main-or-dispatchqueue-main-when-using-combine-scheduler/26635/4">to allow Combine to adhere to its contracts</a>.
That is: <strong>do not</strong> create the queue with <code>attributes: .concurrent</code>.</p>
</div>
<div class="paragraph">
<p>This is not enforced by the compiler or any internal framework constraints.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect3">
<h4 id="type-erasure-operators">Type erasure operators</h4>
<div class="sect4">
<h5 id="reference-erasetoanypublisher">eraseToAnyPublisher</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>The <code>eraseToAnyPublisher</code> operator takes a publisher and provides a type erased instance of AnyPublisher.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/anypublisher" class="bare">https://developer.apple.com/documentation/combine/anypublisher</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-future">Wrapping an asynchronous call with a Future to create a one-shot publisher</a></p>
</li>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading multiple UI updates, including a network request</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>When chaining operators together, the resulting type signature accumulates all the various types.
This can get complicated quite quickly, and can provide an unnecessarily complex signature for an API.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>eraseToAnyPublisher</code> takes the signature and "erases" the type back to the common type of <code>AnyPublisher</code>.
This provides a cleaner type for external declarations.
Combine was created prior to Swift 5 inclusion of opaque types, which may have been an alternative.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="nf">eraseToAnyPublisher</span><span class="p">()</span> <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>eraseToAnyPublisher</code> is often at the end of chains of operators, cleaning up the signature of the returned property.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="reference-anysubscriber">AnySubscriber</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p>The <code>AnySubscriber</code> provides a type erased instance of AnySubscriber.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/anysubscriber" class="bare">https://developer.apple.com/documentation/combine/anysubscriber</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>Use an <code>AnySubscriber</code> to wrap an existing subscriber whose details you don’t want to expose.
You can also use <code>AnySubscriber</code> to create a custom subscriber by providing closures for the methods defined in <code>Subscriber</code>, rather than implementing <code>Subscriber</code> directly.</p>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reference-subjects">Subjects</h3>
<div class="paragraph">
<p>General information on <a href="#coreconcepts-subjects">Subjects</a> can be found in the Core Concepts section.</p>
</div>
<div class="sect3">
<h4 id="reference-currentvaluesubject">currentValueSubject</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>CurrentValueSubject</code> creates an object that can be used to integrate imperative code into a pipeline, starting with an initial value.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/currentvaluesubject"><code>CurrentValueSubject</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>currentValueSubject</code> creates an instance to which you can attach multiple subscribers.
When creating a <code>currentValueSubject</code>, you do so with an initial value of the relevant output type for the Subject.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code>CurrentValueSubject</code> remembers the current value so that when a subscriber is attached, it immediately receives the current value.
When a subscriber is connected and requests data, the initial value is sent.
Further calls to <code>.send()</code> afterwards will then pass through values to any subscribers.</p>
</div>
</div>
<div class="sect3">
<h4 id="reference-passthroughsubject">PassthroughSubject</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>PassthroughSubject</code> creates an object that can be used to integrate imperative code into a Combine pipeline.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/passthroughsubject"><code>PassthroughSubject</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>PassthroughSubject</code> creates an instance to which you can attach multiple subscribers.
When it is created, only the types are defined.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When a subscriber is connected and requests data, it will not receive any values until a <code>.send()</code> call is invoked.
<code>PassthroughSubject</code> doesn&#8217;t maintain any state, it only passes through provided values.
Calls to <code>.send()</code> will then send values to any subscribers.</p>
</div>
<div class="paragraph">
<p><code>PassthroughSubject</code> is commonly used in scenarios where you want to create a publisher from imperative code.
One example of this might be a publisher from a delegate callback structure, common in Apple&#8217;s APIs.
Another common use is to test subscribers and pipelines, providing you with imperative control of when events are sent within a pipeline.</p>
</div>
<div class="paragraph">
<p>This is very useful when creating tests, as you can put when data is sent to a pipeline under test control.</p>
</div>
<div style="page-break-after: always;"></div>
<hr>
</div>
</div>
<div class="sect2">
<h3 id="reference-subscribers">Subscribers</h3>
<div class="paragraph">
<p>For general information about subscribers and how they fit with publishers and operators, see <a href="#coreconcepts-subscribers">Subscribers</a>.</p>
</div>
<div class="sect3">
<h4 id="reference-assign">assign</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Assign</code> creates a subscriber used to update a property on a KVO compliant object.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Failure type must be <code>&lt;Never&gt;</code>.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/subscribers/assign"><code>assign</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-assign-subscriber">Creating a subscriber with assign</a> shows an example of using <code>assign</code> to set an a boolean property on a UI element.</p>
</li>
<li>
<p>unit tests illustrating using an <code>assign</code> subscriber in a pipeline from a <code>dataTaskPublisher</code> with <code>subscribe</code> and <code>receive</code>: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SubscribeReceiveAssignTests.swift"><code>UsingCombineTests/SubscribeReceiveAssignTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>Assign</code> only handles data, and expects all errors or failures to be handled in the pipeline before it is invoked.
The return value from setting up <code>assign</code> can be cancelled, and is frequently used when disabling the pipeline, such as when a viewController is disabled or deallocated.
<code>Assign</code> is frequently used in conjunction with the <a href="#reference-receive">receive</a> operator to receive values on a specific scheduler, typically <code>RunLoop.main</code> when updating UI objects.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The type of <code>KeyPath</code> required for the <code>assign</code> operator is important.
It requires a <code>ReferenceWritableKeyPath</code>, which is different from both <code>WritableKeyPath</code> and <code>KeyPath</code>.
In particular, <code>ReferenceWritableKeyPath</code> requires that the object you&#8217;re writing to is a reference type (an instance of a class), as well as being publicly writable.
A <code>WritableKeyPath</code> is one that&#8217;s a mutable value reference (a mutable struct), and <code>KeyPath</code> reflects that the object is simply readable by keypath, but not mutable.</p>
</div>
<div class="paragraph">
<p>It is not always clear (for example, while using code-completion from the editor) what a property may reflect.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="n">examplePublisher</span>
    <span class="o">.</span><span class="nf">receive</span><span class="p">(</span><span class="nv">on</span><span class="p">:</span> <span class="kt">RunLoop</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
    <span class="o">.</span><span class="nf">assign</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="p">\</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="nv">on</span><span class="p">:</span> <span class="n">yourLabel</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>An error you may see:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Cannot convert value of type 'KeyPath&lt;SomeObject, Bool&gt;' to specified type 'ReferenceWritableKeyPath&lt;SomeObject, Bool&gt;'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This happens when you are attempting to assign to a property that is read-only.
An example of this is <code>UIActivityIndicator&#8217;s `isAnimating</code> property.</p>
</div>
<div class="paragraph">
<p>Another error you might see on using the <code>assign</code> operator is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Type of expression is ambiguous without more context</code></pre>
</div>
</div>
<div class="paragraph">
<p>Xcode 11.7 supplies improved swift compiler diagnostics, which enable an easier to understand error message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Key path value type 'UIImage?' cannot be converted to contextual type 'UIImage'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This error can occur when you are attempting to assign a non-optional type to a keypath that expects has an optional type.
For example, <code>UIImageView.image</code> is of type <code>UIImage?</code>, so attempting to assign an output type of <code>UIImage</code> from a previous operator would result in this error message.</p>
</div>
<div class="paragraph">
<p>The solution is to either use <a href="#reference-sink">sink</a>, or to include a <code>map</code> operator prior to assignment that changes the output type to match.
For example, to convert the type <code>UIImage</code> to <code>UIImage?</code> you could use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">image</span> <span class="o">-&gt;</span> <span class="kt">UIImage</span><span class="p">?</span> <span class="k">in</span>
    <span class="n">image</span>
<span class="p">}</span></code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="reference-sink">sink</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>Sink</code> creates an all-purpose subscriber.
At a minimum, you provide a closure to receive values, and optionally a closure that receives completions.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><em>none</em></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/subscribers/sink"><code>sink</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-sink-subscriber">Creating a subscriber with sink</a> shows an example of creating a <code>sink</code> that receives both completion messages as well as data from the publisher.</p>
</li>
<li>
<p>unit tests illustrating a <code>sink</code> subscriber and how it works: <a href="https://github.com/heckj/swiftui-notes/blob/master/UsingCombineTests/SinkSubscriberTests.swift"><code>UsingCombineTests/SinkSubscriberTests.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>There are two forms of the <code>sink</code> operator.
The first is the simplest form, taking a single closure, receiving only the values from the pipeline (if and when provided by the publisher).
Using the simpler version comes with a constraint: the failure type of the pipeline must be <code>&lt;Never&gt;</code>.
If you are working with a pipeline that has a failure type other than <code>&lt;Never&gt;</code> you need to use the two closure version or add error handling into the pipeline itself.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>An example of the simple form of <code>sink</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">examplePublisher</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="n">examplePublisher</span><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Be aware that the closure may be called repeatedly.
How often it is called depends on the pipeline to which it is subscribing.
The closure you provide is invoked for every update that the publisher provides, up until the completion, and prior to any cancellation.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It may be tempting to ignore the cancellable you get returned from <code>sink</code>.
For example, the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">_</span> <span class="o">=</span> <span class="n">examplePublisher</span><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, this has the side effect that as soon as the function returns, the ignored variable is deallocated, causing the pipeline to be cancelled.
If you want the pipeline to operate beyond the scope of the function (you probably do), then assign it to a longer lived variable that doesn&#8217;t get deallocated until much later.
Simply including a variable declaration in the enclosing object is often a good solution.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The second form of <code>sink</code> takes two closures, the first of which receives the data from the pipeline, and the second receives pipeline completion messages.
The closure parameters are <code>receiveCompletion</code> and <code>receiveValue</code>:
A <code>.failure</code> completion may also encapsulate an error.</p>
</div>
<div class="paragraph">
<p>An example of the two-closure <code>sink</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">examplePublisher</span> <span class="o">=</span> <span class="kt">Just</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">let</span> <span class="nv">cancellable</span> <span class="o">=</span> <span class="n">examplePublisher</span><span class="o">.</span><span class="nf">sink</span><span class="p">(</span><span class="nv">receiveCompletion</span><span class="p">:</span> <span class="p">{</span> <span class="n">err</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received the completion"</span><span class="p">,</span> <span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">err</span><span class="p">))</span>
<span class="p">},</span> <span class="nv">receiveValue</span><span class="p">:</span> <span class="p">{</span> <span class="n">value</span> <span class="k">in</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">".sink() received </span><span class="se">\(</span><span class="kt">String</span><span class="p">(</span><span class="nv">describing</span><span class="p">:</span> <span class="n">value</span><span class="p">)</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">})</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The type that is passed into <code>receiveCompletion</code> is the enum <a href="https://developer.apple.com/documentation/combine/subscribers/completion"><code>Subscribers.Completion</code></a>.
The completion <code>.failure</code> includes an <code>Error</code> wrapped within it, providing access to the underlying cause of the failure.
To get to the error within the <code>.failure</code> completion, <code>switch</code> on the returned completion to determine if it is <code>.finished</code> or <code>.failure</code>, and then pull out the error.</p>
</div>
<div class="paragraph">
<p>When you chain a <code>.sink</code> subscriber onto a publisher (or pipeline), the result is cancellable.
At any time before the publisher sends a completion, the subscriber can send a cancellation and invalidate the pipeline.
After a cancel is sent, no further values will be received.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">let</span> <span class="nv">simplePublisher</span> <span class="o">=</span> <span class="kt">PassthroughSubject</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">Never</span><span class="o">&gt;</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">cancellablePipeline</span> <span class="o">=</span> <span class="n">simplePublisher</span><span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
  <span class="c1">// do what you need with the data...</span>
<span class="p">}</span>

<span class="n">cancellablePublisher</span><span class="o">.</span><span class="nf">cancel</span><span class="p">()</span> <span class="c1">// when invoked, this invalidates the pipeline</span>
<span class="c1">// no further data will be received by the sink</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>similar to publishers having a type-erased struct <a href="#reference-erasetoanypublisher">AnyPublisher</a> to expose publishers through an API, subscribers have an equivalent: <a href="#reference-anycancellable">AnyCancellable</a>. This is often used with <code>sink</code> to convert the resulting type into <code>AnyCancellable</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="reference-onreceive">onReceive</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>onReceive</code> is a subscriber built into SwiftUI that allows publishers to be linked into local views to trigger relevant state changes.</p>
</dd>
<dt class="hdlist1"><em>Constraints on connected publisher</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>Failure type must be <code>&lt;Never&gt;</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/swiftui/tupleview/3365870-onreceive"><code>onReceive</code></a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p>The SwiftUI example code at <a href="https://github.com/heckj/swiftui-notes/blob/master/SwiftUI-Notes/HeadingView.swift"><code>SwiftUI-Notes/HeadingView.swift</code></a></p>
</li>
<li>
<p>The SwiftUI example code at <a href="https://github.com/heckj/swiftui-notes/blob/master/SwiftUI-Notes/ReactiveForm.swift"><code>SwiftUI-Notes/ReactiveForm.swift</code></a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p><code>onReceive</code> is a subscriber, taking a reference to a publisher, a closure which is invoked when the publisher provided to <code>onReceive</code> receives data.
This acts very similarly to the sink subscriber with a single closure, including requiring that the failure type of the publisher be <code>&lt;Never&gt;</code>.
<code>onReceive</code> does not automatically invalidate the view, but allows the developers to react to the published data in whatever way is appropriate - this could be updating some local view property (<code>@State</code>) with the value directly, or first transforming the data in some fashion.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>A common example of this with SwiftUI is hooking up a publisher created from a <code>Timer</code>, which generates a <code>Date</code> reference, and using that to trigger an update to a view from a timer.</p>
</div>
</div>
<div class="sect3">
<h4 id="reference-anycancellable">AnyCancellable</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><em>Summary</em></dt>
<dd>
<p><code>AnyCancellable</code> type erases a subscriber to the general form of <a href="https://developer.apple.com/documentation/combine/cancellable">Cancellable</a>.</p>
</dd>
<dt class="hdlist1"><em><span class="icon"><i class="fa fa-apple"></i></span> docs</em></dt>
<dd>
<p><a href="https://developer.apple.com/documentation/combine/anycancellable" class="bare">https://developer.apple.com/documentation/combine/anycancellable</a></p>
</dd>
<dt class="hdlist1"><em>Usage</em></dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="#patterns-update-interface-userinput">Declarative UI updates from user input</a></p>
</li>
<li>
<p><a href="#patterns-cascading-update-interface">Cascading UI updates including a network request</a></p>
</li>
<li>
<p><a href="#patterns-delegate-publisher-subject">Creating a repeating publisher by wrapping a delegate based API</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><em>Details</em></dt>
<dd>
<p>This is used to provide a reference to a subscriber that allows the use of <code>cancel</code> without access to the subscription itself to request items.
This is most typically used when you want a reference to a subscriber to clean it up on deallocation.
Since the <a href="#reference-assign">assign</a> returns an <code>AnyCancellable</code>, this is often used when you want to save the reference to a <a href="#reference-sink">sink</a> an <code>AnyCancellable</code>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="k">var</span> <span class="nv">mySubscriber</span><span class="p">:</span> <span class="kt">AnyCancellable</span><span class="p">?</span>

<span class="k">let</span> <span class="nv">mySinkSubscriber</span> <span class="o">=</span> <span class="n">remotePublisher</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"received "</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="p">}</span>
<span class="n">mySubscriber</span> <span class="o">=</span> <span class="kt">AnyCancellable</span><span class="p">(</span><span class="n">mySinkSubscriber</span><span class="p">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A pattern that is supported with Combine is collecting <code>AnyCancellable</code> references into a set and then saving references to the cancellable subscribers with a <code>store</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="swift"><span class="kd">private</span> <span class="k">var</span> <span class="nv">cancellableSet</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">AnyCancellable</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">let</span> <span class="nv">mySinkSubscriber</span> <span class="o">=</span> <span class="n">remotePublisher</span>
    <span class="o">.</span><span class="n">sink</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"received "</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">store</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">cancellableSet</span><span class="p">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.2<br>
Last updated 2021-08-05 14:59:24 UTC
</div>
</div>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge .cm {
  color: #999988;
  font-style: italic;
}
pre.rouge .cp {
  color: #999999;
  font-weight: bold;
}
pre.rouge .c1 {
  color: #999988;
  font-style: italic;
}
pre.rouge .cs {
  color: #999999;
  font-weight: bold;
  font-style: italic;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cpf {
  color: #999988;
  font-style: italic;
}
pre.rouge .err {
  color: #a61717;
  background-color: #e3d2d2;
}
pre.rouge .gd {
  color: #000000;
  background-color: #ffdddd;
}
pre.rouge .ge {
  color: #000000;
  font-style: italic;
}
pre.rouge .gr {
  color: #aa0000;
}
pre.rouge .gh {
  color: #999999;
}
pre.rouge .gi {
  color: #000000;
  background-color: #ddffdd;
}
pre.rouge .go {
  color: #888888;
}
pre.rouge .gp {
  color: #555555;
}
pre.rouge .gs {
  font-weight: bold;
}
pre.rouge .gu {
  color: #aaaaaa;
}
pre.rouge .gt {
  color: #aa0000;
}
pre.rouge .kc {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kd {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kn {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kp {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kr {
  color: #000000;
  font-weight: bold;
}
pre.rouge .kt {
  color: #445588;
  font-weight: bold;
}
pre.rouge .k, pre.rouge .kv {
  color: #000000;
  font-weight: bold;
}
pre.rouge .mf {
  color: #009999;
}
pre.rouge .mh {
  color: #009999;
}
pre.rouge .il {
  color: #009999;
}
pre.rouge .mi {
  color: #009999;
}
pre.rouge .mo {
  color: #009999;
}
pre.rouge .m, pre.rouge .mb, pre.rouge .mx {
  color: #009999;
}
pre.rouge .sb {
  color: #d14;
}
pre.rouge .sc {
  color: #d14;
}
pre.rouge .sd {
  color: #d14;
}
pre.rouge .s2 {
  color: #d14;
}
pre.rouge .se {
  color: #d14;
}
pre.rouge .sh {
  color: #d14;
}
pre.rouge .si {
  color: #d14;
}
pre.rouge .sx {
  color: #d14;
}
pre.rouge .sr {
  color: #009926;
}
pre.rouge .s1 {
  color: #d14;
}
pre.rouge .ss {
  color: #990073;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .dl {
  color: #d14;
}
pre.rouge .na {
  color: #008080;
}
pre.rouge .bp {
  color: #999999;
}
pre.rouge .nb {
  color: #0086B3;
}
pre.rouge .nc {
  color: #445588;
  font-weight: bold;
}
pre.rouge .no {
  color: #008080;
}
pre.rouge .nd {
  color: #3c5d5d;
  font-weight: bold;
}
pre.rouge .ni {
  color: #800080;
}
pre.rouge .ne {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nf, pre.rouge .fm {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nl {
  color: #990000;
  font-weight: bold;
}
pre.rouge .nn {
  color: #555555;
}
pre.rouge .nt {
  color: #000080;
}
pre.rouge .vc {
  color: #008080;
}
pre.rouge .vg {
  color: #008080;
}
pre.rouge .vi {
  color: #008080;
}
pre.rouge .nv, pre.rouge .vm {
  color: #008080;
}
pre.rouge .ow {
  color: #000000;
  font-weight: bold;
}
pre.rouge .o {
  color: #000000;
  font-weight: bold;
}
pre.rouge .w {
  color: #bbbbbb;
}
pre.rouge {
  background-color: #f8f8f8;
}
</style>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-898243-5','auto');
ga('send','pageview');
</script>
</body>
</html>